function [T,supExV4_V,supExV4_iNa_m,supExV4_iNa_h,supExV4_iK_n,supISOMxV4_V,supISOMxV4_iNa_m,supISOMxV4_iNa_h,supISOMxV4_iK_n,supIPVxV4_V,supIPVxV4_iNa_m,supIPVxV4_iNa_h,supIPVxV4_iK_n,midExV4_V,midExV4_iNa_m,midExV4_iNa_h,midExV4_iK_n,midIPVxV4_V,midIPVxV4_iNa_m,midIPVxV4_iNa_h,midIPVxV4_iK_n,deepExV4_V,deepExV4_iNa_m,deepExV4_iNa_h,deepExV4_iK_n,deepISOMxV4_V,deepISOMxV4_iNa_m,deepISOMxV4_iNa_h,deepISOMxV4_iK_n,deepIPVxV4_V,deepIPVxV4_iNa_m,deepIPVxV4_iNa_h,deepIPVxV4_iK_n,PreStimuliAxV4_V,PreStimuliAxV4_iNa_m,PreStimuliAxV4_iNa_h,PreStimuliAxV4_iK_n,PostStimuliAxV4_V,PostStimuliAxV4_iNa_m,PostStimuliAxV4_iNa_h,PostStimuliAxV4_iK_n,PreStimuliBxV4_V,PreStimuliBxV4_iNa_m,PreStimuliBxV4_iNa_h,PreStimuliBxV4_iK_n,PostStimuliBxV4_V,PostStimuliBxV4_iNa_m,PostStimuliBxV4_iNa_h,PostStimuliBxV4_iK_n,PreStimuliCxV4_V,PreStimuliCxV4_iNa_m,PreStimuliCxV4_iNa_h,PreStimuliCxV4_iK_n,PostStimuliCxV4_V,PostStimuliCxV4_iNa_m,PostStimuliCxV4_iNa_h,PostStimuliCxV4_iK_n,supISOMxV4_supExV4_iAMPActx_s,supIPVxV4_supExV4_iAMPActx_s,supISOMxV4_supExV4_iNMDActx_s,supIPVxV4_supExV4_iNMDActx_s,supExV4_supISOMxV4_iGABActx_s,supIPVxV4_supISOMxV4_iGABActx_s,supExV4_supIPVxV4_iGABActx_s,supISOMxV4_supIPVxV4_iGABActx_s,midIPVxV4_midExV4_iAMPActx_s,midExV4_midIPVxV4_iGABActx_s,deepISOMxV4_deepExV4_iAMPActx_s,deepIPVxV4_deepExV4_iAMPActx_s,deepExV4_deepISOMxV4_iGABActx_s,deepIPVxV4_deepISOMxV4_iGABActx_s,deepExV4_deepIPVxV4_iGABActx_s,deepISOMxV4_deepIPVxV4_iGABActx_s,PostStimuliAxV4_PreStimuliAxV4_iAMPActx_s,PostStimuliBxV4_PreStimuliBxV4_iAMPActx_s,PostStimuliCxV4_PreStimuliCxV4_iAMPActx_s,midExV4_PreStimuliAxV4_iAMPActx_s,midExV4_PostStimuliAxV4_iAMPActx_s,midExV4_PreStimuliBxV4_iAMPActx_s,midExV4_PostStimuliBxV4_iAMPActx_s,midExV4_PreStimuliCxV4_iAMPActx_s,midExV4_PostStimuliCxV4_iAMPActx_s,deepExV4_supExV4_iAMPActx_s,supISOMxV4_midExV4_iAMPActx_s,supExV4_midExV4_iAMPActx_s,deepExV4_midExV4_iAMPActx_s,deepIPVxV4_midExV4_iAMPActx_s,supExV4_midIPVxV4_iGABActx_s,supISOMxV4_deepExV4_iAMPActx_s,supIPVxV4_deepExV4_iAMPActx_s,midIPVxV4_deepISOMxV4_iGABActx_s]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% seed the random number generator
rng(p.random_seed);

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
supExV4_V_last =  -rand(1, p.supExV4_Npop)*74;
supExV4_V = zeros(nsamp,p.supExV4_Npop);
supExV4_V(1,:) = supExV4_V_last;
supExV4_iNa_m_last = p.supExV4_iNa_m_IC+p.supExV4_iNa_IC_noise*rand(1,p.supExV4_Npop);
supExV4_iNa_m = zeros(nsamp,p.supExV4_Npop);
supExV4_iNa_m(1,:) = supExV4_iNa_m_last;
supExV4_iNa_h_last = p.supExV4_iNa_h_IC+p.supExV4_iNa_IC_noise*rand(1,p.supExV4_Npop);
supExV4_iNa_h = zeros(nsamp,p.supExV4_Npop);
supExV4_iNa_h(1,:) = supExV4_iNa_h_last;
supExV4_iK_n_last = p.supExV4_iK_n_IC+p.supExV4_iK_IC_noise*rand(1,p.supExV4_Npop);
supExV4_iK_n = zeros(nsamp,p.supExV4_Npop);
supExV4_iK_n(1,:) = supExV4_iK_n_last;
supISOMxV4_V_last =  -rand(1, p.supISOMxV4_Npop)*74;
supISOMxV4_V = zeros(nsamp,p.supISOMxV4_Npop);
supISOMxV4_V(1,:) = supISOMxV4_V_last;
supISOMxV4_iNa_m_last = p.supISOMxV4_iNa_m_IC+p.supISOMxV4_iNa_IC_noise*rand(1,p.supISOMxV4_Npop);
supISOMxV4_iNa_m = zeros(nsamp,p.supISOMxV4_Npop);
supISOMxV4_iNa_m(1,:) = supISOMxV4_iNa_m_last;
supISOMxV4_iNa_h_last = p.supISOMxV4_iNa_h_IC+p.supISOMxV4_iNa_IC_noise*rand(1,p.supISOMxV4_Npop);
supISOMxV4_iNa_h = zeros(nsamp,p.supISOMxV4_Npop);
supISOMxV4_iNa_h(1,:) = supISOMxV4_iNa_h_last;
supISOMxV4_iK_n_last = p.supISOMxV4_iK_n_IC+p.supISOMxV4_iK_IC_noise*rand(1,p.supISOMxV4_Npop);
supISOMxV4_iK_n = zeros(nsamp,p.supISOMxV4_Npop);
supISOMxV4_iK_n(1,:) = supISOMxV4_iK_n_last;
supIPVxV4_V_last =  -rand(1, p.supIPVxV4_Npop)*74;
supIPVxV4_V = zeros(nsamp,p.supIPVxV4_Npop);
supIPVxV4_V(1,:) = supIPVxV4_V_last;
supIPVxV4_iNa_m_last = p.supIPVxV4_iNa_m_IC+p.supIPVxV4_iNa_IC_noise*rand(1,p.supIPVxV4_Npop);
supIPVxV4_iNa_m = zeros(nsamp,p.supIPVxV4_Npop);
supIPVxV4_iNa_m(1,:) = supIPVxV4_iNa_m_last;
supIPVxV4_iNa_h_last = p.supIPVxV4_iNa_h_IC+p.supIPVxV4_iNa_IC_noise*rand(1,p.supIPVxV4_Npop);
supIPVxV4_iNa_h = zeros(nsamp,p.supIPVxV4_Npop);
supIPVxV4_iNa_h(1,:) = supIPVxV4_iNa_h_last;
supIPVxV4_iK_n_last = p.supIPVxV4_iK_n_IC+p.supIPVxV4_iK_IC_noise*rand(1,p.supIPVxV4_Npop);
supIPVxV4_iK_n = zeros(nsamp,p.supIPVxV4_Npop);
supIPVxV4_iK_n(1,:) = supIPVxV4_iK_n_last;
midExV4_V_last =  -rand(1, p.midExV4_Npop)*74;
midExV4_V = zeros(nsamp,p.midExV4_Npop);
midExV4_V(1,:) = midExV4_V_last;
midExV4_iNa_m_last = p.midExV4_iNa_m_IC+p.midExV4_iNa_IC_noise*rand(1,p.midExV4_Npop);
midExV4_iNa_m = zeros(nsamp,p.midExV4_Npop);
midExV4_iNa_m(1,:) = midExV4_iNa_m_last;
midExV4_iNa_h_last = p.midExV4_iNa_h_IC+p.midExV4_iNa_IC_noise*rand(1,p.midExV4_Npop);
midExV4_iNa_h = zeros(nsamp,p.midExV4_Npop);
midExV4_iNa_h(1,:) = midExV4_iNa_h_last;
midExV4_iK_n_last = p.midExV4_iK_n_IC+p.midExV4_iK_IC_noise*rand(1,p.midExV4_Npop);
midExV4_iK_n = zeros(nsamp,p.midExV4_Npop);
midExV4_iK_n(1,:) = midExV4_iK_n_last;
midIPVxV4_V_last =  -rand(1, p.midIPVxV4_Npop)*74;
midIPVxV4_V = zeros(nsamp,p.midIPVxV4_Npop);
midIPVxV4_V(1,:) = midIPVxV4_V_last;
midIPVxV4_iNa_m_last = p.midIPVxV4_iNa_m_IC+p.midIPVxV4_iNa_IC_noise*rand(1,p.midIPVxV4_Npop);
midIPVxV4_iNa_m = zeros(nsamp,p.midIPVxV4_Npop);
midIPVxV4_iNa_m(1,:) = midIPVxV4_iNa_m_last;
midIPVxV4_iNa_h_last = p.midIPVxV4_iNa_h_IC+p.midIPVxV4_iNa_IC_noise*rand(1,p.midIPVxV4_Npop);
midIPVxV4_iNa_h = zeros(nsamp,p.midIPVxV4_Npop);
midIPVxV4_iNa_h(1,:) = midIPVxV4_iNa_h_last;
midIPVxV4_iK_n_last = p.midIPVxV4_iK_n_IC+p.midIPVxV4_iK_IC_noise*rand(1,p.midIPVxV4_Npop);
midIPVxV4_iK_n = zeros(nsamp,p.midIPVxV4_Npop);
midIPVxV4_iK_n(1,:) = midIPVxV4_iK_n_last;
deepExV4_V_last =  -rand(1, p.deepExV4_Npop)*74;
deepExV4_V = zeros(nsamp,p.deepExV4_Npop);
deepExV4_V(1,:) = deepExV4_V_last;
deepExV4_iNa_m_last = p.deepExV4_iNa_m_IC+p.deepExV4_iNa_IC_noise*rand(1,p.deepExV4_Npop);
deepExV4_iNa_m = zeros(nsamp,p.deepExV4_Npop);
deepExV4_iNa_m(1,:) = deepExV4_iNa_m_last;
deepExV4_iNa_h_last = p.deepExV4_iNa_h_IC+p.deepExV4_iNa_IC_noise*rand(1,p.deepExV4_Npop);
deepExV4_iNa_h = zeros(nsamp,p.deepExV4_Npop);
deepExV4_iNa_h(1,:) = deepExV4_iNa_h_last;
deepExV4_iK_n_last = p.deepExV4_iK_n_IC+p.deepExV4_iK_IC_noise*rand(1,p.deepExV4_Npop);
deepExV4_iK_n = zeros(nsamp,p.deepExV4_Npop);
deepExV4_iK_n(1,:) = deepExV4_iK_n_last;
deepISOMxV4_V_last =  -rand(1, p.deepISOMxV4_Npop)*74;
deepISOMxV4_V = zeros(nsamp,p.deepISOMxV4_Npop);
deepISOMxV4_V(1,:) = deepISOMxV4_V_last;
deepISOMxV4_iNa_m_last = p.deepISOMxV4_iNa_m_IC+p.deepISOMxV4_iNa_IC_noise*rand(1,p.deepISOMxV4_Npop);
deepISOMxV4_iNa_m = zeros(nsamp,p.deepISOMxV4_Npop);
deepISOMxV4_iNa_m(1,:) = deepISOMxV4_iNa_m_last;
deepISOMxV4_iNa_h_last = p.deepISOMxV4_iNa_h_IC+p.deepISOMxV4_iNa_IC_noise*rand(1,p.deepISOMxV4_Npop);
deepISOMxV4_iNa_h = zeros(nsamp,p.deepISOMxV4_Npop);
deepISOMxV4_iNa_h(1,:) = deepISOMxV4_iNa_h_last;
deepISOMxV4_iK_n_last = p.deepISOMxV4_iK_n_IC+p.deepISOMxV4_iK_IC_noise*rand(1,p.deepISOMxV4_Npop);
deepISOMxV4_iK_n = zeros(nsamp,p.deepISOMxV4_Npop);
deepISOMxV4_iK_n(1,:) = deepISOMxV4_iK_n_last;
deepIPVxV4_V_last =  -rand(1, p.deepIPVxV4_Npop)*74;
deepIPVxV4_V = zeros(nsamp,p.deepIPVxV4_Npop);
deepIPVxV4_V(1,:) = deepIPVxV4_V_last;
deepIPVxV4_iNa_m_last = p.deepIPVxV4_iNa_m_IC+p.deepIPVxV4_iNa_IC_noise*rand(1,p.deepIPVxV4_Npop);
deepIPVxV4_iNa_m = zeros(nsamp,p.deepIPVxV4_Npop);
deepIPVxV4_iNa_m(1,:) = deepIPVxV4_iNa_m_last;
deepIPVxV4_iNa_h_last = p.deepIPVxV4_iNa_h_IC+p.deepIPVxV4_iNa_IC_noise*rand(1,p.deepIPVxV4_Npop);
deepIPVxV4_iNa_h = zeros(nsamp,p.deepIPVxV4_Npop);
deepIPVxV4_iNa_h(1,:) = deepIPVxV4_iNa_h_last;
deepIPVxV4_iK_n_last = p.deepIPVxV4_iK_n_IC+p.deepIPVxV4_iK_IC_noise*rand(1,p.deepIPVxV4_Npop);
deepIPVxV4_iK_n = zeros(nsamp,p.deepIPVxV4_Npop);
deepIPVxV4_iK_n(1,:) = deepIPVxV4_iK_n_last;
PreStimuliAxV4_V_last =  -60 - rand(1, p.PreStimuliAxV4_Npop)*17;
PreStimuliAxV4_V = zeros(nsamp,p.PreStimuliAxV4_Npop);
PreStimuliAxV4_V(1,:) = PreStimuliAxV4_V_last;
PreStimuliAxV4_iNa_m_last = p.PreStimuliAxV4_iNa_m_IC+p.PreStimuliAxV4_iNa_IC_noise*rand(1,p.PreStimuliAxV4_Npop);
PreStimuliAxV4_iNa_m = zeros(nsamp,p.PreStimuliAxV4_Npop);
PreStimuliAxV4_iNa_m(1,:) = PreStimuliAxV4_iNa_m_last;
PreStimuliAxV4_iNa_h_last = p.PreStimuliAxV4_iNa_h_IC+p.PreStimuliAxV4_iNa_IC_noise*rand(1,p.PreStimuliAxV4_Npop);
PreStimuliAxV4_iNa_h = zeros(nsamp,p.PreStimuliAxV4_Npop);
PreStimuliAxV4_iNa_h(1,:) = PreStimuliAxV4_iNa_h_last;
PreStimuliAxV4_iK_n_last = p.PreStimuliAxV4_iK_n_IC+p.PreStimuliAxV4_iK_IC_noise*rand(1,p.PreStimuliAxV4_Npop);
PreStimuliAxV4_iK_n = zeros(nsamp,p.PreStimuliAxV4_Npop);
PreStimuliAxV4_iK_n(1,:) = PreStimuliAxV4_iK_n_last;
PostStimuliAxV4_V_last =  -60 - rand(1, p.PostStimuliAxV4_Npop)*17;
PostStimuliAxV4_V = zeros(nsamp,p.PostStimuliAxV4_Npop);
PostStimuliAxV4_V(1,:) = PostStimuliAxV4_V_last;
PostStimuliAxV4_iNa_m_last = p.PostStimuliAxV4_iNa_m_IC+p.PostStimuliAxV4_iNa_IC_noise*rand(1,p.PostStimuliAxV4_Npop);
PostStimuliAxV4_iNa_m = zeros(nsamp,p.PostStimuliAxV4_Npop);
PostStimuliAxV4_iNa_m(1,:) = PostStimuliAxV4_iNa_m_last;
PostStimuliAxV4_iNa_h_last = p.PostStimuliAxV4_iNa_h_IC+p.PostStimuliAxV4_iNa_IC_noise*rand(1,p.PostStimuliAxV4_Npop);
PostStimuliAxV4_iNa_h = zeros(nsamp,p.PostStimuliAxV4_Npop);
PostStimuliAxV4_iNa_h(1,:) = PostStimuliAxV4_iNa_h_last;
PostStimuliAxV4_iK_n_last = p.PostStimuliAxV4_iK_n_IC+p.PostStimuliAxV4_iK_IC_noise*rand(1,p.PostStimuliAxV4_Npop);
PostStimuliAxV4_iK_n = zeros(nsamp,p.PostStimuliAxV4_Npop);
PostStimuliAxV4_iK_n(1,:) = PostStimuliAxV4_iK_n_last;
PreStimuliBxV4_V_last =  -60 - rand(1, p.PreStimuliBxV4_Npop)*17;
PreStimuliBxV4_V = zeros(nsamp,p.PreStimuliBxV4_Npop);
PreStimuliBxV4_V(1,:) = PreStimuliBxV4_V_last;
PreStimuliBxV4_iNa_m_last = p.PreStimuliBxV4_iNa_m_IC+p.PreStimuliBxV4_iNa_IC_noise*rand(1,p.PreStimuliBxV4_Npop);
PreStimuliBxV4_iNa_m = zeros(nsamp,p.PreStimuliBxV4_Npop);
PreStimuliBxV4_iNa_m(1,:) = PreStimuliBxV4_iNa_m_last;
PreStimuliBxV4_iNa_h_last = p.PreStimuliBxV4_iNa_h_IC+p.PreStimuliBxV4_iNa_IC_noise*rand(1,p.PreStimuliBxV4_Npop);
PreStimuliBxV4_iNa_h = zeros(nsamp,p.PreStimuliBxV4_Npop);
PreStimuliBxV4_iNa_h(1,:) = PreStimuliBxV4_iNa_h_last;
PreStimuliBxV4_iK_n_last = p.PreStimuliBxV4_iK_n_IC+p.PreStimuliBxV4_iK_IC_noise*rand(1,p.PreStimuliBxV4_Npop);
PreStimuliBxV4_iK_n = zeros(nsamp,p.PreStimuliBxV4_Npop);
PreStimuliBxV4_iK_n(1,:) = PreStimuliBxV4_iK_n_last;
PostStimuliBxV4_V_last =  -60 - rand(1, p.PostStimuliBxV4_Npop)*17;
PostStimuliBxV4_V = zeros(nsamp,p.PostStimuliBxV4_Npop);
PostStimuliBxV4_V(1,:) = PostStimuliBxV4_V_last;
PostStimuliBxV4_iNa_m_last = p.PostStimuliBxV4_iNa_m_IC+p.PostStimuliBxV4_iNa_IC_noise*rand(1,p.PostStimuliBxV4_Npop);
PostStimuliBxV4_iNa_m = zeros(nsamp,p.PostStimuliBxV4_Npop);
PostStimuliBxV4_iNa_m(1,:) = PostStimuliBxV4_iNa_m_last;
PostStimuliBxV4_iNa_h_last = p.PostStimuliBxV4_iNa_h_IC+p.PostStimuliBxV4_iNa_IC_noise*rand(1,p.PostStimuliBxV4_Npop);
PostStimuliBxV4_iNa_h = zeros(nsamp,p.PostStimuliBxV4_Npop);
PostStimuliBxV4_iNa_h(1,:) = PostStimuliBxV4_iNa_h_last;
PostStimuliBxV4_iK_n_last = p.PostStimuliBxV4_iK_n_IC+p.PostStimuliBxV4_iK_IC_noise*rand(1,p.PostStimuliBxV4_Npop);
PostStimuliBxV4_iK_n = zeros(nsamp,p.PostStimuliBxV4_Npop);
PostStimuliBxV4_iK_n(1,:) = PostStimuliBxV4_iK_n_last;
PreStimuliCxV4_V_last =  -60 - rand(1, p.PreStimuliCxV4_Npop)*17;
PreStimuliCxV4_V = zeros(nsamp,p.PreStimuliCxV4_Npop);
PreStimuliCxV4_V(1,:) = PreStimuliCxV4_V_last;
PreStimuliCxV4_iNa_m_last = p.PreStimuliCxV4_iNa_m_IC+p.PreStimuliCxV4_iNa_IC_noise*rand(1,p.PreStimuliCxV4_Npop);
PreStimuliCxV4_iNa_m = zeros(nsamp,p.PreStimuliCxV4_Npop);
PreStimuliCxV4_iNa_m(1,:) = PreStimuliCxV4_iNa_m_last;
PreStimuliCxV4_iNa_h_last = p.PreStimuliCxV4_iNa_h_IC+p.PreStimuliCxV4_iNa_IC_noise*rand(1,p.PreStimuliCxV4_Npop);
PreStimuliCxV4_iNa_h = zeros(nsamp,p.PreStimuliCxV4_Npop);
PreStimuliCxV4_iNa_h(1,:) = PreStimuliCxV4_iNa_h_last;
PreStimuliCxV4_iK_n_last = p.PreStimuliCxV4_iK_n_IC+p.PreStimuliCxV4_iK_IC_noise*rand(1,p.PreStimuliCxV4_Npop);
PreStimuliCxV4_iK_n = zeros(nsamp,p.PreStimuliCxV4_Npop);
PreStimuliCxV4_iK_n(1,:) = PreStimuliCxV4_iK_n_last;
PostStimuliCxV4_V_last =  -60 - rand(1, p.PostStimuliCxV4_Npop)*17;
PostStimuliCxV4_V = zeros(nsamp,p.PostStimuliCxV4_Npop);
PostStimuliCxV4_V(1,:) = PostStimuliCxV4_V_last;
PostStimuliCxV4_iNa_m_last = p.PostStimuliCxV4_iNa_m_IC+p.PostStimuliCxV4_iNa_IC_noise*rand(1,p.PostStimuliCxV4_Npop);
PostStimuliCxV4_iNa_m = zeros(nsamp,p.PostStimuliCxV4_Npop);
PostStimuliCxV4_iNa_m(1,:) = PostStimuliCxV4_iNa_m_last;
PostStimuliCxV4_iNa_h_last = p.PostStimuliCxV4_iNa_h_IC+p.PostStimuliCxV4_iNa_IC_noise*rand(1,p.PostStimuliCxV4_Npop);
PostStimuliCxV4_iNa_h = zeros(nsamp,p.PostStimuliCxV4_Npop);
PostStimuliCxV4_iNa_h(1,:) = PostStimuliCxV4_iNa_h_last;
PostStimuliCxV4_iK_n_last = p.PostStimuliCxV4_iK_n_IC+p.PostStimuliCxV4_iK_IC_noise*rand(1,p.PostStimuliCxV4_Npop);
PostStimuliCxV4_iK_n = zeros(nsamp,p.PostStimuliCxV4_Npop);
PostStimuliCxV4_iK_n(1,:) = PostStimuliCxV4_iK_n_last;
supISOMxV4_supExV4_iAMPActx_s_last =  p.supISOMxV4_supExV4_iAMPActx_IC+p.supISOMxV4_supExV4_iAMPActx_IC_noise.*rand(1,p.supExV4_Npop);
supISOMxV4_supExV4_iAMPActx_s = zeros(nsamp,p.supExV4_Npop);
supISOMxV4_supExV4_iAMPActx_s(1,:) = supISOMxV4_supExV4_iAMPActx_s_last;
supIPVxV4_supExV4_iAMPActx_s_last =  p.supIPVxV4_supExV4_iAMPActx_IC+p.supIPVxV4_supExV4_iAMPActx_IC_noise.*rand(1,p.supExV4_Npop);
supIPVxV4_supExV4_iAMPActx_s = zeros(nsamp,p.supExV4_Npop);
supIPVxV4_supExV4_iAMPActx_s(1,:) = supIPVxV4_supExV4_iAMPActx_s_last;
supISOMxV4_supExV4_iNMDActx_s_last =  p.supISOMxV4_supExV4_iNMDActx_IC+p.supISOMxV4_supExV4_iNMDActx_IC_noise*rand(1,p.supExV4_Npop);
supISOMxV4_supExV4_iNMDActx_s = zeros(nsamp,p.supExV4_Npop);
supISOMxV4_supExV4_iNMDActx_s(1,:) = supISOMxV4_supExV4_iNMDActx_s_last;
supIPVxV4_supExV4_iNMDActx_s_last =  p.supIPVxV4_supExV4_iNMDActx_IC+p.supIPVxV4_supExV4_iNMDActx_IC_noise*rand(1,p.supExV4_Npop);
supIPVxV4_supExV4_iNMDActx_s = zeros(nsamp,p.supExV4_Npop);
supIPVxV4_supExV4_iNMDActx_s(1,:) = supIPVxV4_supExV4_iNMDActx_s_last;
supExV4_supISOMxV4_iGABActx_s_last =  p.supExV4_supISOMxV4_iGABActx_IC+p.supExV4_supISOMxV4_iGABActx_IC_noise.*rand(1,p.supISOMxV4_Npop);
supExV4_supISOMxV4_iGABActx_s = zeros(nsamp,p.supISOMxV4_Npop);
supExV4_supISOMxV4_iGABActx_s(1,:) = supExV4_supISOMxV4_iGABActx_s_last;
supIPVxV4_supISOMxV4_iGABActx_s_last =  p.supIPVxV4_supISOMxV4_iGABActx_IC+p.supIPVxV4_supISOMxV4_iGABActx_IC_noise.*rand(1,p.supISOMxV4_Npop);
supIPVxV4_supISOMxV4_iGABActx_s = zeros(nsamp,p.supISOMxV4_Npop);
supIPVxV4_supISOMxV4_iGABActx_s(1,:) = supIPVxV4_supISOMxV4_iGABActx_s_last;
supExV4_supIPVxV4_iGABActx_s_last =  p.supExV4_supIPVxV4_iGABActx_IC+p.supExV4_supIPVxV4_iGABActx_IC_noise.*rand(1,p.supIPVxV4_Npop);
supExV4_supIPVxV4_iGABActx_s = zeros(nsamp,p.supIPVxV4_Npop);
supExV4_supIPVxV4_iGABActx_s(1,:) = supExV4_supIPVxV4_iGABActx_s_last;
supISOMxV4_supIPVxV4_iGABActx_s_last =  p.supISOMxV4_supIPVxV4_iGABActx_IC+p.supISOMxV4_supIPVxV4_iGABActx_IC_noise.*rand(1,p.supIPVxV4_Npop);
supISOMxV4_supIPVxV4_iGABActx_s = zeros(nsamp,p.supIPVxV4_Npop);
supISOMxV4_supIPVxV4_iGABActx_s(1,:) = supISOMxV4_supIPVxV4_iGABActx_s_last;
midIPVxV4_midExV4_iAMPActx_s_last =  p.midIPVxV4_midExV4_iAMPActx_IC+p.midIPVxV4_midExV4_iAMPActx_IC_noise.*rand(1,p.midExV4_Npop);
midIPVxV4_midExV4_iAMPActx_s = zeros(nsamp,p.midExV4_Npop);
midIPVxV4_midExV4_iAMPActx_s(1,:) = midIPVxV4_midExV4_iAMPActx_s_last;
midExV4_midIPVxV4_iGABActx_s_last =  p.midExV4_midIPVxV4_iGABActx_IC+p.midExV4_midIPVxV4_iGABActx_IC_noise.*rand(1,p.midIPVxV4_Npop);
midExV4_midIPVxV4_iGABActx_s = zeros(nsamp,p.midIPVxV4_Npop);
midExV4_midIPVxV4_iGABActx_s(1,:) = midExV4_midIPVxV4_iGABActx_s_last;
deepISOMxV4_deepExV4_iAMPActx_s_last =  p.deepISOMxV4_deepExV4_iAMPActx_IC+p.deepISOMxV4_deepExV4_iAMPActx_IC_noise.*rand(1,p.deepExV4_Npop);
deepISOMxV4_deepExV4_iAMPActx_s = zeros(nsamp,p.deepExV4_Npop);
deepISOMxV4_deepExV4_iAMPActx_s(1,:) = deepISOMxV4_deepExV4_iAMPActx_s_last;
deepIPVxV4_deepExV4_iAMPActx_s_last =  p.deepIPVxV4_deepExV4_iAMPActx_IC+p.deepIPVxV4_deepExV4_iAMPActx_IC_noise.*rand(1,p.deepExV4_Npop);
deepIPVxV4_deepExV4_iAMPActx_s = zeros(nsamp,p.deepExV4_Npop);
deepIPVxV4_deepExV4_iAMPActx_s(1,:) = deepIPVxV4_deepExV4_iAMPActx_s_last;
deepExV4_deepISOMxV4_iGABActx_s_last =  p.deepExV4_deepISOMxV4_iGABActx_IC+p.deepExV4_deepISOMxV4_iGABActx_IC_noise.*rand(1,p.deepISOMxV4_Npop);
deepExV4_deepISOMxV4_iGABActx_s = zeros(nsamp,p.deepISOMxV4_Npop);
deepExV4_deepISOMxV4_iGABActx_s(1,:) = deepExV4_deepISOMxV4_iGABActx_s_last;
deepIPVxV4_deepISOMxV4_iGABActx_s_last =  p.deepIPVxV4_deepISOMxV4_iGABActx_IC+p.deepIPVxV4_deepISOMxV4_iGABActx_IC_noise.*rand(1,p.deepISOMxV4_Npop);
deepIPVxV4_deepISOMxV4_iGABActx_s = zeros(nsamp,p.deepISOMxV4_Npop);
deepIPVxV4_deepISOMxV4_iGABActx_s(1,:) = deepIPVxV4_deepISOMxV4_iGABActx_s_last;
deepExV4_deepIPVxV4_iGABActx_s_last =  p.deepExV4_deepIPVxV4_iGABActx_IC+p.deepExV4_deepIPVxV4_iGABActx_IC_noise.*rand(1,p.deepIPVxV4_Npop);
deepExV4_deepIPVxV4_iGABActx_s = zeros(nsamp,p.deepIPVxV4_Npop);
deepExV4_deepIPVxV4_iGABActx_s(1,:) = deepExV4_deepIPVxV4_iGABActx_s_last;
deepISOMxV4_deepIPVxV4_iGABActx_s_last =  p.deepISOMxV4_deepIPVxV4_iGABActx_IC+p.deepISOMxV4_deepIPVxV4_iGABActx_IC_noise.*rand(1,p.deepIPVxV4_Npop);
deepISOMxV4_deepIPVxV4_iGABActx_s = zeros(nsamp,p.deepIPVxV4_Npop);
deepISOMxV4_deepIPVxV4_iGABActx_s(1,:) = deepISOMxV4_deepIPVxV4_iGABActx_s_last;
PostStimuliAxV4_PreStimuliAxV4_iAMPActx_s_last =  p.PostStimuliAxV4_PreStimuliAxV4_iAMPActx_IC+p.PostStimuliAxV4_PreStimuliAxV4_iAMPActx_IC_noise.*rand(1,p.PreStimuliAxV4_Npop);
PostStimuliAxV4_PreStimuliAxV4_iAMPActx_s = zeros(nsamp,p.PreStimuliAxV4_Npop);
PostStimuliAxV4_PreStimuliAxV4_iAMPActx_s(1,:) = PostStimuliAxV4_PreStimuliAxV4_iAMPActx_s_last;
PostStimuliBxV4_PreStimuliBxV4_iAMPActx_s_last =  p.PostStimuliBxV4_PreStimuliBxV4_iAMPActx_IC+p.PostStimuliBxV4_PreStimuliBxV4_iAMPActx_IC_noise.*rand(1,p.PreStimuliBxV4_Npop);
PostStimuliBxV4_PreStimuliBxV4_iAMPActx_s = zeros(nsamp,p.PreStimuliBxV4_Npop);
PostStimuliBxV4_PreStimuliBxV4_iAMPActx_s(1,:) = PostStimuliBxV4_PreStimuliBxV4_iAMPActx_s_last;
PostStimuliCxV4_PreStimuliCxV4_iAMPActx_s_last =  p.PostStimuliCxV4_PreStimuliCxV4_iAMPActx_IC+p.PostStimuliCxV4_PreStimuliCxV4_iAMPActx_IC_noise.*rand(1,p.PreStimuliCxV4_Npop);
PostStimuliCxV4_PreStimuliCxV4_iAMPActx_s = zeros(nsamp,p.PreStimuliCxV4_Npop);
PostStimuliCxV4_PreStimuliCxV4_iAMPActx_s(1,:) = PostStimuliCxV4_PreStimuliCxV4_iAMPActx_s_last;
midExV4_PreStimuliAxV4_iAMPActx_s_last =  p.midExV4_PreStimuliAxV4_iAMPActx_IC+p.midExV4_PreStimuliAxV4_iAMPActx_IC_noise.*rand(1,p.PreStimuliAxV4_Npop);
midExV4_PreStimuliAxV4_iAMPActx_s = zeros(nsamp,p.PreStimuliAxV4_Npop);
midExV4_PreStimuliAxV4_iAMPActx_s(1,:) = midExV4_PreStimuliAxV4_iAMPActx_s_last;
midExV4_PostStimuliAxV4_iAMPActx_s_last =  p.midExV4_PostStimuliAxV4_iAMPActx_IC+p.midExV4_PostStimuliAxV4_iAMPActx_IC_noise.*rand(1,p.PostStimuliAxV4_Npop);
midExV4_PostStimuliAxV4_iAMPActx_s = zeros(nsamp,p.PostStimuliAxV4_Npop);
midExV4_PostStimuliAxV4_iAMPActx_s(1,:) = midExV4_PostStimuliAxV4_iAMPActx_s_last;
midExV4_PreStimuliBxV4_iAMPActx_s_last =  p.midExV4_PreStimuliBxV4_iAMPActx_IC+p.midExV4_PreStimuliBxV4_iAMPActx_IC_noise.*rand(1,p.PreStimuliBxV4_Npop);
midExV4_PreStimuliBxV4_iAMPActx_s = zeros(nsamp,p.PreStimuliBxV4_Npop);
midExV4_PreStimuliBxV4_iAMPActx_s(1,:) = midExV4_PreStimuliBxV4_iAMPActx_s_last;
midExV4_PostStimuliBxV4_iAMPActx_s_last =  p.midExV4_PostStimuliBxV4_iAMPActx_IC+p.midExV4_PostStimuliBxV4_iAMPActx_IC_noise.*rand(1,p.PostStimuliBxV4_Npop);
midExV4_PostStimuliBxV4_iAMPActx_s = zeros(nsamp,p.PostStimuliBxV4_Npop);
midExV4_PostStimuliBxV4_iAMPActx_s(1,:) = midExV4_PostStimuliBxV4_iAMPActx_s_last;
midExV4_PreStimuliCxV4_iAMPActx_s_last =  p.midExV4_PreStimuliCxV4_iAMPActx_IC+p.midExV4_PreStimuliCxV4_iAMPActx_IC_noise.*rand(1,p.PreStimuliCxV4_Npop);
midExV4_PreStimuliCxV4_iAMPActx_s = zeros(nsamp,p.PreStimuliCxV4_Npop);
midExV4_PreStimuliCxV4_iAMPActx_s(1,:) = midExV4_PreStimuliCxV4_iAMPActx_s_last;
midExV4_PostStimuliCxV4_iAMPActx_s_last =  p.midExV4_PostStimuliCxV4_iAMPActx_IC+p.midExV4_PostStimuliCxV4_iAMPActx_IC_noise.*rand(1,p.PostStimuliCxV4_Npop);
midExV4_PostStimuliCxV4_iAMPActx_s = zeros(nsamp,p.PostStimuliCxV4_Npop);
midExV4_PostStimuliCxV4_iAMPActx_s(1,:) = midExV4_PostStimuliCxV4_iAMPActx_s_last;
deepExV4_supExV4_iAMPActx_s_last =  p.deepExV4_supExV4_iAMPActx_IC+p.deepExV4_supExV4_iAMPActx_IC_noise.*rand(1,p.supExV4_Npop);
deepExV4_supExV4_iAMPActx_s = zeros(nsamp,p.supExV4_Npop);
deepExV4_supExV4_iAMPActx_s(1,:) = deepExV4_supExV4_iAMPActx_s_last;
supISOMxV4_midExV4_iAMPActx_s_last =  p.supISOMxV4_midExV4_iAMPActx_IC+p.supISOMxV4_midExV4_iAMPActx_IC_noise.*rand(1,p.midExV4_Npop);
supISOMxV4_midExV4_iAMPActx_s = zeros(nsamp,p.midExV4_Npop);
supISOMxV4_midExV4_iAMPActx_s(1,:) = supISOMxV4_midExV4_iAMPActx_s_last;
supExV4_midExV4_iAMPActx_s_last =  p.supExV4_midExV4_iAMPActx_IC+p.supExV4_midExV4_iAMPActx_IC_noise.*rand(1,p.midExV4_Npop);
supExV4_midExV4_iAMPActx_s = zeros(nsamp,p.midExV4_Npop);
supExV4_midExV4_iAMPActx_s(1,:) = supExV4_midExV4_iAMPActx_s_last;
deepExV4_midExV4_iAMPActx_s_last =  p.deepExV4_midExV4_iAMPActx_IC+p.deepExV4_midExV4_iAMPActx_IC_noise.*rand(1,p.midExV4_Npop);
deepExV4_midExV4_iAMPActx_s = zeros(nsamp,p.midExV4_Npop);
deepExV4_midExV4_iAMPActx_s(1,:) = deepExV4_midExV4_iAMPActx_s_last;
deepIPVxV4_midExV4_iAMPActx_s_last =  p.deepIPVxV4_midExV4_iAMPActx_IC+p.deepIPVxV4_midExV4_iAMPActx_IC_noise.*rand(1,p.midExV4_Npop);
deepIPVxV4_midExV4_iAMPActx_s = zeros(nsamp,p.midExV4_Npop);
deepIPVxV4_midExV4_iAMPActx_s(1,:) = deepIPVxV4_midExV4_iAMPActx_s_last;
supExV4_midIPVxV4_iGABActx_s_last =  p.supExV4_midIPVxV4_iGABActx_IC+p.supExV4_midIPVxV4_iGABActx_IC_noise.*rand(1,p.midIPVxV4_Npop);
supExV4_midIPVxV4_iGABActx_s = zeros(nsamp,p.midIPVxV4_Npop);
supExV4_midIPVxV4_iGABActx_s(1,:) = supExV4_midIPVxV4_iGABActx_s_last;
supISOMxV4_deepExV4_iAMPActx_s_last =  p.supISOMxV4_deepExV4_iAMPActx_IC+p.supISOMxV4_deepExV4_iAMPActx_IC_noise.*rand(1,p.deepExV4_Npop);
supISOMxV4_deepExV4_iAMPActx_s = zeros(nsamp,p.deepExV4_Npop);
supISOMxV4_deepExV4_iAMPActx_s(1,:) = supISOMxV4_deepExV4_iAMPActx_s_last;
supIPVxV4_deepExV4_iAMPActx_s_last =  p.supIPVxV4_deepExV4_iAMPActx_IC+p.supIPVxV4_deepExV4_iAMPActx_IC_noise.*rand(1,p.deepExV4_Npop);
supIPVxV4_deepExV4_iAMPActx_s = zeros(nsamp,p.deepExV4_Npop);
supIPVxV4_deepExV4_iAMPActx_s(1,:) = supIPVxV4_deepExV4_iAMPActx_s_last;
midIPVxV4_deepISOMxV4_iGABActx_s_last =  p.midIPVxV4_deepISOMxV4_iGABActx_IC+p.midIPVxV4_deepISOMxV4_iGABActx_IC_noise.*rand(1,p.deepISOMxV4_Npop);
midIPVxV4_deepISOMxV4_iGABActx_s = zeros(nsamp,p.deepISOMxV4_Npop);
midIPVxV4_deepISOMxV4_iGABActx_s(1,:) = midIPVxV4_deepISOMxV4_iGABActx_s_last;

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  supExV4_V_k1 = (p.supExV4_Iapp + ((((-p.supExV4_iNa_gNa.*supExV4_iNa_m_last.^3.*supExV4_iNa_h_last.*(supExV4_V_last-p.supExV4_iNa_ENa))))+((((-p.supExV4_iK_gK.*supExV4_iK_n_last.^4.*(supExV4_V_last-p.supExV4_iK_EK))))+((((-p.supExV4_supISOMxV4_iGABActx_gGABAa.*(supExV4_supISOMxV4_iGABActx_s_last*p.supExV4_supISOMxV4_iGABActx_netcon).*(supExV4_V_last-p.supExV4_supISOMxV4_iGABActx_EGABAa))))+((((-p.supExV4_supIPVxV4_iGABActx_gGABAa.*(supExV4_supIPVxV4_iGABActx_s_last*p.supExV4_supIPVxV4_iGABActx_netcon).*(supExV4_V_last-p.supExV4_supIPVxV4_iGABActx_EGABAa))))+((-(((p.supExV4_midExV4_iAMPActx_gAMPA.*(supExV4_midExV4_iAMPActx_s_last*p.supExV4_midExV4_iAMPActx_netcon).*(supExV4_V_last-p.supExV4_midExV4_iAMPActx_EAMPA)))))+((((-p.supExV4_midIPVxV4_iGABActx_gGABAa.*(supExV4_midIPVxV4_iGABActx_s_last*p.supExV4_midIPVxV4_iGABActx_netcon).*(supExV4_V_last-p.supExV4_midIPVxV4_iGABActx_EGABAa)))))))))) + p.supExV4_noise*randn(1, p.supExV4_Npop))/p.supExV4_C;
  supExV4_iNa_m_k1 = (((2.5-.1*(supExV4_V_last+65))./(exp(2.5-.1*(supExV4_V_last+65))-1))).*(1-supExV4_iNa_m_last)-((4*exp(-(supExV4_V_last+65)/18))).*supExV4_iNa_m_last;
  supExV4_iNa_h_k1 = ((.07*exp(-(supExV4_V_last+65)/20))).*(1-supExV4_iNa_h_last)-((1./(exp(3-.1*(supExV4_V_last+65))+1))).*supExV4_iNa_h_last;
  supExV4_iK_n_k1 = (((.1-.01*(supExV4_V_last+65))./(exp(1-.1*(supExV4_V_last+65))-1))).*(1-supExV4_iK_n_last)-((.125*exp(-(supExV4_V_last+65)/80))).*supExV4_iK_n_last;
  supISOMxV4_V_k1 = (p.supISOMxV4_Iapp + ((((-p.supISOMxV4_iNa_gNa.*supISOMxV4_iNa_m_last.^3.*supISOMxV4_iNa_h_last.*(supISOMxV4_V_last-p.supISOMxV4_iNa_ENa))))+((((-p.supISOMxV4_iK_gK.*supISOMxV4_iK_n_last.^4.*(supISOMxV4_V_last-p.supISOMxV4_iK_EK))))+((-(((p.supISOMxV4_supExV4_iAMPActx_gAMPA.*(supISOMxV4_supExV4_iAMPActx_s_last*p.supISOMxV4_supExV4_iAMPActx_netcon).*(supISOMxV4_V_last-p.supISOMxV4_supExV4_iAMPActx_EAMPA)))))+((((-p.supISOMxV4_supExV4_iNMDActx_gNMDA.*(((1.50265./(1+0.33*exp(supISOMxV4_V_last./(-16)))))).*(supISOMxV4_supExV4_iNMDActx_s_last*p.supISOMxV4_supExV4_iNMDActx_netcon).*(supISOMxV4_V_last-p.supISOMxV4_supExV4_iNMDActx_ENMDA))))+((((-p.supISOMxV4_supIPVxV4_iGABActx_gGABAa.*(supISOMxV4_supIPVxV4_iGABActx_s_last*p.supISOMxV4_supIPVxV4_iGABActx_netcon).*(supISOMxV4_V_last-p.supISOMxV4_supIPVxV4_iGABActx_EGABAa))))+((-(((p.supISOMxV4_midExV4_iAMPActx_gAMPA.*(supISOMxV4_midExV4_iAMPActx_s_last*p.supISOMxV4_midExV4_iAMPActx_netcon).*(supISOMxV4_V_last-p.supISOMxV4_midExV4_iAMPActx_EAMPA)))))+((-(((p.supISOMxV4_deepExV4_iAMPActx_gAMPA.*(supISOMxV4_deepExV4_iAMPActx_s_last*p.supISOMxV4_deepExV4_iAMPActx_netcon).*(supISOMxV4_V_last-p.supISOMxV4_deepExV4_iAMPActx_EAMPA)))))))))))) + p.supISOMxV4_noise*randn(1, p.supISOMxV4_Npop))/p.supISOMxV4_C;
  supISOMxV4_iNa_m_k1 = (((2.5-.1*(supISOMxV4_V_last+65))./(exp(2.5-.1*(supISOMxV4_V_last+65))-1))).*(1-supISOMxV4_iNa_m_last)-((4*exp(-(supISOMxV4_V_last+65)/18))).*supISOMxV4_iNa_m_last;
  supISOMxV4_iNa_h_k1 = ((.07*exp(-(supISOMxV4_V_last+65)/20))).*(1-supISOMxV4_iNa_h_last)-((1./(exp(3-.1*(supISOMxV4_V_last+65))+1))).*supISOMxV4_iNa_h_last;
  supISOMxV4_iK_n_k1 = (((.1-.01*(supISOMxV4_V_last+65))./(exp(1-.1*(supISOMxV4_V_last+65))-1))).*(1-supISOMxV4_iK_n_last)-((.125*exp(-(supISOMxV4_V_last+65)/80))).*supISOMxV4_iK_n_last;
  supIPVxV4_V_k1 = (p.supIPVxV4_Iapp + ((((-p.supIPVxV4_iNa_gNa.*supIPVxV4_iNa_m_last.^3.*supIPVxV4_iNa_h_last.*(supIPVxV4_V_last-p.supIPVxV4_iNa_ENa))))+((((-p.supIPVxV4_iK_gK.*supIPVxV4_iK_n_last.^4.*(supIPVxV4_V_last-p.supIPVxV4_iK_EK))))+((-(((p.supIPVxV4_supExV4_iAMPActx_gAMPA.*(supIPVxV4_supExV4_iAMPActx_s_last*p.supIPVxV4_supExV4_iAMPActx_netcon).*(supIPVxV4_V_last-p.supIPVxV4_supExV4_iAMPActx_EAMPA)))))+((((-p.supIPVxV4_supExV4_iNMDActx_gNMDA.*(((1.50265./(1+0.33*exp(supIPVxV4_V_last./(-16)))))).*(supIPVxV4_supExV4_iNMDActx_s_last*p.supIPVxV4_supExV4_iNMDActx_netcon).*(supIPVxV4_V_last-p.supIPVxV4_supExV4_iNMDActx_ENMDA))))+((((-p.supIPVxV4_supISOMxV4_iGABActx_gGABAa.*(supIPVxV4_supISOMxV4_iGABActx_s_last*p.supIPVxV4_supISOMxV4_iGABActx_netcon).*(supIPVxV4_V_last-p.supIPVxV4_supISOMxV4_iGABActx_EGABAa))))+((-(((p.supIPVxV4_deepExV4_iAMPActx_gAMPA.*(supIPVxV4_deepExV4_iAMPActx_s_last*p.supIPVxV4_deepExV4_iAMPActx_netcon).*(supIPVxV4_V_last-p.supIPVxV4_deepExV4_iAMPActx_EAMPA))))))))))) + p.supIPVxV4_noise*randn(1, p.supIPVxV4_Npop))/p.supIPVxV4_C;
  supIPVxV4_iNa_m_k1 = (((2.5-.1*(supIPVxV4_V_last+65))./(exp(2.5-.1*(supIPVxV4_V_last+65))-1))).*(1-supIPVxV4_iNa_m_last)-((4*exp(-(supIPVxV4_V_last+65)/18))).*supIPVxV4_iNa_m_last;
  supIPVxV4_iNa_h_k1 = ((.07*exp(-(supIPVxV4_V_last+65)/20))).*(1-supIPVxV4_iNa_h_last)-((1./(exp(3-.1*(supIPVxV4_V_last+65))+1))).*supIPVxV4_iNa_h_last;
  supIPVxV4_iK_n_k1 = (((.1-.01*(supIPVxV4_V_last+65))./(exp(1-.1*(supIPVxV4_V_last+65))-1))).*(1-supIPVxV4_iK_n_last)-((.125*exp(-(supIPVxV4_V_last+65)/80))).*supIPVxV4_iK_n_last;
  midExV4_V_k1 = (p.midExV4_Iapp + ((((-p.midExV4_iNa_gNa.*midExV4_iNa_m_last.^3.*midExV4_iNa_h_last.*(midExV4_V_last-p.midExV4_iNa_ENa))))+((((-p.midExV4_iK_gK.*midExV4_iK_n_last.^4.*(midExV4_V_last-p.midExV4_iK_EK))))+((((-p.midExV4_midIPVxV4_iGABActx_gGABAa.*(midExV4_midIPVxV4_iGABActx_s_last*p.midExV4_midIPVxV4_iGABActx_netcon).*(midExV4_V_last-p.midExV4_midIPVxV4_iGABActx_EGABAa))))+((-(((p.midExV4_PreStimuliAxV4_iAMPActx_gAMPA.*(midExV4_PreStimuliAxV4_iAMPActx_s_last*p.midExV4_PreStimuliAxV4_iAMPActx_netcon).*(midExV4_V_last-p.midExV4_PreStimuliAxV4_iAMPActx_EAMPA)))))+((-(((p.midExV4_PostStimuliAxV4_iAMPActx_gAMPA.*(midExV4_PostStimuliAxV4_iAMPActx_s_last*p.midExV4_PostStimuliAxV4_iAMPActx_netcon).*(midExV4_V_last-p.midExV4_PostStimuliAxV4_iAMPActx_EAMPA)))))+((-(((p.midExV4_PreStimuliBxV4_iAMPActx_gAMPA.*(midExV4_PreStimuliBxV4_iAMPActx_s_last*p.midExV4_PreStimuliBxV4_iAMPActx_netcon).*(midExV4_V_last-p.midExV4_PreStimuliBxV4_iAMPActx_EAMPA)))))+((-(((p.midExV4_PostStimuliBxV4_iAMPActx_gAMPA.*(midExV4_PostStimuliBxV4_iAMPActx_s_last*p.midExV4_PostStimuliBxV4_iAMPActx_netcon).*(midExV4_V_last-p.midExV4_PostStimuliBxV4_iAMPActx_EAMPA)))))+((-(((p.midExV4_PreStimuliCxV4_iAMPActx_gAMPA.*(midExV4_PreStimuliCxV4_iAMPActx_s_last*p.midExV4_PreStimuliCxV4_iAMPActx_netcon).*(midExV4_V_last-p.midExV4_PreStimuliCxV4_iAMPActx_EAMPA)))))+((-(((p.midExV4_PostStimuliCxV4_iAMPActx_gAMPA.*(midExV4_PostStimuliCxV4_iAMPActx_s_last*p.midExV4_PostStimuliCxV4_iAMPActx_netcon).*(midExV4_V_last-p.midExV4_PostStimuliCxV4_iAMPActx_EAMPA)))))))))))))) + p.midExV4_noise*randn(1, p.midExV4_Npop))/p.midExV4_C;
  midExV4_iNa_m_k1 = (((2.5-.1*(midExV4_V_last+65))./(exp(2.5-.1*(midExV4_V_last+65))-1))).*(1-midExV4_iNa_m_last)-((4*exp(-(midExV4_V_last+65)/18))).*midExV4_iNa_m_last;
  midExV4_iNa_h_k1 = ((.07*exp(-(midExV4_V_last+65)/20))).*(1-midExV4_iNa_h_last)-((1./(exp(3-.1*(midExV4_V_last+65))+1))).*midExV4_iNa_h_last;
  midExV4_iK_n_k1 = (((.1-.01*(midExV4_V_last+65))./(exp(1-.1*(midExV4_V_last+65))-1))).*(1-midExV4_iK_n_last)-((.125*exp(-(midExV4_V_last+65)/80))).*midExV4_iK_n_last;
  midIPVxV4_V_k1 = (p.midIPVxV4_Iapp + ((((-p.midIPVxV4_iNa_gNa.*midIPVxV4_iNa_m_last.^3.*midIPVxV4_iNa_h_last.*(midIPVxV4_V_last-p.midIPVxV4_iNa_ENa))))+((((-p.midIPVxV4_iK_gK.*midIPVxV4_iK_n_last.^4.*(midIPVxV4_V_last-p.midIPVxV4_iK_EK))))+((-(((p.midIPVxV4_midExV4_iAMPActx_gAMPA.*(midIPVxV4_midExV4_iAMPActx_s_last*p.midIPVxV4_midExV4_iAMPActx_netcon).*(midIPVxV4_V_last-p.midIPVxV4_midExV4_iAMPActx_EAMPA)))))+((((-p.midIPVxV4_deepISOMxV4_iGABActx_gGABAa.*(midIPVxV4_deepISOMxV4_iGABActx_s_last*p.midIPVxV4_deepISOMxV4_iGABActx_netcon).*(midIPVxV4_V_last-p.midIPVxV4_deepISOMxV4_iGABActx_EGABAa)))))))) + p.midIPVxV4_noise*randn(1, p.midIPVxV4_Npop))/p.midIPVxV4_C;
  midIPVxV4_iNa_m_k1 = (((2.5-.1*(midIPVxV4_V_last+65))./(exp(2.5-.1*(midIPVxV4_V_last+65))-1))).*(1-midIPVxV4_iNa_m_last)-((4*exp(-(midIPVxV4_V_last+65)/18))).*midIPVxV4_iNa_m_last;
  midIPVxV4_iNa_h_k1 = ((.07*exp(-(midIPVxV4_V_last+65)/20))).*(1-midIPVxV4_iNa_h_last)-((1./(exp(3-.1*(midIPVxV4_V_last+65))+1))).*midIPVxV4_iNa_h_last;
  midIPVxV4_iK_n_k1 = (((.1-.01*(midIPVxV4_V_last+65))./(exp(1-.1*(midIPVxV4_V_last+65))-1))).*(1-midIPVxV4_iK_n_last)-((.125*exp(-(midIPVxV4_V_last+65)/80))).*midIPVxV4_iK_n_last;
  deepExV4_V_k1 = (p.deepExV4_Iapp + ((((-p.deepExV4_iNa_gNa.*deepExV4_iNa_m_last.^3.*deepExV4_iNa_h_last.*(deepExV4_V_last-p.deepExV4_iNa_ENa))))+((((-p.deepExV4_iK_gK.*deepExV4_iK_n_last.^4.*(deepExV4_V_last-p.deepExV4_iK_EK))))+((((-p.deepExV4_deepISOMxV4_iGABActx_gGABAa.*(deepExV4_deepISOMxV4_iGABActx_s_last*p.deepExV4_deepISOMxV4_iGABActx_netcon).*(deepExV4_V_last-p.deepExV4_deepISOMxV4_iGABActx_EGABAa))))+((((-p.deepExV4_deepIPVxV4_iGABActx_gGABAa.*(deepExV4_deepIPVxV4_iGABActx_s_last*p.deepExV4_deepIPVxV4_iGABActx_netcon).*(deepExV4_V_last-p.deepExV4_deepIPVxV4_iGABActx_EGABAa))))+((-(((p.deepExV4_supExV4_iAMPActx_gAMPA.*(deepExV4_supExV4_iAMPActx_s_last*p.deepExV4_supExV4_iAMPActx_netcon).*(deepExV4_V_last-p.deepExV4_supExV4_iAMPActx_EAMPA)))))+((-(((p.deepExV4_midExV4_iAMPActx_gAMPA.*(deepExV4_midExV4_iAMPActx_s_last*p.deepExV4_midExV4_iAMPActx_netcon).*(deepExV4_V_last-p.deepExV4_midExV4_iAMPActx_EAMPA))))))))))) + p.deepExV4_noise*randn(1, p.deepExV4_Npop))/p.deepExV4_C;
  deepExV4_iNa_m_k1 = (((2.5-.1*(deepExV4_V_last+65))./(exp(2.5-.1*(deepExV4_V_last+65))-1))).*(1-deepExV4_iNa_m_last)-((4*exp(-(deepExV4_V_last+65)/18))).*deepExV4_iNa_m_last;
  deepExV4_iNa_h_k1 = ((.07*exp(-(deepExV4_V_last+65)/20))).*(1-deepExV4_iNa_h_last)-((1./(exp(3-.1*(deepExV4_V_last+65))+1))).*deepExV4_iNa_h_last;
  deepExV4_iK_n_k1 = (((.1-.01*(deepExV4_V_last+65))./(exp(1-.1*(deepExV4_V_last+65))-1))).*(1-deepExV4_iK_n_last)-((.125*exp(-(deepExV4_V_last+65)/80))).*deepExV4_iK_n_last;
  deepISOMxV4_V_k1 = (p.deepISOMxV4_Iapp + ((((-p.deepISOMxV4_iNa_gNa.*deepISOMxV4_iNa_m_last.^3.*deepISOMxV4_iNa_h_last.*(deepISOMxV4_V_last-p.deepISOMxV4_iNa_ENa))))+((((-p.deepISOMxV4_iK_gK.*deepISOMxV4_iK_n_last.^4.*(deepISOMxV4_V_last-p.deepISOMxV4_iK_EK))))+((-(((p.deepISOMxV4_deepExV4_iAMPActx_gAMPA.*(deepISOMxV4_deepExV4_iAMPActx_s_last*p.deepISOMxV4_deepExV4_iAMPActx_netcon).*(deepISOMxV4_V_last-p.deepISOMxV4_deepExV4_iAMPActx_EAMPA)))))+((((-p.deepISOMxV4_deepIPVxV4_iGABActx_gGABAa.*(deepISOMxV4_deepIPVxV4_iGABActx_s_last*p.deepISOMxV4_deepIPVxV4_iGABActx_netcon).*(deepISOMxV4_V_last-p.deepISOMxV4_deepIPVxV4_iGABActx_EGABAa)))))))) + p.deepISOMxV4_noise*randn(1, p.deepISOMxV4_Npop))/p.deepISOMxV4_C;
  deepISOMxV4_iNa_m_k1 = (((2.5-.1*(deepISOMxV4_V_last+65))./(exp(2.5-.1*(deepISOMxV4_V_last+65))-1))).*(1-deepISOMxV4_iNa_m_last)-((4*exp(-(deepISOMxV4_V_last+65)/18))).*deepISOMxV4_iNa_m_last;
  deepISOMxV4_iNa_h_k1 = ((.07*exp(-(deepISOMxV4_V_last+65)/20))).*(1-deepISOMxV4_iNa_h_last)-((1./(exp(3-.1*(deepISOMxV4_V_last+65))+1))).*deepISOMxV4_iNa_h_last;
  deepISOMxV4_iK_n_k1 = (((.1-.01*(deepISOMxV4_V_last+65))./(exp(1-.1*(deepISOMxV4_V_last+65))-1))).*(1-deepISOMxV4_iK_n_last)-((.125*exp(-(deepISOMxV4_V_last+65)/80))).*deepISOMxV4_iK_n_last;
  deepIPVxV4_V_k1 = (p.deepIPVxV4_Iapp + ((((-p.deepIPVxV4_iNa_gNa.*deepIPVxV4_iNa_m_last.^3.*deepIPVxV4_iNa_h_last.*(deepIPVxV4_V_last-p.deepIPVxV4_iNa_ENa))))+((((-p.deepIPVxV4_iK_gK.*deepIPVxV4_iK_n_last.^4.*(deepIPVxV4_V_last-p.deepIPVxV4_iK_EK))))+((-(((p.deepIPVxV4_deepExV4_iAMPActx_gAMPA.*(deepIPVxV4_deepExV4_iAMPActx_s_last*p.deepIPVxV4_deepExV4_iAMPActx_netcon).*(deepIPVxV4_V_last-p.deepIPVxV4_deepExV4_iAMPActx_EAMPA)))))+((((-p.deepIPVxV4_deepISOMxV4_iGABActx_gGABAa.*(deepIPVxV4_deepISOMxV4_iGABActx_s_last*p.deepIPVxV4_deepISOMxV4_iGABActx_netcon).*(deepIPVxV4_V_last-p.deepIPVxV4_deepISOMxV4_iGABActx_EGABAa))))+((-(((p.deepIPVxV4_midExV4_iAMPActx_gAMPA.*(deepIPVxV4_midExV4_iAMPActx_s_last*p.deepIPVxV4_midExV4_iAMPActx_netcon).*(deepIPVxV4_V_last-p.deepIPVxV4_midExV4_iAMPActx_EAMPA)))))))))) + p.deepIPVxV4_noise*randn(1, p.deepIPVxV4_Npop))/p.deepIPVxV4_C;
  deepIPVxV4_iNa_m_k1 = (((2.5-.1*(deepIPVxV4_V_last+65))./(exp(2.5-.1*(deepIPVxV4_V_last+65))-1))).*(1-deepIPVxV4_iNa_m_last)-((4*exp(-(deepIPVxV4_V_last+65)/18))).*deepIPVxV4_iNa_m_last;
  deepIPVxV4_iNa_h_k1 = ((.07*exp(-(deepIPVxV4_V_last+65)/20))).*(1-deepIPVxV4_iNa_h_last)-((1./(exp(3-.1*(deepIPVxV4_V_last+65))+1))).*deepIPVxV4_iNa_h_last;
  deepIPVxV4_iK_n_k1 = (((.1-.01*(deepIPVxV4_V_last+65))./(exp(1-.1*(deepIPVxV4_V_last+65))-1))).*(1-deepIPVxV4_iK_n_last)-((.125*exp(-(deepIPVxV4_V_last+65)/80))).*deepIPVxV4_iK_n_last;
  PreStimuliAxV4_V_k1 = (rand(1) + 4.5)*(20*(exp(- (t - p.PreStimuliAxV4_t1).^2) - exp(- (t - p.PreStimuliAxV4_t2).^2)) + p.PreStimuliAxV4_noise*randn(1, p.PreStimuliAxV4_Npop))/p.PreStimuliAxV4_C;
  PreStimuliAxV4_iNa_m_k1 = (((2.5-.1*(PreStimuliAxV4_V_last+65))./(exp(2.5-.1*(PreStimuliAxV4_V_last+65))-1))).*(1-PreStimuliAxV4_iNa_m_last)-((4*exp(-(PreStimuliAxV4_V_last+65)/18))).*PreStimuliAxV4_iNa_m_last;
  PreStimuliAxV4_iNa_h_k1 = ((.07*exp(-(PreStimuliAxV4_V_last+65)/20))).*(1-PreStimuliAxV4_iNa_h_last)-((1./(exp(3-.1*(PreStimuliAxV4_V_last+65))+1))).*PreStimuliAxV4_iNa_h_last;
  PreStimuliAxV4_iK_n_k1 = (((.1-.01*(PreStimuliAxV4_V_last+65))./(exp(1-.1*(PreStimuliAxV4_V_last+65))-1))).*(1-PreStimuliAxV4_iK_n_last)-((.125*exp(-(PreStimuliAxV4_V_last+65)/80))).*PreStimuliAxV4_iK_n_last;
  PostStimuliAxV4_V_k1 = (rand(1) + 4.5)*(20*(exp(- (t - p.PostStimuliAxV4_t1).^2) - exp(- (t - p.PostStimuliAxV4_t2).^2)) + p.PostStimuliAxV4_noise*randn(1, p.PostStimuliAxV4_Npop))/p.PostStimuliAxV4_C;
  PostStimuliAxV4_iNa_m_k1 = (((2.5-.1*(PostStimuliAxV4_V_last+65))./(exp(2.5-.1*(PostStimuliAxV4_V_last+65))-1))).*(1-PostStimuliAxV4_iNa_m_last)-((4*exp(-(PostStimuliAxV4_V_last+65)/18))).*PostStimuliAxV4_iNa_m_last;
  PostStimuliAxV4_iNa_h_k1 = ((.07*exp(-(PostStimuliAxV4_V_last+65)/20))).*(1-PostStimuliAxV4_iNa_h_last)-((1./(exp(3-.1*(PostStimuliAxV4_V_last+65))+1))).*PostStimuliAxV4_iNa_h_last;
  PostStimuliAxV4_iK_n_k1 = (((.1-.01*(PostStimuliAxV4_V_last+65))./(exp(1-.1*(PostStimuliAxV4_V_last+65))-1))).*(1-PostStimuliAxV4_iK_n_last)-((.125*exp(-(PostStimuliAxV4_V_last+65)/80))).*PostStimuliAxV4_iK_n_last;
  PreStimuliBxV4_V_k1 = (rand(1) + 4.5)*(20*(exp(- (t - p.PreStimuliBxV4_t1).^2) - exp(- (t - p.PreStimuliBxV4_t2).^2)) + p.PreStimuliBxV4_noise*randn(1, p.PreStimuliBxV4_Npop))/p.PreStimuliBxV4_C;
  PreStimuliBxV4_iNa_m_k1 = (((2.5-.1*(PreStimuliBxV4_V_last+65))./(exp(2.5-.1*(PreStimuliBxV4_V_last+65))-1))).*(1-PreStimuliBxV4_iNa_m_last)-((4*exp(-(PreStimuliBxV4_V_last+65)/18))).*PreStimuliBxV4_iNa_m_last;
  PreStimuliBxV4_iNa_h_k1 = ((.07*exp(-(PreStimuliBxV4_V_last+65)/20))).*(1-PreStimuliBxV4_iNa_h_last)-((1./(exp(3-.1*(PreStimuliBxV4_V_last+65))+1))).*PreStimuliBxV4_iNa_h_last;
  PreStimuliBxV4_iK_n_k1 = (((.1-.01*(PreStimuliBxV4_V_last+65))./(exp(1-.1*(PreStimuliBxV4_V_last+65))-1))).*(1-PreStimuliBxV4_iK_n_last)-((.125*exp(-(PreStimuliBxV4_V_last+65)/80))).*PreStimuliBxV4_iK_n_last;
  PostStimuliBxV4_V_k1 = (rand(1) + 4.5)*(20*(exp(- (t - p.PostStimuliBxV4_t1).^2) - exp(- (t - p.PostStimuliBxV4_t2).^2)) + p.PostStimuliBxV4_noise*randn(1, p.PostStimuliBxV4_Npop))/p.PostStimuliBxV4_C;
  PostStimuliBxV4_iNa_m_k1 = (((2.5-.1*(PostStimuliBxV4_V_last+65))./(exp(2.5-.1*(PostStimuliBxV4_V_last+65))-1))).*(1-PostStimuliBxV4_iNa_m_last)-((4*exp(-(PostStimuliBxV4_V_last+65)/18))).*PostStimuliBxV4_iNa_m_last;
  PostStimuliBxV4_iNa_h_k1 = ((.07*exp(-(PostStimuliBxV4_V_last+65)/20))).*(1-PostStimuliBxV4_iNa_h_last)-((1./(exp(3-.1*(PostStimuliBxV4_V_last+65))+1))).*PostStimuliBxV4_iNa_h_last;
  PostStimuliBxV4_iK_n_k1 = (((.1-.01*(PostStimuliBxV4_V_last+65))./(exp(1-.1*(PostStimuliBxV4_V_last+65))-1))).*(1-PostStimuliBxV4_iK_n_last)-((.125*exp(-(PostStimuliBxV4_V_last+65)/80))).*PostStimuliBxV4_iK_n_last;
  PreStimuliCxV4_V_k1 = (rand(1) + 4.5)*(20*(exp(- (t - p.PreStimuliCxV4_t1).^2) - exp(- (t - p.PreStimuliCxV4_t2).^2)) + p.PreStimuliCxV4_noise*randn(1, p.PreStimuliCxV4_Npop))/p.PreStimuliCxV4_C;
  PreStimuliCxV4_iNa_m_k1 = (((2.5-.1*(PreStimuliCxV4_V_last+65))./(exp(2.5-.1*(PreStimuliCxV4_V_last+65))-1))).*(1-PreStimuliCxV4_iNa_m_last)-((4*exp(-(PreStimuliCxV4_V_last+65)/18))).*PreStimuliCxV4_iNa_m_last;
  PreStimuliCxV4_iNa_h_k1 = ((.07*exp(-(PreStimuliCxV4_V_last+65)/20))).*(1-PreStimuliCxV4_iNa_h_last)-((1./(exp(3-.1*(PreStimuliCxV4_V_last+65))+1))).*PreStimuliCxV4_iNa_h_last;
  PreStimuliCxV4_iK_n_k1 = (((.1-.01*(PreStimuliCxV4_V_last+65))./(exp(1-.1*(PreStimuliCxV4_V_last+65))-1))).*(1-PreStimuliCxV4_iK_n_last)-((.125*exp(-(PreStimuliCxV4_V_last+65)/80))).*PreStimuliCxV4_iK_n_last;
  PostStimuliCxV4_V_k1 = (rand(1) + 4.5)*(20*(exp(- (t - p.PostStimuliCxV4_t1).^2) - exp(- (t - p.PostStimuliCxV4_t2).^2)) + p.PostStimuliCxV4_noise*randn(1, p.PostStimuliCxV4_Npop))/p.PostStimuliCxV4_C;
  PostStimuliCxV4_iNa_m_k1 = (((2.5-.1*(PostStimuliCxV4_V_last+65))./(exp(2.5-.1*(PostStimuliCxV4_V_last+65))-1))).*(1-PostStimuliCxV4_iNa_m_last)-((4*exp(-(PostStimuliCxV4_V_last+65)/18))).*PostStimuliCxV4_iNa_m_last;
  PostStimuliCxV4_iNa_h_k1 = ((.07*exp(-(PostStimuliCxV4_V_last+65)/20))).*(1-PostStimuliCxV4_iNa_h_last)-((1./(exp(3-.1*(PostStimuliCxV4_V_last+65))+1))).*PostStimuliCxV4_iNa_h_last;
  PostStimuliCxV4_iK_n_k1 = (((.1-.01*(PostStimuliCxV4_V_last+65))./(exp(1-.1*(PostStimuliCxV4_V_last+65))-1))).*(1-PostStimuliCxV4_iK_n_last)-((.125*exp(-(PostStimuliCxV4_V_last+65)/80))).*PostStimuliCxV4_iK_n_last;
  supISOMxV4_supExV4_iAMPActx_s_k1 = -supISOMxV4_supExV4_iAMPActx_s_last./p.supISOMxV4_supExV4_iAMPActx_tauAMPA + ((1-supISOMxV4_supExV4_iAMPActx_s_last)/p.supISOMxV4_supExV4_iAMPActx_tauAMPAr).*(1+tanh(supExV4_V_last/10));
  supIPVxV4_supExV4_iAMPActx_s_k1 = -supIPVxV4_supExV4_iAMPActx_s_last./p.supIPVxV4_supExV4_iAMPActx_tauAMPA + ((1-supIPVxV4_supExV4_iAMPActx_s_last)/p.supIPVxV4_supExV4_iAMPActx_tauAMPAr).*(1+tanh(supExV4_V_last/10));
  supISOMxV4_supExV4_iNMDActx_s_k1 = ((p.supISOMxV4_supExV4_iNMDActx_Tmax./(1+exp(-((supExV4_V_last)-p.supISOMxV4_supExV4_iNMDActx_Vpp)/p.supISOMxV4_supExV4_iNMDActx_Kp)))).*(1-supISOMxV4_supExV4_iNMDActx_s_last)/p.supISOMxV4_supExV4_iNMDActx_tauNMDAr-supISOMxV4_supExV4_iNMDActx_s_last/p.supISOMxV4_supExV4_iNMDActx_tauNMDA;
  supIPVxV4_supExV4_iNMDActx_s_k1 = ((p.supIPVxV4_supExV4_iNMDActx_Tmax./(1+exp(-((supExV4_V_last)-p.supIPVxV4_supExV4_iNMDActx_Vpp)/p.supIPVxV4_supExV4_iNMDActx_Kp)))).*(1-supIPVxV4_supExV4_iNMDActx_s_last)/p.supIPVxV4_supExV4_iNMDActx_tauNMDAr-supIPVxV4_supExV4_iNMDActx_s_last/p.supIPVxV4_supExV4_iNMDActx_tauNMDA;
  supExV4_supISOMxV4_iGABActx_s_k1 = -supExV4_supISOMxV4_iGABActx_s_last./p.supExV4_supISOMxV4_iGABActx_tauGABA + 1/2*(1+tanh(supISOMxV4_V_last/10)).*((1-supExV4_supISOMxV4_iGABActx_s_last)/p.supExV4_supISOMxV4_iGABActx_tauGABAr);
  supIPVxV4_supISOMxV4_iGABActx_s_k1 = -supIPVxV4_supISOMxV4_iGABActx_s_last./p.supIPVxV4_supISOMxV4_iGABActx_tauGABA + 1/2*(1+tanh(supISOMxV4_V_last/10)).*((1-supIPVxV4_supISOMxV4_iGABActx_s_last)/p.supIPVxV4_supISOMxV4_iGABActx_tauGABAr);
  supExV4_supIPVxV4_iGABActx_s_k1 = -supExV4_supIPVxV4_iGABActx_s_last./p.supExV4_supIPVxV4_iGABActx_tauGABA + 1/2*(1+tanh(supIPVxV4_V_last/10)).*((1-supExV4_supIPVxV4_iGABActx_s_last)/p.supExV4_supIPVxV4_iGABActx_tauGABAr);
  supISOMxV4_supIPVxV4_iGABActx_s_k1 = -supISOMxV4_supIPVxV4_iGABActx_s_last./p.supISOMxV4_supIPVxV4_iGABActx_tauGABA + 1/2*(1+tanh(supIPVxV4_V_last/10)).*((1-supISOMxV4_supIPVxV4_iGABActx_s_last)/p.supISOMxV4_supIPVxV4_iGABActx_tauGABAr);
  midIPVxV4_midExV4_iAMPActx_s_k1 = -midIPVxV4_midExV4_iAMPActx_s_last./p.midIPVxV4_midExV4_iAMPActx_tauAMPA + ((1-midIPVxV4_midExV4_iAMPActx_s_last)/p.midIPVxV4_midExV4_iAMPActx_tauAMPAr).*(1+tanh(midExV4_V_last/10));
  midExV4_midIPVxV4_iGABActx_s_k1 = -midExV4_midIPVxV4_iGABActx_s_last./p.midExV4_midIPVxV4_iGABActx_tauGABA + 1/2*(1+tanh(midIPVxV4_V_last/10)).*((1-midExV4_midIPVxV4_iGABActx_s_last)/p.midExV4_midIPVxV4_iGABActx_tauGABAr);
  deepISOMxV4_deepExV4_iAMPActx_s_k1 = -deepISOMxV4_deepExV4_iAMPActx_s_last./p.deepISOMxV4_deepExV4_iAMPActx_tauAMPA + ((1-deepISOMxV4_deepExV4_iAMPActx_s_last)/p.deepISOMxV4_deepExV4_iAMPActx_tauAMPAr).*(1+tanh(deepExV4_V_last/10));
  deepIPVxV4_deepExV4_iAMPActx_s_k1 = -deepIPVxV4_deepExV4_iAMPActx_s_last./p.deepIPVxV4_deepExV4_iAMPActx_tauAMPA + ((1-deepIPVxV4_deepExV4_iAMPActx_s_last)/p.deepIPVxV4_deepExV4_iAMPActx_tauAMPAr).*(1+tanh(deepExV4_V_last/10));
  deepExV4_deepISOMxV4_iGABActx_s_k1 = -deepExV4_deepISOMxV4_iGABActx_s_last./p.deepExV4_deepISOMxV4_iGABActx_tauGABA + 1/2*(1+tanh(deepISOMxV4_V_last/10)).*((1-deepExV4_deepISOMxV4_iGABActx_s_last)/p.deepExV4_deepISOMxV4_iGABActx_tauGABAr);
  deepIPVxV4_deepISOMxV4_iGABActx_s_k1 = -deepIPVxV4_deepISOMxV4_iGABActx_s_last./p.deepIPVxV4_deepISOMxV4_iGABActx_tauGABA + 1/2*(1+tanh(deepISOMxV4_V_last/10)).*((1-deepIPVxV4_deepISOMxV4_iGABActx_s_last)/p.deepIPVxV4_deepISOMxV4_iGABActx_tauGABAr);
  deepExV4_deepIPVxV4_iGABActx_s_k1 = -deepExV4_deepIPVxV4_iGABActx_s_last./p.deepExV4_deepIPVxV4_iGABActx_tauGABA + 1/2*(1+tanh(deepIPVxV4_V_last/10)).*((1-deepExV4_deepIPVxV4_iGABActx_s_last)/p.deepExV4_deepIPVxV4_iGABActx_tauGABAr);
  deepISOMxV4_deepIPVxV4_iGABActx_s_k1 = -deepISOMxV4_deepIPVxV4_iGABActx_s_last./p.deepISOMxV4_deepIPVxV4_iGABActx_tauGABA + 1/2*(1+tanh(deepIPVxV4_V_last/10)).*((1-deepISOMxV4_deepIPVxV4_iGABActx_s_last)/p.deepISOMxV4_deepIPVxV4_iGABActx_tauGABAr);
  PostStimuliAxV4_PreStimuliAxV4_iAMPActx_s_k1 = -PostStimuliAxV4_PreStimuliAxV4_iAMPActx_s_last./p.PostStimuliAxV4_PreStimuliAxV4_iAMPActx_tauAMPA + ((1-PostStimuliAxV4_PreStimuliAxV4_iAMPActx_s_last)/p.PostStimuliAxV4_PreStimuliAxV4_iAMPActx_tauAMPAr).*(1+tanh(PreStimuliAxV4_V_last/10));
  PostStimuliBxV4_PreStimuliBxV4_iAMPActx_s_k1 = -PostStimuliBxV4_PreStimuliBxV4_iAMPActx_s_last./p.PostStimuliBxV4_PreStimuliBxV4_iAMPActx_tauAMPA + ((1-PostStimuliBxV4_PreStimuliBxV4_iAMPActx_s_last)/p.PostStimuliBxV4_PreStimuliBxV4_iAMPActx_tauAMPAr).*(1+tanh(PreStimuliBxV4_V_last/10));
  PostStimuliCxV4_PreStimuliCxV4_iAMPActx_s_k1 = -PostStimuliCxV4_PreStimuliCxV4_iAMPActx_s_last./p.PostStimuliCxV4_PreStimuliCxV4_iAMPActx_tauAMPA + ((1-PostStimuliCxV4_PreStimuliCxV4_iAMPActx_s_last)/p.PostStimuliCxV4_PreStimuliCxV4_iAMPActx_tauAMPAr).*(1+tanh(PreStimuliCxV4_V_last/10));
  midExV4_PreStimuliAxV4_iAMPActx_s_k1 = -midExV4_PreStimuliAxV4_iAMPActx_s_last./p.midExV4_PreStimuliAxV4_iAMPActx_tauAMPA + ((1-midExV4_PreStimuliAxV4_iAMPActx_s_last)/p.midExV4_PreStimuliAxV4_iAMPActx_tauAMPAr).*(1+tanh(PreStimuliAxV4_V_last/10));
  midExV4_PostStimuliAxV4_iAMPActx_s_k1 = -midExV4_PostStimuliAxV4_iAMPActx_s_last./p.midExV4_PostStimuliAxV4_iAMPActx_tauAMPA + ((1-midExV4_PostStimuliAxV4_iAMPActx_s_last)/p.midExV4_PostStimuliAxV4_iAMPActx_tauAMPAr).*(1+tanh(PostStimuliAxV4_V_last/10));
  midExV4_PreStimuliBxV4_iAMPActx_s_k1 = -midExV4_PreStimuliBxV4_iAMPActx_s_last./p.midExV4_PreStimuliBxV4_iAMPActx_tauAMPA + ((1-midExV4_PreStimuliBxV4_iAMPActx_s_last)/p.midExV4_PreStimuliBxV4_iAMPActx_tauAMPAr).*(1+tanh(PreStimuliBxV4_V_last/10));
  midExV4_PostStimuliBxV4_iAMPActx_s_k1 = -midExV4_PostStimuliBxV4_iAMPActx_s_last./p.midExV4_PostStimuliBxV4_iAMPActx_tauAMPA + ((1-midExV4_PostStimuliBxV4_iAMPActx_s_last)/p.midExV4_PostStimuliBxV4_iAMPActx_tauAMPAr).*(1+tanh(PostStimuliBxV4_V_last/10));
  midExV4_PreStimuliCxV4_iAMPActx_s_k1 = -midExV4_PreStimuliCxV4_iAMPActx_s_last./p.midExV4_PreStimuliCxV4_iAMPActx_tauAMPA + ((1-midExV4_PreStimuliCxV4_iAMPActx_s_last)/p.midExV4_PreStimuliCxV4_iAMPActx_tauAMPAr).*(1+tanh(PreStimuliCxV4_V_last/10));
  midExV4_PostStimuliCxV4_iAMPActx_s_k1 = -midExV4_PostStimuliCxV4_iAMPActx_s_last./p.midExV4_PostStimuliCxV4_iAMPActx_tauAMPA + ((1-midExV4_PostStimuliCxV4_iAMPActx_s_last)/p.midExV4_PostStimuliCxV4_iAMPActx_tauAMPAr).*(1+tanh(PostStimuliCxV4_V_last/10));
  deepExV4_supExV4_iAMPActx_s_k1 = -deepExV4_supExV4_iAMPActx_s_last./p.deepExV4_supExV4_iAMPActx_tauAMPA + ((1-deepExV4_supExV4_iAMPActx_s_last)/p.deepExV4_supExV4_iAMPActx_tauAMPAr).*(1+tanh(supExV4_V_last/10));
  supISOMxV4_midExV4_iAMPActx_s_k1 = -supISOMxV4_midExV4_iAMPActx_s_last./p.supISOMxV4_midExV4_iAMPActx_tauAMPA + ((1-supISOMxV4_midExV4_iAMPActx_s_last)/p.supISOMxV4_midExV4_iAMPActx_tauAMPAr).*(1+tanh(midExV4_V_last/10));
  supExV4_midExV4_iAMPActx_s_k1 = -supExV4_midExV4_iAMPActx_s_last./p.supExV4_midExV4_iAMPActx_tauAMPA + ((1-supExV4_midExV4_iAMPActx_s_last)/p.supExV4_midExV4_iAMPActx_tauAMPAr).*(1+tanh(midExV4_V_last/10));
  deepExV4_midExV4_iAMPActx_s_k1 = -deepExV4_midExV4_iAMPActx_s_last./p.deepExV4_midExV4_iAMPActx_tauAMPA + ((1-deepExV4_midExV4_iAMPActx_s_last)/p.deepExV4_midExV4_iAMPActx_tauAMPAr).*(1+tanh(midExV4_V_last/10));
  deepIPVxV4_midExV4_iAMPActx_s_k1 = -deepIPVxV4_midExV4_iAMPActx_s_last./p.deepIPVxV4_midExV4_iAMPActx_tauAMPA + ((1-deepIPVxV4_midExV4_iAMPActx_s_last)/p.deepIPVxV4_midExV4_iAMPActx_tauAMPAr).*(1+tanh(midExV4_V_last/10));
  supExV4_midIPVxV4_iGABActx_s_k1 = -supExV4_midIPVxV4_iGABActx_s_last./p.supExV4_midIPVxV4_iGABActx_tauGABA + 1/2*(1+tanh(midIPVxV4_V_last/10)).*((1-supExV4_midIPVxV4_iGABActx_s_last)/p.supExV4_midIPVxV4_iGABActx_tauGABAr);
  supISOMxV4_deepExV4_iAMPActx_s_k1 = -supISOMxV4_deepExV4_iAMPActx_s_last./p.supISOMxV4_deepExV4_iAMPActx_tauAMPA + ((1-supISOMxV4_deepExV4_iAMPActx_s_last)/p.supISOMxV4_deepExV4_iAMPActx_tauAMPAr).*(1+tanh(deepExV4_V_last/10));
  supIPVxV4_deepExV4_iAMPActx_s_k1 = -supIPVxV4_deepExV4_iAMPActx_s_last./p.supIPVxV4_deepExV4_iAMPActx_tauAMPA + ((1-supIPVxV4_deepExV4_iAMPActx_s_last)/p.supIPVxV4_deepExV4_iAMPActx_tauAMPAr).*(1+tanh(deepExV4_V_last/10));
  midIPVxV4_deepISOMxV4_iGABActx_s_k1 = -midIPVxV4_deepISOMxV4_iGABActx_s_last./p.midIPVxV4_deepISOMxV4_iGABActx_tauGABA + 1/2*(1+tanh(deepISOMxV4_V_last/10)).*((1-midIPVxV4_deepISOMxV4_iGABActx_s_last)/p.midIPVxV4_deepISOMxV4_iGABActx_tauGABAr);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  supExV4_V_last = supExV4_V_last+dt*supExV4_V_k1;
  supExV4_iNa_m_last = supExV4_iNa_m_last+dt*supExV4_iNa_m_k1;
  supExV4_iNa_h_last = supExV4_iNa_h_last+dt*supExV4_iNa_h_k1;
  supExV4_iK_n_last = supExV4_iK_n_last+dt*supExV4_iK_n_k1;
  supISOMxV4_V_last = supISOMxV4_V_last+dt*supISOMxV4_V_k1;
  supISOMxV4_iNa_m_last = supISOMxV4_iNa_m_last+dt*supISOMxV4_iNa_m_k1;
  supISOMxV4_iNa_h_last = supISOMxV4_iNa_h_last+dt*supISOMxV4_iNa_h_k1;
  supISOMxV4_iK_n_last = supISOMxV4_iK_n_last+dt*supISOMxV4_iK_n_k1;
  supIPVxV4_V_last = supIPVxV4_V_last+dt*supIPVxV4_V_k1;
  supIPVxV4_iNa_m_last = supIPVxV4_iNa_m_last+dt*supIPVxV4_iNa_m_k1;
  supIPVxV4_iNa_h_last = supIPVxV4_iNa_h_last+dt*supIPVxV4_iNa_h_k1;
  supIPVxV4_iK_n_last = supIPVxV4_iK_n_last+dt*supIPVxV4_iK_n_k1;
  midExV4_V_last = midExV4_V_last+dt*midExV4_V_k1;
  midExV4_iNa_m_last = midExV4_iNa_m_last+dt*midExV4_iNa_m_k1;
  midExV4_iNa_h_last = midExV4_iNa_h_last+dt*midExV4_iNa_h_k1;
  midExV4_iK_n_last = midExV4_iK_n_last+dt*midExV4_iK_n_k1;
  midIPVxV4_V_last = midIPVxV4_V_last+dt*midIPVxV4_V_k1;
  midIPVxV4_iNa_m_last = midIPVxV4_iNa_m_last+dt*midIPVxV4_iNa_m_k1;
  midIPVxV4_iNa_h_last = midIPVxV4_iNa_h_last+dt*midIPVxV4_iNa_h_k1;
  midIPVxV4_iK_n_last = midIPVxV4_iK_n_last+dt*midIPVxV4_iK_n_k1;
  deepExV4_V_last = deepExV4_V_last+dt*deepExV4_V_k1;
  deepExV4_iNa_m_last = deepExV4_iNa_m_last+dt*deepExV4_iNa_m_k1;
  deepExV4_iNa_h_last = deepExV4_iNa_h_last+dt*deepExV4_iNa_h_k1;
  deepExV4_iK_n_last = deepExV4_iK_n_last+dt*deepExV4_iK_n_k1;
  deepISOMxV4_V_last = deepISOMxV4_V_last+dt*deepISOMxV4_V_k1;
  deepISOMxV4_iNa_m_last = deepISOMxV4_iNa_m_last+dt*deepISOMxV4_iNa_m_k1;
  deepISOMxV4_iNa_h_last = deepISOMxV4_iNa_h_last+dt*deepISOMxV4_iNa_h_k1;
  deepISOMxV4_iK_n_last = deepISOMxV4_iK_n_last+dt*deepISOMxV4_iK_n_k1;
  deepIPVxV4_V_last = deepIPVxV4_V_last+dt*deepIPVxV4_V_k1;
  deepIPVxV4_iNa_m_last = deepIPVxV4_iNa_m_last+dt*deepIPVxV4_iNa_m_k1;
  deepIPVxV4_iNa_h_last = deepIPVxV4_iNa_h_last+dt*deepIPVxV4_iNa_h_k1;
  deepIPVxV4_iK_n_last = deepIPVxV4_iK_n_last+dt*deepIPVxV4_iK_n_k1;
  PreStimuliAxV4_V_last = PreStimuliAxV4_V_last+dt*PreStimuliAxV4_V_k1;
  PreStimuliAxV4_iNa_m_last = PreStimuliAxV4_iNa_m_last+dt*PreStimuliAxV4_iNa_m_k1;
  PreStimuliAxV4_iNa_h_last = PreStimuliAxV4_iNa_h_last+dt*PreStimuliAxV4_iNa_h_k1;
  PreStimuliAxV4_iK_n_last = PreStimuliAxV4_iK_n_last+dt*PreStimuliAxV4_iK_n_k1;
  PostStimuliAxV4_V_last = PostStimuliAxV4_V_last+dt*PostStimuliAxV4_V_k1;
  PostStimuliAxV4_iNa_m_last = PostStimuliAxV4_iNa_m_last+dt*PostStimuliAxV4_iNa_m_k1;
  PostStimuliAxV4_iNa_h_last = PostStimuliAxV4_iNa_h_last+dt*PostStimuliAxV4_iNa_h_k1;
  PostStimuliAxV4_iK_n_last = PostStimuliAxV4_iK_n_last+dt*PostStimuliAxV4_iK_n_k1;
  PreStimuliBxV4_V_last = PreStimuliBxV4_V_last+dt*PreStimuliBxV4_V_k1;
  PreStimuliBxV4_iNa_m_last = PreStimuliBxV4_iNa_m_last+dt*PreStimuliBxV4_iNa_m_k1;
  PreStimuliBxV4_iNa_h_last = PreStimuliBxV4_iNa_h_last+dt*PreStimuliBxV4_iNa_h_k1;
  PreStimuliBxV4_iK_n_last = PreStimuliBxV4_iK_n_last+dt*PreStimuliBxV4_iK_n_k1;
  PostStimuliBxV4_V_last = PostStimuliBxV4_V_last+dt*PostStimuliBxV4_V_k1;
  PostStimuliBxV4_iNa_m_last = PostStimuliBxV4_iNa_m_last+dt*PostStimuliBxV4_iNa_m_k1;
  PostStimuliBxV4_iNa_h_last = PostStimuliBxV4_iNa_h_last+dt*PostStimuliBxV4_iNa_h_k1;
  PostStimuliBxV4_iK_n_last = PostStimuliBxV4_iK_n_last+dt*PostStimuliBxV4_iK_n_k1;
  PreStimuliCxV4_V_last = PreStimuliCxV4_V_last+dt*PreStimuliCxV4_V_k1;
  PreStimuliCxV4_iNa_m_last = PreStimuliCxV4_iNa_m_last+dt*PreStimuliCxV4_iNa_m_k1;
  PreStimuliCxV4_iNa_h_last = PreStimuliCxV4_iNa_h_last+dt*PreStimuliCxV4_iNa_h_k1;
  PreStimuliCxV4_iK_n_last = PreStimuliCxV4_iK_n_last+dt*PreStimuliCxV4_iK_n_k1;
  PostStimuliCxV4_V_last = PostStimuliCxV4_V_last+dt*PostStimuliCxV4_V_k1;
  PostStimuliCxV4_iNa_m_last = PostStimuliCxV4_iNa_m_last+dt*PostStimuliCxV4_iNa_m_k1;
  PostStimuliCxV4_iNa_h_last = PostStimuliCxV4_iNa_h_last+dt*PostStimuliCxV4_iNa_h_k1;
  PostStimuliCxV4_iK_n_last = PostStimuliCxV4_iK_n_last+dt*PostStimuliCxV4_iK_n_k1;
  supISOMxV4_supExV4_iAMPActx_s_last = supISOMxV4_supExV4_iAMPActx_s_last+dt*supISOMxV4_supExV4_iAMPActx_s_k1;
  supIPVxV4_supExV4_iAMPActx_s_last = supIPVxV4_supExV4_iAMPActx_s_last+dt*supIPVxV4_supExV4_iAMPActx_s_k1;
  supISOMxV4_supExV4_iNMDActx_s_last = supISOMxV4_supExV4_iNMDActx_s_last+dt*supISOMxV4_supExV4_iNMDActx_s_k1;
  supIPVxV4_supExV4_iNMDActx_s_last = supIPVxV4_supExV4_iNMDActx_s_last+dt*supIPVxV4_supExV4_iNMDActx_s_k1;
  supExV4_supISOMxV4_iGABActx_s_last = supExV4_supISOMxV4_iGABActx_s_last+dt*supExV4_supISOMxV4_iGABActx_s_k1;
  supIPVxV4_supISOMxV4_iGABActx_s_last = supIPVxV4_supISOMxV4_iGABActx_s_last+dt*supIPVxV4_supISOMxV4_iGABActx_s_k1;
  supExV4_supIPVxV4_iGABActx_s_last = supExV4_supIPVxV4_iGABActx_s_last+dt*supExV4_supIPVxV4_iGABActx_s_k1;
  supISOMxV4_supIPVxV4_iGABActx_s_last = supISOMxV4_supIPVxV4_iGABActx_s_last+dt*supISOMxV4_supIPVxV4_iGABActx_s_k1;
  midIPVxV4_midExV4_iAMPActx_s_last = midIPVxV4_midExV4_iAMPActx_s_last+dt*midIPVxV4_midExV4_iAMPActx_s_k1;
  midExV4_midIPVxV4_iGABActx_s_last = midExV4_midIPVxV4_iGABActx_s_last+dt*midExV4_midIPVxV4_iGABActx_s_k1;
  deepISOMxV4_deepExV4_iAMPActx_s_last = deepISOMxV4_deepExV4_iAMPActx_s_last+dt*deepISOMxV4_deepExV4_iAMPActx_s_k1;
  deepIPVxV4_deepExV4_iAMPActx_s_last = deepIPVxV4_deepExV4_iAMPActx_s_last+dt*deepIPVxV4_deepExV4_iAMPActx_s_k1;
  deepExV4_deepISOMxV4_iGABActx_s_last = deepExV4_deepISOMxV4_iGABActx_s_last+dt*deepExV4_deepISOMxV4_iGABActx_s_k1;
  deepIPVxV4_deepISOMxV4_iGABActx_s_last = deepIPVxV4_deepISOMxV4_iGABActx_s_last+dt*deepIPVxV4_deepISOMxV4_iGABActx_s_k1;
  deepExV4_deepIPVxV4_iGABActx_s_last = deepExV4_deepIPVxV4_iGABActx_s_last+dt*deepExV4_deepIPVxV4_iGABActx_s_k1;
  deepISOMxV4_deepIPVxV4_iGABActx_s_last = deepISOMxV4_deepIPVxV4_iGABActx_s_last+dt*deepISOMxV4_deepIPVxV4_iGABActx_s_k1;
  PostStimuliAxV4_PreStimuliAxV4_iAMPActx_s_last = PostStimuliAxV4_PreStimuliAxV4_iAMPActx_s_last+dt*PostStimuliAxV4_PreStimuliAxV4_iAMPActx_s_k1;
  PostStimuliBxV4_PreStimuliBxV4_iAMPActx_s_last = PostStimuliBxV4_PreStimuliBxV4_iAMPActx_s_last+dt*PostStimuliBxV4_PreStimuliBxV4_iAMPActx_s_k1;
  PostStimuliCxV4_PreStimuliCxV4_iAMPActx_s_last = PostStimuliCxV4_PreStimuliCxV4_iAMPActx_s_last+dt*PostStimuliCxV4_PreStimuliCxV4_iAMPActx_s_k1;
  midExV4_PreStimuliAxV4_iAMPActx_s_last = midExV4_PreStimuliAxV4_iAMPActx_s_last+dt*midExV4_PreStimuliAxV4_iAMPActx_s_k1;
  midExV4_PostStimuliAxV4_iAMPActx_s_last = midExV4_PostStimuliAxV4_iAMPActx_s_last+dt*midExV4_PostStimuliAxV4_iAMPActx_s_k1;
  midExV4_PreStimuliBxV4_iAMPActx_s_last = midExV4_PreStimuliBxV4_iAMPActx_s_last+dt*midExV4_PreStimuliBxV4_iAMPActx_s_k1;
  midExV4_PostStimuliBxV4_iAMPActx_s_last = midExV4_PostStimuliBxV4_iAMPActx_s_last+dt*midExV4_PostStimuliBxV4_iAMPActx_s_k1;
  midExV4_PreStimuliCxV4_iAMPActx_s_last = midExV4_PreStimuliCxV4_iAMPActx_s_last+dt*midExV4_PreStimuliCxV4_iAMPActx_s_k1;
  midExV4_PostStimuliCxV4_iAMPActx_s_last = midExV4_PostStimuliCxV4_iAMPActx_s_last+dt*midExV4_PostStimuliCxV4_iAMPActx_s_k1;
  deepExV4_supExV4_iAMPActx_s_last = deepExV4_supExV4_iAMPActx_s_last+dt*deepExV4_supExV4_iAMPActx_s_k1;
  supISOMxV4_midExV4_iAMPActx_s_last = supISOMxV4_midExV4_iAMPActx_s_last+dt*supISOMxV4_midExV4_iAMPActx_s_k1;
  supExV4_midExV4_iAMPActx_s_last = supExV4_midExV4_iAMPActx_s_last+dt*supExV4_midExV4_iAMPActx_s_k1;
  deepExV4_midExV4_iAMPActx_s_last = deepExV4_midExV4_iAMPActx_s_last+dt*deepExV4_midExV4_iAMPActx_s_k1;
  deepIPVxV4_midExV4_iAMPActx_s_last = deepIPVxV4_midExV4_iAMPActx_s_last+dt*deepIPVxV4_midExV4_iAMPActx_s_k1;
  supExV4_midIPVxV4_iGABActx_s_last = supExV4_midIPVxV4_iGABActx_s_last+dt*supExV4_midIPVxV4_iGABActx_s_k1;
  supISOMxV4_deepExV4_iAMPActx_s_last = supISOMxV4_deepExV4_iAMPActx_s_last+dt*supISOMxV4_deepExV4_iAMPActx_s_k1;
  supIPVxV4_deepExV4_iAMPActx_s_last = supIPVxV4_deepExV4_iAMPActx_s_last+dt*supIPVxV4_deepExV4_iAMPActx_s_k1;
  midIPVxV4_deepISOMxV4_iGABActx_s_last = midIPVxV4_deepISOMxV4_iGABActx_s_last+dt*midIPVxV4_deepISOMxV4_iGABActx_s_k1;

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    supExV4_V(n,:) = supExV4_V_last;
    supExV4_iNa_m(n,:) = supExV4_iNa_m_last;
    supExV4_iNa_h(n,:) = supExV4_iNa_h_last;
    supExV4_iK_n(n,:) = supExV4_iK_n_last;
    supISOMxV4_V(n,:) = supISOMxV4_V_last;
    supISOMxV4_iNa_m(n,:) = supISOMxV4_iNa_m_last;
    supISOMxV4_iNa_h(n,:) = supISOMxV4_iNa_h_last;
    supISOMxV4_iK_n(n,:) = supISOMxV4_iK_n_last;
    supIPVxV4_V(n,:) = supIPVxV4_V_last;
    supIPVxV4_iNa_m(n,:) = supIPVxV4_iNa_m_last;
    supIPVxV4_iNa_h(n,:) = supIPVxV4_iNa_h_last;
    supIPVxV4_iK_n(n,:) = supIPVxV4_iK_n_last;
    midExV4_V(n,:) = midExV4_V_last;
    midExV4_iNa_m(n,:) = midExV4_iNa_m_last;
    midExV4_iNa_h(n,:) = midExV4_iNa_h_last;
    midExV4_iK_n(n,:) = midExV4_iK_n_last;
    midIPVxV4_V(n,:) = midIPVxV4_V_last;
    midIPVxV4_iNa_m(n,:) = midIPVxV4_iNa_m_last;
    midIPVxV4_iNa_h(n,:) = midIPVxV4_iNa_h_last;
    midIPVxV4_iK_n(n,:) = midIPVxV4_iK_n_last;
    deepExV4_V(n,:) = deepExV4_V_last;
    deepExV4_iNa_m(n,:) = deepExV4_iNa_m_last;
    deepExV4_iNa_h(n,:) = deepExV4_iNa_h_last;
    deepExV4_iK_n(n,:) = deepExV4_iK_n_last;
    deepISOMxV4_V(n,:) = deepISOMxV4_V_last;
    deepISOMxV4_iNa_m(n,:) = deepISOMxV4_iNa_m_last;
    deepISOMxV4_iNa_h(n,:) = deepISOMxV4_iNa_h_last;
    deepISOMxV4_iK_n(n,:) = deepISOMxV4_iK_n_last;
    deepIPVxV4_V(n,:) = deepIPVxV4_V_last;
    deepIPVxV4_iNa_m(n,:) = deepIPVxV4_iNa_m_last;
    deepIPVxV4_iNa_h(n,:) = deepIPVxV4_iNa_h_last;
    deepIPVxV4_iK_n(n,:) = deepIPVxV4_iK_n_last;
    PreStimuliAxV4_V(n,:) = PreStimuliAxV4_V_last;
    PreStimuliAxV4_iNa_m(n,:) = PreStimuliAxV4_iNa_m_last;
    PreStimuliAxV4_iNa_h(n,:) = PreStimuliAxV4_iNa_h_last;
    PreStimuliAxV4_iK_n(n,:) = PreStimuliAxV4_iK_n_last;
    PostStimuliAxV4_V(n,:) = PostStimuliAxV4_V_last;
    PostStimuliAxV4_iNa_m(n,:) = PostStimuliAxV4_iNa_m_last;
    PostStimuliAxV4_iNa_h(n,:) = PostStimuliAxV4_iNa_h_last;
    PostStimuliAxV4_iK_n(n,:) = PostStimuliAxV4_iK_n_last;
    PreStimuliBxV4_V(n,:) = PreStimuliBxV4_V_last;
    PreStimuliBxV4_iNa_m(n,:) = PreStimuliBxV4_iNa_m_last;
    PreStimuliBxV4_iNa_h(n,:) = PreStimuliBxV4_iNa_h_last;
    PreStimuliBxV4_iK_n(n,:) = PreStimuliBxV4_iK_n_last;
    PostStimuliBxV4_V(n,:) = PostStimuliBxV4_V_last;
    PostStimuliBxV4_iNa_m(n,:) = PostStimuliBxV4_iNa_m_last;
    PostStimuliBxV4_iNa_h(n,:) = PostStimuliBxV4_iNa_h_last;
    PostStimuliBxV4_iK_n(n,:) = PostStimuliBxV4_iK_n_last;
    PreStimuliCxV4_V(n,:) = PreStimuliCxV4_V_last;
    PreStimuliCxV4_iNa_m(n,:) = PreStimuliCxV4_iNa_m_last;
    PreStimuliCxV4_iNa_h(n,:) = PreStimuliCxV4_iNa_h_last;
    PreStimuliCxV4_iK_n(n,:) = PreStimuliCxV4_iK_n_last;
    PostStimuliCxV4_V(n,:) = PostStimuliCxV4_V_last;
    PostStimuliCxV4_iNa_m(n,:) = PostStimuliCxV4_iNa_m_last;
    PostStimuliCxV4_iNa_h(n,:) = PostStimuliCxV4_iNa_h_last;
    PostStimuliCxV4_iK_n(n,:) = PostStimuliCxV4_iK_n_last;
    supISOMxV4_supExV4_iAMPActx_s(n,:) = supISOMxV4_supExV4_iAMPActx_s_last;
    supIPVxV4_supExV4_iAMPActx_s(n,:) = supIPVxV4_supExV4_iAMPActx_s_last;
    supISOMxV4_supExV4_iNMDActx_s(n,:) = supISOMxV4_supExV4_iNMDActx_s_last;
    supIPVxV4_supExV4_iNMDActx_s(n,:) = supIPVxV4_supExV4_iNMDActx_s_last;
    supExV4_supISOMxV4_iGABActx_s(n,:) = supExV4_supISOMxV4_iGABActx_s_last;
    supIPVxV4_supISOMxV4_iGABActx_s(n,:) = supIPVxV4_supISOMxV4_iGABActx_s_last;
    supExV4_supIPVxV4_iGABActx_s(n,:) = supExV4_supIPVxV4_iGABActx_s_last;
    supISOMxV4_supIPVxV4_iGABActx_s(n,:) = supISOMxV4_supIPVxV4_iGABActx_s_last;
    midIPVxV4_midExV4_iAMPActx_s(n,:) = midIPVxV4_midExV4_iAMPActx_s_last;
    midExV4_midIPVxV4_iGABActx_s(n,:) = midExV4_midIPVxV4_iGABActx_s_last;
    deepISOMxV4_deepExV4_iAMPActx_s(n,:) = deepISOMxV4_deepExV4_iAMPActx_s_last;
    deepIPVxV4_deepExV4_iAMPActx_s(n,:) = deepIPVxV4_deepExV4_iAMPActx_s_last;
    deepExV4_deepISOMxV4_iGABActx_s(n,:) = deepExV4_deepISOMxV4_iGABActx_s_last;
    deepIPVxV4_deepISOMxV4_iGABActx_s(n,:) = deepIPVxV4_deepISOMxV4_iGABActx_s_last;
    deepExV4_deepIPVxV4_iGABActx_s(n,:) = deepExV4_deepIPVxV4_iGABActx_s_last;
    deepISOMxV4_deepIPVxV4_iGABActx_s(n,:) = deepISOMxV4_deepIPVxV4_iGABActx_s_last;
    PostStimuliAxV4_PreStimuliAxV4_iAMPActx_s(n,:) = PostStimuliAxV4_PreStimuliAxV4_iAMPActx_s_last;
    PostStimuliBxV4_PreStimuliBxV4_iAMPActx_s(n,:) = PostStimuliBxV4_PreStimuliBxV4_iAMPActx_s_last;
    PostStimuliCxV4_PreStimuliCxV4_iAMPActx_s(n,:) = PostStimuliCxV4_PreStimuliCxV4_iAMPActx_s_last;
    midExV4_PreStimuliAxV4_iAMPActx_s(n,:) = midExV4_PreStimuliAxV4_iAMPActx_s_last;
    midExV4_PostStimuliAxV4_iAMPActx_s(n,:) = midExV4_PostStimuliAxV4_iAMPActx_s_last;
    midExV4_PreStimuliBxV4_iAMPActx_s(n,:) = midExV4_PreStimuliBxV4_iAMPActx_s_last;
    midExV4_PostStimuliBxV4_iAMPActx_s(n,:) = midExV4_PostStimuliBxV4_iAMPActx_s_last;
    midExV4_PreStimuliCxV4_iAMPActx_s(n,:) = midExV4_PreStimuliCxV4_iAMPActx_s_last;
    midExV4_PostStimuliCxV4_iAMPActx_s(n,:) = midExV4_PostStimuliCxV4_iAMPActx_s_last;
    deepExV4_supExV4_iAMPActx_s(n,:) = deepExV4_supExV4_iAMPActx_s_last;
    supISOMxV4_midExV4_iAMPActx_s(n,:) = supISOMxV4_midExV4_iAMPActx_s_last;
    supExV4_midExV4_iAMPActx_s(n,:) = supExV4_midExV4_iAMPActx_s_last;
    deepExV4_midExV4_iAMPActx_s(n,:) = deepExV4_midExV4_iAMPActx_s_last;
    deepIPVxV4_midExV4_iAMPActx_s(n,:) = deepIPVxV4_midExV4_iAMPActx_s_last;
    supExV4_midIPVxV4_iGABActx_s(n,:) = supExV4_midIPVxV4_iGABActx_s_last;
    supISOMxV4_deepExV4_iAMPActx_s(n,:) = supISOMxV4_deepExV4_iAMPActx_s_last;
    supIPVxV4_deepExV4_iAMPActx_s(n,:) = supIPVxV4_deepExV4_iAMPActx_s_last;
    midIPVxV4_deepISOMxV4_iGABActx_s(n,:) = midIPVxV4_deepISOMxV4_iGABActx_s_last;

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
