function [T,supE_V,supE_iNa_m,supE_iNa_h,supE_iK_n,supI_V,supI_iNa_m,supI_iNa_h,supI_iK_n,midE_V,midE_iNa_m,midE_iNa_h,midE_iK_n,midI_V,midI_iNa_m,midI_iNa_h,midI_iK_n,deepE_V,deepE_iNa_m,deepE_iNa_h,deepE_iK_n,deepI_V,deepI_iNa_m,deepI_iNa_h,deepI_iK_n,SA1_V,SA1_iNa_m,SA1_iNa_h,SA1_iK_n,SB1_V,SB1_iNa_m,SB1_iNa_h,SB1_iK_n,SC1_V,SC1_iNa_m,SC1_iNa_h,SC1_iK_n,SA2_V,SA2_iNa_m,SA2_iNa_h,SA2_iK_n,SB2_V,SB2_iNa_m,SB2_iNa_h,SB2_iK_n,SC2_V,SC2_iNa_m,SC2_iNa_h,SC2_iK_n,Cx1_V,Cx1_iNa_m,Cx1_iNa_h,Cx1_iK_n,Cx2_V,Cx2_iNa_m,Cx2_iNa_h,Cx2_iK_n,supI_supE_iAMPActx_s,supE_supE_iAMPActx_s,supE_supI_iGABActx_s,supI_supI_iGABActx_s,midI_midE_iAMPActx_s,midE_midE_iAMPActx_s,midE_midI_iGABActx_s,midI_midI_iGABActx_s,deepI_deepE_iAMPActx_s,deepE_deepE_iAMPActx_s,deepE_deepI_iGABActx_s,deepI_deepI_iGABActx_s,SB1_SA1_iAMPActx_s,SA1_SA1_iAMPActx_s,SA1_SB1_iGABActx_s,SB1_SB1_iGABActx_s,SA2_SC1_iAMPActx_s,SC1_SC1_iAMPActx_s,SC1_SA2_iGABActx_s,SA2_SA2_iGABActx_s,SC2_SB2_iAMPActx_s,SB2_SB2_iAMPActx_s,SB2_SC2_iGABActx_s,SC2_SC2_iGABActx_s,Cx2_Cx1_iAMPActx_s,Cx1_Cx1_iAMPActx_s,Cx1_Cx2_iGABActx_s,Cx2_Cx2_iGABActx_s,midE_SA1_iAMPActx_s,midE_SA2_iAMPActx_s,midE_SB1_iAMPActx_s,midE_SB2_iAMPActx_s,midE_SC1_iAMPActx_s,midE_SC2_iAMPActx_s,midE_Cx1_iAMPActx_s,midE_Cx2_iAMPActx_s,supE_midE_iAMPActx_s,deepE_midE_iAMPActx_s,deepE_midI_iGABActx_s,deepE_supE_iAMPActx_s,supE_ctx_iPoisson_g_poisson,supE_ctx_iPoisson_I_poisson,supI_ctx_iPoisson_g_poisson,supI_ctx_iPoisson_I_poisson,midE_ctx_iPoisson_g_poisson,midE_ctx_iPoisson_I_poisson,midI_ctx_iPoisson_g_poisson,midI_ctx_iPoisson_I_poisson,deepE_ctx_iPoisson_g_poisson,deepE_ctx_iPoisson_I_poisson,deepI_ctx_iPoisson_g_poisson,deepI_ctx_iPoisson_I_poisson,SA1_ctx_iPoisson_g_poisson,SA1_ctx_iPoisson_I_poisson,SB1_ctx_iPoisson_g_poisson,SB1_ctx_iPoisson_I_poisson,SC1_ctx_iPoisson_g_poisson,SC1_ctx_iPoisson_I_poisson,SA2_ctx_iPoisson_g_poisson,SA2_ctx_iPoisson_I_poisson,SB2_ctx_iPoisson_g_poisson,SB2_ctx_iPoisson_I_poisson,SC2_ctx_iPoisson_g_poisson,SC2_ctx_iPoisson_I_poisson,Cx1_ctx_iPoisson_g_poisson,Cx1_ctx_iPoisson_I_poisson,Cx2_ctx_iPoisson_g_poisson,Cx2_ctx_iPoisson_I_poisson,supE_ctx_iPoisson_s_poisson,supI_ctx_iPoisson_s_poisson,midE_ctx_iPoisson_s_poisson,midI_ctx_iPoisson_s_poisson,deepE_ctx_iPoisson_s_poisson,deepI_ctx_iPoisson_s_poisson,SA1_ctx_iPoisson_s_poisson,SB1_ctx_iPoisson_s_poisson,SC1_ctx_iPoisson_s_poisson,SA2_ctx_iPoisson_s_poisson,SB2_ctx_iPoisson_s_poisson,SC2_ctx_iPoisson_s_poisson,Cx1_ctx_iPoisson_s_poisson,Cx2_ctx_iPoisson_s_poisson]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% seed the random number generator
rng(p.random_seed);

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
supE_ctx_iPoisson_s_poisson = getPoissonDutyCycleGating(p.supE_ctx_iPoisson_onset_poisson,p.supE_ctx_iPoisson_offset_poisson,p.supE_ctx_iPoisson_latency_poisson,p.supE_ctx_iPoisson_f_poisson,p.supE_ctx_iPoisson_fsigma_poisson,p.supE_ctx_iPoisson_phi_poisson,p.supE_ctx_iPoisson_connsigma_poisson,p.supE_ctx_iPoisson_baseline_poisson,p.supE_ctx_iPoisson_DC_poisson,p.supE_ctx_iPoisson_AC_poisson,p.supE_ctx_iPoisson_slopedutycycle_poisson,p.supE_ctx_iPoisson_thresholddutycycle_poisson,p.supE_ctx_iPoisson_tau_poisson,p.supE_ctx_iPoisson_kick_poisson,T,p.supE_Npop);
supI_ctx_iPoisson_s_poisson = getPoissonDutyCycleGating(p.supI_ctx_iPoisson_onset_poisson,p.supI_ctx_iPoisson_offset_poisson,p.supI_ctx_iPoisson_latency_poisson,p.supI_ctx_iPoisson_f_poisson,p.supI_ctx_iPoisson_fsigma_poisson,p.supI_ctx_iPoisson_phi_poisson,p.supI_ctx_iPoisson_connsigma_poisson,p.supI_ctx_iPoisson_baseline_poisson,p.supI_ctx_iPoisson_DC_poisson,p.supI_ctx_iPoisson_AC_poisson,p.supI_ctx_iPoisson_slopedutycycle_poisson,p.supI_ctx_iPoisson_thresholddutycycle_poisson,p.supI_ctx_iPoisson_tau_poisson,p.supI_ctx_iPoisson_kick_poisson,T,p.supI_Npop);
midE_ctx_iPoisson_s_poisson = getPoissonDutyCycleGating(p.midE_ctx_iPoisson_onset_poisson,p.midE_ctx_iPoisson_offset_poisson,p.midE_ctx_iPoisson_latency_poisson,p.midE_ctx_iPoisson_f_poisson,p.midE_ctx_iPoisson_fsigma_poisson,p.midE_ctx_iPoisson_phi_poisson,p.midE_ctx_iPoisson_connsigma_poisson,p.midE_ctx_iPoisson_baseline_poisson,p.midE_ctx_iPoisson_DC_poisson,p.midE_ctx_iPoisson_AC_poisson,p.midE_ctx_iPoisson_slopedutycycle_poisson,p.midE_ctx_iPoisson_thresholddutycycle_poisson,p.midE_ctx_iPoisson_tau_poisson,p.midE_ctx_iPoisson_kick_poisson,T,p.midE_Npop);
midI_ctx_iPoisson_s_poisson = getPoissonDutyCycleGating(p.midI_ctx_iPoisson_onset_poisson,p.midI_ctx_iPoisson_offset_poisson,p.midI_ctx_iPoisson_latency_poisson,p.midI_ctx_iPoisson_f_poisson,p.midI_ctx_iPoisson_fsigma_poisson,p.midI_ctx_iPoisson_phi_poisson,p.midI_ctx_iPoisson_connsigma_poisson,p.midI_ctx_iPoisson_baseline_poisson,p.midI_ctx_iPoisson_DC_poisson,p.midI_ctx_iPoisson_AC_poisson,p.midI_ctx_iPoisson_slopedutycycle_poisson,p.midI_ctx_iPoisson_thresholddutycycle_poisson,p.midI_ctx_iPoisson_tau_poisson,p.midI_ctx_iPoisson_kick_poisson,T,p.midI_Npop);
deepE_ctx_iPoisson_s_poisson = getPoissonDutyCycleGating(p.deepE_ctx_iPoisson_onset_poisson,p.deepE_ctx_iPoisson_offset_poisson,p.deepE_ctx_iPoisson_latency_poisson,p.deepE_ctx_iPoisson_f_poisson,p.deepE_ctx_iPoisson_fsigma_poisson,p.deepE_ctx_iPoisson_phi_poisson,p.deepE_ctx_iPoisson_connsigma_poisson,p.deepE_ctx_iPoisson_baseline_poisson,p.deepE_ctx_iPoisson_DC_poisson,p.deepE_ctx_iPoisson_AC_poisson,p.deepE_ctx_iPoisson_slopedutycycle_poisson,p.deepE_ctx_iPoisson_thresholddutycycle_poisson,p.deepE_ctx_iPoisson_tau_poisson,p.deepE_ctx_iPoisson_kick_poisson,T,p.deepE_Npop);
deepI_ctx_iPoisson_s_poisson = getPoissonDutyCycleGating(p.deepI_ctx_iPoisson_onset_poisson,p.deepI_ctx_iPoisson_offset_poisson,p.deepI_ctx_iPoisson_latency_poisson,p.deepI_ctx_iPoisson_f_poisson,p.deepI_ctx_iPoisson_fsigma_poisson,p.deepI_ctx_iPoisson_phi_poisson,p.deepI_ctx_iPoisson_connsigma_poisson,p.deepI_ctx_iPoisson_baseline_poisson,p.deepI_ctx_iPoisson_DC_poisson,p.deepI_ctx_iPoisson_AC_poisson,p.deepI_ctx_iPoisson_slopedutycycle_poisson,p.deepI_ctx_iPoisson_thresholddutycycle_poisson,p.deepI_ctx_iPoisson_tau_poisson,p.deepI_ctx_iPoisson_kick_poisson,T,p.deepI_Npop);
SA1_ctx_iPoisson_s_poisson = getPoissonDutyCycleGating(p.SA1_ctx_iPoisson_onset_poisson,p.SA1_ctx_iPoisson_offset_poisson,p.SA1_ctx_iPoisson_latency_poisson,p.SA1_ctx_iPoisson_f_poisson,p.SA1_ctx_iPoisson_fsigma_poisson,p.SA1_ctx_iPoisson_phi_poisson,p.SA1_ctx_iPoisson_connsigma_poisson,p.SA1_ctx_iPoisson_baseline_poisson,p.SA1_ctx_iPoisson_DC_poisson,p.SA1_ctx_iPoisson_AC_poisson,p.SA1_ctx_iPoisson_slopedutycycle_poisson,p.SA1_ctx_iPoisson_thresholddutycycle_poisson,p.SA1_ctx_iPoisson_tau_poisson,p.SA1_ctx_iPoisson_kick_poisson,T,p.SA1_Npop);
SB1_ctx_iPoisson_s_poisson = getPoissonDutyCycleGating(p.SB1_ctx_iPoisson_onset_poisson,p.SB1_ctx_iPoisson_offset_poisson,p.SB1_ctx_iPoisson_latency_poisson,p.SB1_ctx_iPoisson_f_poisson,p.SB1_ctx_iPoisson_fsigma_poisson,p.SB1_ctx_iPoisson_phi_poisson,p.SB1_ctx_iPoisson_connsigma_poisson,p.SB1_ctx_iPoisson_baseline_poisson,p.SB1_ctx_iPoisson_DC_poisson,p.SB1_ctx_iPoisson_AC_poisson,p.SB1_ctx_iPoisson_slopedutycycle_poisson,p.SB1_ctx_iPoisson_thresholddutycycle_poisson,p.SB1_ctx_iPoisson_tau_poisson,p.SB1_ctx_iPoisson_kick_poisson,T,p.SB1_Npop);
SC1_ctx_iPoisson_s_poisson = getPoissonDutyCycleGating(p.SC1_ctx_iPoisson_onset_poisson,p.SC1_ctx_iPoisson_offset_poisson,p.SC1_ctx_iPoisson_latency_poisson,p.SC1_ctx_iPoisson_f_poisson,p.SC1_ctx_iPoisson_fsigma_poisson,p.SC1_ctx_iPoisson_phi_poisson,p.SC1_ctx_iPoisson_connsigma_poisson,p.SC1_ctx_iPoisson_baseline_poisson,p.SC1_ctx_iPoisson_DC_poisson,p.SC1_ctx_iPoisson_AC_poisson,p.SC1_ctx_iPoisson_slopedutycycle_poisson,p.SC1_ctx_iPoisson_thresholddutycycle_poisson,p.SC1_ctx_iPoisson_tau_poisson,p.SC1_ctx_iPoisson_kick_poisson,T,p.SC1_Npop);
SA2_ctx_iPoisson_s_poisson = getPoissonDutyCycleGating(p.SA2_ctx_iPoisson_onset_poisson,p.SA2_ctx_iPoisson_offset_poisson,p.SA2_ctx_iPoisson_latency_poisson,p.SA2_ctx_iPoisson_f_poisson,p.SA2_ctx_iPoisson_fsigma_poisson,p.SA2_ctx_iPoisson_phi_poisson,p.SA2_ctx_iPoisson_connsigma_poisson,p.SA2_ctx_iPoisson_baseline_poisson,p.SA2_ctx_iPoisson_DC_poisson,p.SA2_ctx_iPoisson_AC_poisson,p.SA2_ctx_iPoisson_slopedutycycle_poisson,p.SA2_ctx_iPoisson_thresholddutycycle_poisson,p.SA2_ctx_iPoisson_tau_poisson,p.SA2_ctx_iPoisson_kick_poisson,T,p.SA2_Npop);
SB2_ctx_iPoisson_s_poisson = getPoissonDutyCycleGating(p.SB2_ctx_iPoisson_onset_poisson,p.SB2_ctx_iPoisson_offset_poisson,p.SB2_ctx_iPoisson_latency_poisson,p.SB2_ctx_iPoisson_f_poisson,p.SB2_ctx_iPoisson_fsigma_poisson,p.SB2_ctx_iPoisson_phi_poisson,p.SB2_ctx_iPoisson_connsigma_poisson,p.SB2_ctx_iPoisson_baseline_poisson,p.SB2_ctx_iPoisson_DC_poisson,p.SB2_ctx_iPoisson_AC_poisson,p.SB2_ctx_iPoisson_slopedutycycle_poisson,p.SB2_ctx_iPoisson_thresholddutycycle_poisson,p.SB2_ctx_iPoisson_tau_poisson,p.SB2_ctx_iPoisson_kick_poisson,T,p.SB2_Npop);
SC2_ctx_iPoisson_s_poisson = getPoissonDutyCycleGating(p.SC2_ctx_iPoisson_onset_poisson,p.SC2_ctx_iPoisson_offset_poisson,p.SC2_ctx_iPoisson_latency_poisson,p.SC2_ctx_iPoisson_f_poisson,p.SC2_ctx_iPoisson_fsigma_poisson,p.SC2_ctx_iPoisson_phi_poisson,p.SC2_ctx_iPoisson_connsigma_poisson,p.SC2_ctx_iPoisson_baseline_poisson,p.SC2_ctx_iPoisson_DC_poisson,p.SC2_ctx_iPoisson_AC_poisson,p.SC2_ctx_iPoisson_slopedutycycle_poisson,p.SC2_ctx_iPoisson_thresholddutycycle_poisson,p.SC2_ctx_iPoisson_tau_poisson,p.SC2_ctx_iPoisson_kick_poisson,T,p.SC2_Npop);
Cx1_ctx_iPoisson_s_poisson = getPoissonDutyCycleGating(p.Cx1_ctx_iPoisson_onset_poisson,p.Cx1_ctx_iPoisson_offset_poisson,p.Cx1_ctx_iPoisson_latency_poisson,p.Cx1_ctx_iPoisson_f_poisson,p.Cx1_ctx_iPoisson_fsigma_poisson,p.Cx1_ctx_iPoisson_phi_poisson,p.Cx1_ctx_iPoisson_connsigma_poisson,p.Cx1_ctx_iPoisson_baseline_poisson,p.Cx1_ctx_iPoisson_DC_poisson,p.Cx1_ctx_iPoisson_AC_poisson,p.Cx1_ctx_iPoisson_slopedutycycle_poisson,p.Cx1_ctx_iPoisson_thresholddutycycle_poisson,p.Cx1_ctx_iPoisson_tau_poisson,p.Cx1_ctx_iPoisson_kick_poisson,T,p.Cx1_Npop);
Cx2_ctx_iPoisson_s_poisson = getPoissonDutyCycleGating(p.Cx2_ctx_iPoisson_onset_poisson,p.Cx2_ctx_iPoisson_offset_poisson,p.Cx2_ctx_iPoisson_latency_poisson,p.Cx2_ctx_iPoisson_f_poisson,p.Cx2_ctx_iPoisson_fsigma_poisson,p.Cx2_ctx_iPoisson_phi_poisson,p.Cx2_ctx_iPoisson_connsigma_poisson,p.Cx2_ctx_iPoisson_baseline_poisson,p.Cx2_ctx_iPoisson_DC_poisson,p.Cx2_ctx_iPoisson_AC_poisson,p.Cx2_ctx_iPoisson_slopedutycycle_poisson,p.Cx2_ctx_iPoisson_thresholddutycycle_poisson,p.Cx2_ctx_iPoisson_tau_poisson,p.Cx2_ctx_iPoisson_kick_poisson,T,p.Cx2_Npop);

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
supE_V_last =  -rand(1, p.supE_Npop)*20;
supE_V = zeros(nsamp,p.supE_Npop);
supE_V(1,:) = supE_V_last;
supE_iNa_m_last = p.supE_iNa_m_IC+p.supE_iNa_IC_noise*rand(1,p.supE_Npop);
supE_iNa_m = zeros(nsamp,p.supE_Npop);
supE_iNa_m(1,:) = supE_iNa_m_last;
supE_iNa_h_last = p.supE_iNa_h_IC+p.supE_iNa_IC_noise*rand(1,p.supE_Npop);
supE_iNa_h = zeros(nsamp,p.supE_Npop);
supE_iNa_h(1,:) = supE_iNa_h_last;
supE_iK_n_last = p.supE_iK_n_IC+p.supE_iK_IC_noise*rand(1,p.supE_Npop);
supE_iK_n = zeros(nsamp,p.supE_Npop);
supE_iK_n(1,:) = supE_iK_n_last;
supI_V_last =  -rand(1, p.supI_Npop)*20;
supI_V = zeros(nsamp,p.supI_Npop);
supI_V(1,:) = supI_V_last;
supI_iNa_m_last = p.supI_iNa_m_IC+p.supI_iNa_IC_noise*rand(1,p.supI_Npop);
supI_iNa_m = zeros(nsamp,p.supI_Npop);
supI_iNa_m(1,:) = supI_iNa_m_last;
supI_iNa_h_last = p.supI_iNa_h_IC+p.supI_iNa_IC_noise*rand(1,p.supI_Npop);
supI_iNa_h = zeros(nsamp,p.supI_Npop);
supI_iNa_h(1,:) = supI_iNa_h_last;
supI_iK_n_last = p.supI_iK_n_IC+p.supI_iK_IC_noise*rand(1,p.supI_Npop);
supI_iK_n = zeros(nsamp,p.supI_Npop);
supI_iK_n(1,:) = supI_iK_n_last;
midE_V_last =  -rand(1, p.midE_Npop)*20;
midE_V = zeros(nsamp,p.midE_Npop);
midE_V(1,:) = midE_V_last;
midE_iNa_m_last = p.midE_iNa_m_IC+p.midE_iNa_IC_noise*rand(1,p.midE_Npop);
midE_iNa_m = zeros(nsamp,p.midE_Npop);
midE_iNa_m(1,:) = midE_iNa_m_last;
midE_iNa_h_last = p.midE_iNa_h_IC+p.midE_iNa_IC_noise*rand(1,p.midE_Npop);
midE_iNa_h = zeros(nsamp,p.midE_Npop);
midE_iNa_h(1,:) = midE_iNa_h_last;
midE_iK_n_last = p.midE_iK_n_IC+p.midE_iK_IC_noise*rand(1,p.midE_Npop);
midE_iK_n = zeros(nsamp,p.midE_Npop);
midE_iK_n(1,:) = midE_iK_n_last;
midI_V_last =  -rand(1, p.midI_Npop)*20;
midI_V = zeros(nsamp,p.midI_Npop);
midI_V(1,:) = midI_V_last;
midI_iNa_m_last = p.midI_iNa_m_IC+p.midI_iNa_IC_noise*rand(1,p.midI_Npop);
midI_iNa_m = zeros(nsamp,p.midI_Npop);
midI_iNa_m(1,:) = midI_iNa_m_last;
midI_iNa_h_last = p.midI_iNa_h_IC+p.midI_iNa_IC_noise*rand(1,p.midI_Npop);
midI_iNa_h = zeros(nsamp,p.midI_Npop);
midI_iNa_h(1,:) = midI_iNa_h_last;
midI_iK_n_last = p.midI_iK_n_IC+p.midI_iK_IC_noise*rand(1,p.midI_Npop);
midI_iK_n = zeros(nsamp,p.midI_Npop);
midI_iK_n(1,:) = midI_iK_n_last;
deepE_V_last =  -rand(1, p.deepE_Npop)*20;
deepE_V = zeros(nsamp,p.deepE_Npop);
deepE_V(1,:) = deepE_V_last;
deepE_iNa_m_last = p.deepE_iNa_m_IC+p.deepE_iNa_IC_noise*rand(1,p.deepE_Npop);
deepE_iNa_m = zeros(nsamp,p.deepE_Npop);
deepE_iNa_m(1,:) = deepE_iNa_m_last;
deepE_iNa_h_last = p.deepE_iNa_h_IC+p.deepE_iNa_IC_noise*rand(1,p.deepE_Npop);
deepE_iNa_h = zeros(nsamp,p.deepE_Npop);
deepE_iNa_h(1,:) = deepE_iNa_h_last;
deepE_iK_n_last = p.deepE_iK_n_IC+p.deepE_iK_IC_noise*rand(1,p.deepE_Npop);
deepE_iK_n = zeros(nsamp,p.deepE_Npop);
deepE_iK_n(1,:) = deepE_iK_n_last;
deepI_V_last =  -rand(1, p.deepI_Npop)*20;
deepI_V = zeros(nsamp,p.deepI_Npop);
deepI_V(1,:) = deepI_V_last;
deepI_iNa_m_last = p.deepI_iNa_m_IC+p.deepI_iNa_IC_noise*rand(1,p.deepI_Npop);
deepI_iNa_m = zeros(nsamp,p.deepI_Npop);
deepI_iNa_m(1,:) = deepI_iNa_m_last;
deepI_iNa_h_last = p.deepI_iNa_h_IC+p.deepI_iNa_IC_noise*rand(1,p.deepI_Npop);
deepI_iNa_h = zeros(nsamp,p.deepI_Npop);
deepI_iNa_h(1,:) = deepI_iNa_h_last;
deepI_iK_n_last = p.deepI_iK_n_IC+p.deepI_iK_IC_noise*rand(1,p.deepI_Npop);
deepI_iK_n = zeros(nsamp,p.deepI_Npop);
deepI_iK_n(1,:) = deepI_iK_n_last;
SA1_V_last =  -rand(1, p.SA1_Npop)*20;
SA1_V = zeros(nsamp,p.SA1_Npop);
SA1_V(1,:) = SA1_V_last;
SA1_iNa_m_last = p.SA1_iNa_m_IC+p.SA1_iNa_IC_noise*rand(1,p.SA1_Npop);
SA1_iNa_m = zeros(nsamp,p.SA1_Npop);
SA1_iNa_m(1,:) = SA1_iNa_m_last;
SA1_iNa_h_last = p.SA1_iNa_h_IC+p.SA1_iNa_IC_noise*rand(1,p.SA1_Npop);
SA1_iNa_h = zeros(nsamp,p.SA1_Npop);
SA1_iNa_h(1,:) = SA1_iNa_h_last;
SA1_iK_n_last = p.SA1_iK_n_IC+p.SA1_iK_IC_noise*rand(1,p.SA1_Npop);
SA1_iK_n = zeros(nsamp,p.SA1_Npop);
SA1_iK_n(1,:) = SA1_iK_n_last;
SB1_V_last =  -rand(1, p.SB1_Npop)*20;
SB1_V = zeros(nsamp,p.SB1_Npop);
SB1_V(1,:) = SB1_V_last;
SB1_iNa_m_last = p.SB1_iNa_m_IC+p.SB1_iNa_IC_noise*rand(1,p.SB1_Npop);
SB1_iNa_m = zeros(nsamp,p.SB1_Npop);
SB1_iNa_m(1,:) = SB1_iNa_m_last;
SB1_iNa_h_last = p.SB1_iNa_h_IC+p.SB1_iNa_IC_noise*rand(1,p.SB1_Npop);
SB1_iNa_h = zeros(nsamp,p.SB1_Npop);
SB1_iNa_h(1,:) = SB1_iNa_h_last;
SB1_iK_n_last = p.SB1_iK_n_IC+p.SB1_iK_IC_noise*rand(1,p.SB1_Npop);
SB1_iK_n = zeros(nsamp,p.SB1_Npop);
SB1_iK_n(1,:) = SB1_iK_n_last;
SC1_V_last =  -rand(1, p.SC1_Npop)*20;
SC1_V = zeros(nsamp,p.SC1_Npop);
SC1_V(1,:) = SC1_V_last;
SC1_iNa_m_last = p.SC1_iNa_m_IC+p.SC1_iNa_IC_noise*rand(1,p.SC1_Npop);
SC1_iNa_m = zeros(nsamp,p.SC1_Npop);
SC1_iNa_m(1,:) = SC1_iNa_m_last;
SC1_iNa_h_last = p.SC1_iNa_h_IC+p.SC1_iNa_IC_noise*rand(1,p.SC1_Npop);
SC1_iNa_h = zeros(nsamp,p.SC1_Npop);
SC1_iNa_h(1,:) = SC1_iNa_h_last;
SC1_iK_n_last = p.SC1_iK_n_IC+p.SC1_iK_IC_noise*rand(1,p.SC1_Npop);
SC1_iK_n = zeros(nsamp,p.SC1_Npop);
SC1_iK_n(1,:) = SC1_iK_n_last;
SA2_V_last =  -rand(1, p.SA2_Npop)*20;
SA2_V = zeros(nsamp,p.SA2_Npop);
SA2_V(1,:) = SA2_V_last;
SA2_iNa_m_last = p.SA2_iNa_m_IC+p.SA2_iNa_IC_noise*rand(1,p.SA2_Npop);
SA2_iNa_m = zeros(nsamp,p.SA2_Npop);
SA2_iNa_m(1,:) = SA2_iNa_m_last;
SA2_iNa_h_last = p.SA2_iNa_h_IC+p.SA2_iNa_IC_noise*rand(1,p.SA2_Npop);
SA2_iNa_h = zeros(nsamp,p.SA2_Npop);
SA2_iNa_h(1,:) = SA2_iNa_h_last;
SA2_iK_n_last = p.SA2_iK_n_IC+p.SA2_iK_IC_noise*rand(1,p.SA2_Npop);
SA2_iK_n = zeros(nsamp,p.SA2_Npop);
SA2_iK_n(1,:) = SA2_iK_n_last;
SB2_V_last =  -rand(1, p.SB2_Npop)*20;
SB2_V = zeros(nsamp,p.SB2_Npop);
SB2_V(1,:) = SB2_V_last;
SB2_iNa_m_last = p.SB2_iNa_m_IC+p.SB2_iNa_IC_noise*rand(1,p.SB2_Npop);
SB2_iNa_m = zeros(nsamp,p.SB2_Npop);
SB2_iNa_m(1,:) = SB2_iNa_m_last;
SB2_iNa_h_last = p.SB2_iNa_h_IC+p.SB2_iNa_IC_noise*rand(1,p.SB2_Npop);
SB2_iNa_h = zeros(nsamp,p.SB2_Npop);
SB2_iNa_h(1,:) = SB2_iNa_h_last;
SB2_iK_n_last = p.SB2_iK_n_IC+p.SB2_iK_IC_noise*rand(1,p.SB2_Npop);
SB2_iK_n = zeros(nsamp,p.SB2_Npop);
SB2_iK_n(1,:) = SB2_iK_n_last;
SC2_V_last =  -rand(1, p.SC2_Npop)*20;
SC2_V = zeros(nsamp,p.SC2_Npop);
SC2_V(1,:) = SC2_V_last;
SC2_iNa_m_last = p.SC2_iNa_m_IC+p.SC2_iNa_IC_noise*rand(1,p.SC2_Npop);
SC2_iNa_m = zeros(nsamp,p.SC2_Npop);
SC2_iNa_m(1,:) = SC2_iNa_m_last;
SC2_iNa_h_last = p.SC2_iNa_h_IC+p.SC2_iNa_IC_noise*rand(1,p.SC2_Npop);
SC2_iNa_h = zeros(nsamp,p.SC2_Npop);
SC2_iNa_h(1,:) = SC2_iNa_h_last;
SC2_iK_n_last = p.SC2_iK_n_IC+p.SC2_iK_IC_noise*rand(1,p.SC2_Npop);
SC2_iK_n = zeros(nsamp,p.SC2_Npop);
SC2_iK_n(1,:) = SC2_iK_n_last;
Cx1_V_last =  -rand(1, p.Cx1_Npop)*20;
Cx1_V = zeros(nsamp,p.Cx1_Npop);
Cx1_V(1,:) = Cx1_V_last;
Cx1_iNa_m_last = p.Cx1_iNa_m_IC+p.Cx1_iNa_IC_noise*rand(1,p.Cx1_Npop);
Cx1_iNa_m = zeros(nsamp,p.Cx1_Npop);
Cx1_iNa_m(1,:) = Cx1_iNa_m_last;
Cx1_iNa_h_last = p.Cx1_iNa_h_IC+p.Cx1_iNa_IC_noise*rand(1,p.Cx1_Npop);
Cx1_iNa_h = zeros(nsamp,p.Cx1_Npop);
Cx1_iNa_h(1,:) = Cx1_iNa_h_last;
Cx1_iK_n_last = p.Cx1_iK_n_IC+p.Cx1_iK_IC_noise*rand(1,p.Cx1_Npop);
Cx1_iK_n = zeros(nsamp,p.Cx1_Npop);
Cx1_iK_n(1,:) = Cx1_iK_n_last;
Cx2_V_last =  -rand(1, p.Cx2_Npop)*20;
Cx2_V = zeros(nsamp,p.Cx2_Npop);
Cx2_V(1,:) = Cx2_V_last;
Cx2_iNa_m_last = p.Cx2_iNa_m_IC+p.Cx2_iNa_IC_noise*rand(1,p.Cx2_Npop);
Cx2_iNa_m = zeros(nsamp,p.Cx2_Npop);
Cx2_iNa_m(1,:) = Cx2_iNa_m_last;
Cx2_iNa_h_last = p.Cx2_iNa_h_IC+p.Cx2_iNa_IC_noise*rand(1,p.Cx2_Npop);
Cx2_iNa_h = zeros(nsamp,p.Cx2_Npop);
Cx2_iNa_h(1,:) = Cx2_iNa_h_last;
Cx2_iK_n_last = p.Cx2_iK_n_IC+p.Cx2_iK_IC_noise*rand(1,p.Cx2_Npop);
Cx2_iK_n = zeros(nsamp,p.Cx2_Npop);
Cx2_iK_n(1,:) = Cx2_iK_n_last;
supI_supE_iAMPActx_s_last =  p.supI_supE_iAMPActx_IC+p.supI_supE_iAMPActx_IC_noise.*rand(1,p.supE_Npop);
supI_supE_iAMPActx_s = zeros(nsamp,p.supE_Npop);
supI_supE_iAMPActx_s(1,:) = supI_supE_iAMPActx_s_last;
supE_supE_iAMPActx_s_last =  p.supE_supE_iAMPActx_IC+p.supE_supE_iAMPActx_IC_noise.*rand(1,p.supE_Npop);
supE_supE_iAMPActx_s = zeros(nsamp,p.supE_Npop);
supE_supE_iAMPActx_s(1,:) = supE_supE_iAMPActx_s_last;
supE_supI_iGABActx_s_last =  p.supE_supI_iGABActx_IC+p.supE_supI_iGABActx_IC_noise.*rand(1,p.supI_Npop);
supE_supI_iGABActx_s = zeros(nsamp,p.supI_Npop);
supE_supI_iGABActx_s(1,:) = supE_supI_iGABActx_s_last;
supI_supI_iGABActx_s_last =  p.supI_supI_iGABActx_IC+p.supI_supI_iGABActx_IC_noise.*rand(1,p.supI_Npop);
supI_supI_iGABActx_s = zeros(nsamp,p.supI_Npop);
supI_supI_iGABActx_s(1,:) = supI_supI_iGABActx_s_last;
midI_midE_iAMPActx_s_last =  p.midI_midE_iAMPActx_IC+p.midI_midE_iAMPActx_IC_noise.*rand(1,p.midE_Npop);
midI_midE_iAMPActx_s = zeros(nsamp,p.midE_Npop);
midI_midE_iAMPActx_s(1,:) = midI_midE_iAMPActx_s_last;
midE_midE_iAMPActx_s_last =  p.midE_midE_iAMPActx_IC+p.midE_midE_iAMPActx_IC_noise.*rand(1,p.midE_Npop);
midE_midE_iAMPActx_s = zeros(nsamp,p.midE_Npop);
midE_midE_iAMPActx_s(1,:) = midE_midE_iAMPActx_s_last;
midE_midI_iGABActx_s_last =  p.midE_midI_iGABActx_IC+p.midE_midI_iGABActx_IC_noise.*rand(1,p.midI_Npop);
midE_midI_iGABActx_s = zeros(nsamp,p.midI_Npop);
midE_midI_iGABActx_s(1,:) = midE_midI_iGABActx_s_last;
midI_midI_iGABActx_s_last =  p.midI_midI_iGABActx_IC+p.midI_midI_iGABActx_IC_noise.*rand(1,p.midI_Npop);
midI_midI_iGABActx_s = zeros(nsamp,p.midI_Npop);
midI_midI_iGABActx_s(1,:) = midI_midI_iGABActx_s_last;
deepI_deepE_iAMPActx_s_last =  p.deepI_deepE_iAMPActx_IC+p.deepI_deepE_iAMPActx_IC_noise.*rand(1,p.deepE_Npop);
deepI_deepE_iAMPActx_s = zeros(nsamp,p.deepE_Npop);
deepI_deepE_iAMPActx_s(1,:) = deepI_deepE_iAMPActx_s_last;
deepE_deepE_iAMPActx_s_last =  p.deepE_deepE_iAMPActx_IC+p.deepE_deepE_iAMPActx_IC_noise.*rand(1,p.deepE_Npop);
deepE_deepE_iAMPActx_s = zeros(nsamp,p.deepE_Npop);
deepE_deepE_iAMPActx_s(1,:) = deepE_deepE_iAMPActx_s_last;
deepE_deepI_iGABActx_s_last =  p.deepE_deepI_iGABActx_IC+p.deepE_deepI_iGABActx_IC_noise.*rand(1,p.deepI_Npop);
deepE_deepI_iGABActx_s = zeros(nsamp,p.deepI_Npop);
deepE_deepI_iGABActx_s(1,:) = deepE_deepI_iGABActx_s_last;
deepI_deepI_iGABActx_s_last =  p.deepI_deepI_iGABActx_IC+p.deepI_deepI_iGABActx_IC_noise.*rand(1,p.deepI_Npop);
deepI_deepI_iGABActx_s = zeros(nsamp,p.deepI_Npop);
deepI_deepI_iGABActx_s(1,:) = deepI_deepI_iGABActx_s_last;
SB1_SA1_iAMPActx_s_last =  p.SB1_SA1_iAMPActx_IC+p.SB1_SA1_iAMPActx_IC_noise.*rand(1,p.SA1_Npop);
SB1_SA1_iAMPActx_s = zeros(nsamp,p.SA1_Npop);
SB1_SA1_iAMPActx_s(1,:) = SB1_SA1_iAMPActx_s_last;
SA1_SA1_iAMPActx_s_last =  p.SA1_SA1_iAMPActx_IC+p.SA1_SA1_iAMPActx_IC_noise.*rand(1,p.SA1_Npop);
SA1_SA1_iAMPActx_s = zeros(nsamp,p.SA1_Npop);
SA1_SA1_iAMPActx_s(1,:) = SA1_SA1_iAMPActx_s_last;
SA1_SB1_iGABActx_s_last =  p.SA1_SB1_iGABActx_IC+p.SA1_SB1_iGABActx_IC_noise.*rand(1,p.SB1_Npop);
SA1_SB1_iGABActx_s = zeros(nsamp,p.SB1_Npop);
SA1_SB1_iGABActx_s(1,:) = SA1_SB1_iGABActx_s_last;
SB1_SB1_iGABActx_s_last =  p.SB1_SB1_iGABActx_IC+p.SB1_SB1_iGABActx_IC_noise.*rand(1,p.SB1_Npop);
SB1_SB1_iGABActx_s = zeros(nsamp,p.SB1_Npop);
SB1_SB1_iGABActx_s(1,:) = SB1_SB1_iGABActx_s_last;
SA2_SC1_iAMPActx_s_last =  p.SA2_SC1_iAMPActx_IC+p.SA2_SC1_iAMPActx_IC_noise.*rand(1,p.SC1_Npop);
SA2_SC1_iAMPActx_s = zeros(nsamp,p.SC1_Npop);
SA2_SC1_iAMPActx_s(1,:) = SA2_SC1_iAMPActx_s_last;
SC1_SC1_iAMPActx_s_last =  p.SC1_SC1_iAMPActx_IC+p.SC1_SC1_iAMPActx_IC_noise.*rand(1,p.SC1_Npop);
SC1_SC1_iAMPActx_s = zeros(nsamp,p.SC1_Npop);
SC1_SC1_iAMPActx_s(1,:) = SC1_SC1_iAMPActx_s_last;
SC1_SA2_iGABActx_s_last =  p.SC1_SA2_iGABActx_IC+p.SC1_SA2_iGABActx_IC_noise.*rand(1,p.SA2_Npop);
SC1_SA2_iGABActx_s = zeros(nsamp,p.SA2_Npop);
SC1_SA2_iGABActx_s(1,:) = SC1_SA2_iGABActx_s_last;
SA2_SA2_iGABActx_s_last =  p.SA2_SA2_iGABActx_IC+p.SA2_SA2_iGABActx_IC_noise.*rand(1,p.SA2_Npop);
SA2_SA2_iGABActx_s = zeros(nsamp,p.SA2_Npop);
SA2_SA2_iGABActx_s(1,:) = SA2_SA2_iGABActx_s_last;
SC2_SB2_iAMPActx_s_last =  p.SC2_SB2_iAMPActx_IC+p.SC2_SB2_iAMPActx_IC_noise.*rand(1,p.SB2_Npop);
SC2_SB2_iAMPActx_s = zeros(nsamp,p.SB2_Npop);
SC2_SB2_iAMPActx_s(1,:) = SC2_SB2_iAMPActx_s_last;
SB2_SB2_iAMPActx_s_last =  p.SB2_SB2_iAMPActx_IC+p.SB2_SB2_iAMPActx_IC_noise.*rand(1,p.SB2_Npop);
SB2_SB2_iAMPActx_s = zeros(nsamp,p.SB2_Npop);
SB2_SB2_iAMPActx_s(1,:) = SB2_SB2_iAMPActx_s_last;
SB2_SC2_iGABActx_s_last =  p.SB2_SC2_iGABActx_IC+p.SB2_SC2_iGABActx_IC_noise.*rand(1,p.SC2_Npop);
SB2_SC2_iGABActx_s = zeros(nsamp,p.SC2_Npop);
SB2_SC2_iGABActx_s(1,:) = SB2_SC2_iGABActx_s_last;
SC2_SC2_iGABActx_s_last =  p.SC2_SC2_iGABActx_IC+p.SC2_SC2_iGABActx_IC_noise.*rand(1,p.SC2_Npop);
SC2_SC2_iGABActx_s = zeros(nsamp,p.SC2_Npop);
SC2_SC2_iGABActx_s(1,:) = SC2_SC2_iGABActx_s_last;
Cx2_Cx1_iAMPActx_s_last =  p.Cx2_Cx1_iAMPActx_IC+p.Cx2_Cx1_iAMPActx_IC_noise.*rand(1,p.Cx1_Npop);
Cx2_Cx1_iAMPActx_s = zeros(nsamp,p.Cx1_Npop);
Cx2_Cx1_iAMPActx_s(1,:) = Cx2_Cx1_iAMPActx_s_last;
Cx1_Cx1_iAMPActx_s_last =  p.Cx1_Cx1_iAMPActx_IC+p.Cx1_Cx1_iAMPActx_IC_noise.*rand(1,p.Cx1_Npop);
Cx1_Cx1_iAMPActx_s = zeros(nsamp,p.Cx1_Npop);
Cx1_Cx1_iAMPActx_s(1,:) = Cx1_Cx1_iAMPActx_s_last;
Cx1_Cx2_iGABActx_s_last =  p.Cx1_Cx2_iGABActx_IC+p.Cx1_Cx2_iGABActx_IC_noise.*rand(1,p.Cx2_Npop);
Cx1_Cx2_iGABActx_s = zeros(nsamp,p.Cx2_Npop);
Cx1_Cx2_iGABActx_s(1,:) = Cx1_Cx2_iGABActx_s_last;
Cx2_Cx2_iGABActx_s_last =  p.Cx2_Cx2_iGABActx_IC+p.Cx2_Cx2_iGABActx_IC_noise.*rand(1,p.Cx2_Npop);
Cx2_Cx2_iGABActx_s = zeros(nsamp,p.Cx2_Npop);
Cx2_Cx2_iGABActx_s(1,:) = Cx2_Cx2_iGABActx_s_last;
midE_SA1_iAMPActx_s_last =  p.midE_SA1_iAMPActx_IC+p.midE_SA1_iAMPActx_IC_noise.*rand(1,p.SA1_Npop);
midE_SA1_iAMPActx_s = zeros(nsamp,p.SA1_Npop);
midE_SA1_iAMPActx_s(1,:) = midE_SA1_iAMPActx_s_last;
midE_SA2_iAMPActx_s_last =  p.midE_SA2_iAMPActx_IC+p.midE_SA2_iAMPActx_IC_noise.*rand(1,p.SA2_Npop);
midE_SA2_iAMPActx_s = zeros(nsamp,p.SA2_Npop);
midE_SA2_iAMPActx_s(1,:) = midE_SA2_iAMPActx_s_last;
midE_SB1_iAMPActx_s_last =  p.midE_SB1_iAMPActx_IC+p.midE_SB1_iAMPActx_IC_noise.*rand(1,p.SB1_Npop);
midE_SB1_iAMPActx_s = zeros(nsamp,p.SB1_Npop);
midE_SB1_iAMPActx_s(1,:) = midE_SB1_iAMPActx_s_last;
midE_SB2_iAMPActx_s_last =  p.midE_SB2_iAMPActx_IC+p.midE_SB2_iAMPActx_IC_noise.*rand(1,p.SB2_Npop);
midE_SB2_iAMPActx_s = zeros(nsamp,p.SB2_Npop);
midE_SB2_iAMPActx_s(1,:) = midE_SB2_iAMPActx_s_last;
midE_SC1_iAMPActx_s_last =  p.midE_SC1_iAMPActx_IC+p.midE_SC1_iAMPActx_IC_noise.*rand(1,p.SC1_Npop);
midE_SC1_iAMPActx_s = zeros(nsamp,p.SC1_Npop);
midE_SC1_iAMPActx_s(1,:) = midE_SC1_iAMPActx_s_last;
midE_SC2_iAMPActx_s_last =  p.midE_SC2_iAMPActx_IC+p.midE_SC2_iAMPActx_IC_noise.*rand(1,p.SC2_Npop);
midE_SC2_iAMPActx_s = zeros(nsamp,p.SC2_Npop);
midE_SC2_iAMPActx_s(1,:) = midE_SC2_iAMPActx_s_last;
midE_Cx1_iAMPActx_s_last =  p.midE_Cx1_iAMPActx_IC+p.midE_Cx1_iAMPActx_IC_noise.*rand(1,p.Cx1_Npop);
midE_Cx1_iAMPActx_s = zeros(nsamp,p.Cx1_Npop);
midE_Cx1_iAMPActx_s(1,:) = midE_Cx1_iAMPActx_s_last;
midE_Cx2_iAMPActx_s_last =  p.midE_Cx2_iAMPActx_IC+p.midE_Cx2_iAMPActx_IC_noise.*rand(1,p.Cx2_Npop);
midE_Cx2_iAMPActx_s = zeros(nsamp,p.Cx2_Npop);
midE_Cx2_iAMPActx_s(1,:) = midE_Cx2_iAMPActx_s_last;
supE_midE_iAMPActx_s_last =  p.supE_midE_iAMPActx_IC+p.supE_midE_iAMPActx_IC_noise.*rand(1,p.midE_Npop);
supE_midE_iAMPActx_s = zeros(nsamp,p.midE_Npop);
supE_midE_iAMPActx_s(1,:) = supE_midE_iAMPActx_s_last;
deepE_midE_iAMPActx_s_last =  p.deepE_midE_iAMPActx_IC+p.deepE_midE_iAMPActx_IC_noise.*rand(1,p.midE_Npop);
deepE_midE_iAMPActx_s = zeros(nsamp,p.midE_Npop);
deepE_midE_iAMPActx_s(1,:) = deepE_midE_iAMPActx_s_last;
deepE_midI_iGABActx_s_last =  p.deepE_midI_iGABActx_IC+p.deepE_midI_iGABActx_IC_noise.*rand(1,p.midI_Npop);
deepE_midI_iGABActx_s = zeros(nsamp,p.midI_Npop);
deepE_midI_iGABActx_s(1,:) = deepE_midI_iGABActx_s_last;
deepE_supE_iAMPActx_s_last =  p.deepE_supE_iAMPActx_IC+p.deepE_supE_iAMPActx_IC_noise.*rand(1,p.supE_Npop);
deepE_supE_iAMPActx_s = zeros(nsamp,p.supE_Npop);
deepE_supE_iAMPActx_s(1,:) = deepE_supE_iAMPActx_s_last;

% MONITORS:
supE_ctx_iPoisson_g_poisson = zeros(nsamp,p.supE_Npop);
supE_ctx_iPoisson_g_poisson(1,:)=p.supE_ctx_iPoisson_g_poisson.*supE_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:);
supE_ctx_iPoisson_I_poisson = zeros(nsamp,p.supE_Npop);
supE_ctx_iPoisson_I_poisson(1,:)=-((p.supE_ctx_iPoisson_g_poisson.*supE_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:))).*(supE_V_last-p.supE_ctx_iPoisson_E_poisson);
supI_ctx_iPoisson_g_poisson = zeros(nsamp,p.supI_Npop);
supI_ctx_iPoisson_g_poisson(1,:)=p.supI_ctx_iPoisson_g_poisson.*supI_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:);
supI_ctx_iPoisson_I_poisson = zeros(nsamp,p.supI_Npop);
supI_ctx_iPoisson_I_poisson(1,:)=-((p.supI_ctx_iPoisson_g_poisson.*supI_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:))).*(supI_V_last-p.supI_ctx_iPoisson_E_poisson);
midE_ctx_iPoisson_g_poisson = zeros(nsamp,p.midE_Npop);
midE_ctx_iPoisson_g_poisson(1,:)=p.midE_ctx_iPoisson_g_poisson.*midE_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:);
midE_ctx_iPoisson_I_poisson = zeros(nsamp,p.midE_Npop);
midE_ctx_iPoisson_I_poisson(1,:)=-((p.midE_ctx_iPoisson_g_poisson.*midE_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:))).*(midE_V_last-p.midE_ctx_iPoisson_E_poisson);
midI_ctx_iPoisson_g_poisson = zeros(nsamp,p.midI_Npop);
midI_ctx_iPoisson_g_poisson(1,:)=p.midI_ctx_iPoisson_g_poisson.*midI_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:);
midI_ctx_iPoisson_I_poisson = zeros(nsamp,p.midI_Npop);
midI_ctx_iPoisson_I_poisson(1,:)=-((p.midI_ctx_iPoisson_g_poisson.*midI_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:))).*(midI_V_last-p.midI_ctx_iPoisson_E_poisson);
deepE_ctx_iPoisson_g_poisson = zeros(nsamp,p.deepE_Npop);
deepE_ctx_iPoisson_g_poisson(1,:)=p.deepE_ctx_iPoisson_g_poisson.*deepE_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:);
deepE_ctx_iPoisson_I_poisson = zeros(nsamp,p.deepE_Npop);
deepE_ctx_iPoisson_I_poisson(1,:)=-((p.deepE_ctx_iPoisson_g_poisson.*deepE_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:))).*(deepE_V_last-p.deepE_ctx_iPoisson_E_poisson);
deepI_ctx_iPoisson_g_poisson = zeros(nsamp,p.deepI_Npop);
deepI_ctx_iPoisson_g_poisson(1,:)=p.deepI_ctx_iPoisson_g_poisson.*deepI_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:);
deepI_ctx_iPoisson_I_poisson = zeros(nsamp,p.deepI_Npop);
deepI_ctx_iPoisson_I_poisson(1,:)=-((p.deepI_ctx_iPoisson_g_poisson.*deepI_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:))).*(deepI_V_last-p.deepI_ctx_iPoisson_E_poisson);
SA1_ctx_iPoisson_g_poisson = zeros(nsamp,p.SA1_Npop);
SA1_ctx_iPoisson_g_poisson(1,:)=p.SA1_ctx_iPoisson_g_poisson.*SA1_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:);
SA1_ctx_iPoisson_I_poisson = zeros(nsamp,p.SA1_Npop);
SA1_ctx_iPoisson_I_poisson(1,:)=-((p.SA1_ctx_iPoisson_g_poisson.*SA1_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:))).*(SA1_V_last-p.SA1_ctx_iPoisson_E_poisson);
SB1_ctx_iPoisson_g_poisson = zeros(nsamp,p.SB1_Npop);
SB1_ctx_iPoisson_g_poisson(1,:)=p.SB1_ctx_iPoisson_g_poisson.*SB1_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:);
SB1_ctx_iPoisson_I_poisson = zeros(nsamp,p.SB1_Npop);
SB1_ctx_iPoisson_I_poisson(1,:)=-((p.SB1_ctx_iPoisson_g_poisson.*SB1_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:))).*(SB1_V_last-p.SB1_ctx_iPoisson_E_poisson);
SC1_ctx_iPoisson_g_poisson = zeros(nsamp,p.SC1_Npop);
SC1_ctx_iPoisson_g_poisson(1,:)=p.SC1_ctx_iPoisson_g_poisson.*SC1_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:);
SC1_ctx_iPoisson_I_poisson = zeros(nsamp,p.SC1_Npop);
SC1_ctx_iPoisson_I_poisson(1,:)=-((p.SC1_ctx_iPoisson_g_poisson.*SC1_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:))).*(SC1_V_last-p.SC1_ctx_iPoisson_E_poisson);
SA2_ctx_iPoisson_g_poisson = zeros(nsamp,p.SA2_Npop);
SA2_ctx_iPoisson_g_poisson(1,:)=p.SA2_ctx_iPoisson_g_poisson.*SA2_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:);
SA2_ctx_iPoisson_I_poisson = zeros(nsamp,p.SA2_Npop);
SA2_ctx_iPoisson_I_poisson(1,:)=-((p.SA2_ctx_iPoisson_g_poisson.*SA2_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:))).*(SA2_V_last-p.SA2_ctx_iPoisson_E_poisson);
SB2_ctx_iPoisson_g_poisson = zeros(nsamp,p.SB2_Npop);
SB2_ctx_iPoisson_g_poisson(1,:)=p.SB2_ctx_iPoisson_g_poisson.*SB2_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:);
SB2_ctx_iPoisson_I_poisson = zeros(nsamp,p.SB2_Npop);
SB2_ctx_iPoisson_I_poisson(1,:)=-((p.SB2_ctx_iPoisson_g_poisson.*SB2_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:))).*(SB2_V_last-p.SB2_ctx_iPoisson_E_poisson);
SC2_ctx_iPoisson_g_poisson = zeros(nsamp,p.SC2_Npop);
SC2_ctx_iPoisson_g_poisson(1,:)=p.SC2_ctx_iPoisson_g_poisson.*SC2_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:);
SC2_ctx_iPoisson_I_poisson = zeros(nsamp,p.SC2_Npop);
SC2_ctx_iPoisson_I_poisson(1,:)=-((p.SC2_ctx_iPoisson_g_poisson.*SC2_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:))).*(SC2_V_last-p.SC2_ctx_iPoisson_E_poisson);
Cx1_ctx_iPoisson_g_poisson = zeros(nsamp,p.Cx1_Npop);
Cx1_ctx_iPoisson_g_poisson(1,:)=p.Cx1_ctx_iPoisson_g_poisson.*Cx1_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:);
Cx1_ctx_iPoisson_I_poisson = zeros(nsamp,p.Cx1_Npop);
Cx1_ctx_iPoisson_I_poisson(1,:)=-((p.Cx1_ctx_iPoisson_g_poisson.*Cx1_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:))).*(Cx1_V_last-p.Cx1_ctx_iPoisson_E_poisson);
Cx2_ctx_iPoisson_g_poisson = zeros(nsamp,p.Cx2_Npop);
Cx2_ctx_iPoisson_g_poisson(1,:)=p.Cx2_ctx_iPoisson_g_poisson.*Cx2_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:);
Cx2_ctx_iPoisson_I_poisson = zeros(nsamp,p.Cx2_Npop);
Cx2_ctx_iPoisson_I_poisson(1,:)=-((p.Cx2_ctx_iPoisson_g_poisson.*Cx2_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:))).*(Cx2_V_last-p.Cx2_ctx_iPoisson_E_poisson);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  supE_V_k1 = (p.supE_Iapp + ((((-p.supE_iNa_gNa.*supE_iNa_m_last.^3.*supE_iNa_h_last.*(supE_V_last-p.supE_iNa_ENa))))+((((-p.supE_iK_gK.*supE_iK_n_last.^4.*(supE_V_last-p.supE_iK_EK))))+((((-((p.supE_ctx_iPoisson_g_poisson.*supE_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:))).*(supE_V_last-p.supE_ctx_iPoisson_E_poisson))))+((-(((p.supE_supE_iAMPActx_gAMPA.*(supE_supE_iAMPActx_s_last*p.supE_supE_iAMPActx_netcon).*(supE_V_last-p.supE_supE_iAMPActx_EAMPA)))))+((((-p.supE_supI_iGABActx_gGABAa.*(supE_supI_iGABActx_s_last*p.supE_supI_iGABActx_netcon).*(supE_V_last-p.supE_supI_iGABActx_EGABAa))))+((-(((p.supE_midE_iAMPActx_gAMPA.*(supE_midE_iAMPActx_s_last*p.supE_midE_iAMPActx_netcon).*(supE_V_last-p.supE_midE_iAMPActx_EAMPA))))))))))) + p.supE_noise*randn(1, p.supE_Npop))/p.supE_C;
  supE_iNa_m_k1 = (((2.5-.1*(supE_V_last+65))./(exp(2.5-.1*(supE_V_last+65))-1))).*(1-supE_iNa_m_last)-((4*exp(-(supE_V_last+65)/18))).*supE_iNa_m_last;
  supE_iNa_h_k1 = ((.07*exp(-(supE_V_last+65)/20))).*(1-supE_iNa_h_last)-((1./(exp(3-.1*(supE_V_last+65))+1))).*supE_iNa_h_last;
  supE_iK_n_k1 = (((.1-.01*(supE_V_last+65))./(exp(1-.1*(supE_V_last+65))-1))).*(1-supE_iK_n_last)-((.125*exp(-(supE_V_last+65)/80))).*supE_iK_n_last;
  supI_V_k1 = (p.supI_Iapp + ((((-p.supI_iNa_gNa.*supI_iNa_m_last.^3.*supI_iNa_h_last.*(supI_V_last-p.supI_iNa_ENa))))+((((-p.supI_iK_gK.*supI_iK_n_last.^4.*(supI_V_last-p.supI_iK_EK))))+((((-((p.supI_ctx_iPoisson_g_poisson.*supI_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:))).*(supI_V_last-p.supI_ctx_iPoisson_E_poisson))))+((-(((p.supI_supE_iAMPActx_gAMPA.*(supI_supE_iAMPActx_s_last*p.supI_supE_iAMPActx_netcon).*(supI_V_last-p.supI_supE_iAMPActx_EAMPA)))))+((((-p.supI_supI_iGABActx_gGABAa.*(supI_supI_iGABActx_s_last*p.supI_supI_iGABActx_netcon).*(supI_V_last-p.supI_supI_iGABActx_EGABAa))))))))) + p.supI_noise*randn(1, p.supI_Npop))/p.supI_C;
  supI_iNa_m_k1 = (((2.5-.1*(supI_V_last+65))./(exp(2.5-.1*(supI_V_last+65))-1))).*(1-supI_iNa_m_last)-((4*exp(-(supI_V_last+65)/18))).*supI_iNa_m_last;
  supI_iNa_h_k1 = ((.07*exp(-(supI_V_last+65)/20))).*(1-supI_iNa_h_last)-((1./(exp(3-.1*(supI_V_last+65))+1))).*supI_iNa_h_last;
  supI_iK_n_k1 = (((.1-.01*(supI_V_last+65))./(exp(1-.1*(supI_V_last+65))-1))).*(1-supI_iK_n_last)-((.125*exp(-(supI_V_last+65)/80))).*supI_iK_n_last;
  midE_V_k1 = (p.midE_Iapp + ((((-p.midE_iNa_gNa.*midE_iNa_m_last.^3.*midE_iNa_h_last.*(midE_V_last-p.midE_iNa_ENa))))+((((-p.midE_iK_gK.*midE_iK_n_last.^4.*(midE_V_last-p.midE_iK_EK))))+((((-((p.midE_ctx_iPoisson_g_poisson.*midE_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:))).*(midE_V_last-p.midE_ctx_iPoisson_E_poisson))))+((-(((p.midE_midE_iAMPActx_gAMPA.*(midE_midE_iAMPActx_s_last*p.midE_midE_iAMPActx_netcon).*(midE_V_last-p.midE_midE_iAMPActx_EAMPA)))))+((((-p.midE_midI_iGABActx_gGABAa.*(midE_midI_iGABActx_s_last*p.midE_midI_iGABActx_netcon).*(midE_V_last-p.midE_midI_iGABActx_EGABAa))))+((-(((p.midE_SA1_iAMPActx_gAMPA.*(midE_SA1_iAMPActx_s_last*p.midE_SA1_iAMPActx_netcon).*(midE_V_last-p.midE_SA1_iAMPActx_EAMPA)))))+((-(((p.midE_SA2_iAMPActx_gAMPA.*(midE_SA2_iAMPActx_s_last*p.midE_SA2_iAMPActx_netcon).*(midE_V_last-p.midE_SA2_iAMPActx_EAMPA)))))+((-(((p.midE_SB1_iAMPActx_gAMPA.*(midE_SB1_iAMPActx_s_last*p.midE_SB1_iAMPActx_netcon).*(midE_V_last-p.midE_SB1_iAMPActx_EAMPA)))))+((-(((p.midE_SB2_iAMPActx_gAMPA.*(midE_SB2_iAMPActx_s_last*p.midE_SB2_iAMPActx_netcon).*(midE_V_last-p.midE_SB2_iAMPActx_EAMPA)))))+((-(((p.midE_SC1_iAMPActx_gAMPA.*(midE_SC1_iAMPActx_s_last*p.midE_SC1_iAMPActx_netcon).*(midE_V_last-p.midE_SC1_iAMPActx_EAMPA)))))+((-(((p.midE_SC2_iAMPActx_gAMPA.*(midE_SC2_iAMPActx_s_last*p.midE_SC2_iAMPActx_netcon).*(midE_V_last-p.midE_SC2_iAMPActx_EAMPA)))))+((-(((p.midE_Cx1_iAMPActx_gAMPA.*(midE_Cx1_iAMPActx_s_last*p.midE_Cx1_iAMPActx_netcon).*(midE_V_last-p.midE_Cx1_iAMPActx_EAMPA)))))+((-(((p.midE_Cx2_iAMPActx_gAMPA.*(midE_Cx2_iAMPActx_s_last*p.midE_Cx2_iAMPActx_netcon).*(midE_V_last-p.midE_Cx2_iAMPActx_EAMPA)))))))))))))))))) + p.midE_noise*randn(1, p.midE_Npop))/p.midE_C;
  midE_iNa_m_k1 = (((2.5-.1*(midE_V_last+65))./(exp(2.5-.1*(midE_V_last+65))-1))).*(1-midE_iNa_m_last)-((4*exp(-(midE_V_last+65)/18))).*midE_iNa_m_last;
  midE_iNa_h_k1 = ((.07*exp(-(midE_V_last+65)/20))).*(1-midE_iNa_h_last)-((1./(exp(3-.1*(midE_V_last+65))+1))).*midE_iNa_h_last;
  midE_iK_n_k1 = (((.1-.01*(midE_V_last+65))./(exp(1-.1*(midE_V_last+65))-1))).*(1-midE_iK_n_last)-((.125*exp(-(midE_V_last+65)/80))).*midE_iK_n_last;
  midI_V_k1 = (p.midI_Iapp + ((((-p.midI_iNa_gNa.*midI_iNa_m_last.^3.*midI_iNa_h_last.*(midI_V_last-p.midI_iNa_ENa))))+((((-p.midI_iK_gK.*midI_iK_n_last.^4.*(midI_V_last-p.midI_iK_EK))))+((((-((p.midI_ctx_iPoisson_g_poisson.*midI_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:))).*(midI_V_last-p.midI_ctx_iPoisson_E_poisson))))+((-(((p.midI_midE_iAMPActx_gAMPA.*(midI_midE_iAMPActx_s_last*p.midI_midE_iAMPActx_netcon).*(midI_V_last-p.midI_midE_iAMPActx_EAMPA)))))+((((-p.midI_midI_iGABActx_gGABAa.*(midI_midI_iGABActx_s_last*p.midI_midI_iGABActx_netcon).*(midI_V_last-p.midI_midI_iGABActx_EGABAa))))))))) + p.midI_noise*randn(1, p.midI_Npop))/p.midI_C;
  midI_iNa_m_k1 = (((2.5-.1*(midI_V_last+65))./(exp(2.5-.1*(midI_V_last+65))-1))).*(1-midI_iNa_m_last)-((4*exp(-(midI_V_last+65)/18))).*midI_iNa_m_last;
  midI_iNa_h_k1 = ((.07*exp(-(midI_V_last+65)/20))).*(1-midI_iNa_h_last)-((1./(exp(3-.1*(midI_V_last+65))+1))).*midI_iNa_h_last;
  midI_iK_n_k1 = (((.1-.01*(midI_V_last+65))./(exp(1-.1*(midI_V_last+65))-1))).*(1-midI_iK_n_last)-((.125*exp(-(midI_V_last+65)/80))).*midI_iK_n_last;
  deepE_V_k1 = (p.deepE_Iapp + ((((-p.deepE_iNa_gNa.*deepE_iNa_m_last.^3.*deepE_iNa_h_last.*(deepE_V_last-p.deepE_iNa_ENa))))+((((-p.deepE_iK_gK.*deepE_iK_n_last.^4.*(deepE_V_last-p.deepE_iK_EK))))+((((-((p.deepE_ctx_iPoisson_g_poisson.*deepE_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:))).*(deepE_V_last-p.deepE_ctx_iPoisson_E_poisson))))+((-(((p.deepE_deepE_iAMPActx_gAMPA.*(deepE_deepE_iAMPActx_s_last*p.deepE_deepE_iAMPActx_netcon).*(deepE_V_last-p.deepE_deepE_iAMPActx_EAMPA)))))+((((-p.deepE_deepI_iGABActx_gGABAa.*(deepE_deepI_iGABActx_s_last*p.deepE_deepI_iGABActx_netcon).*(deepE_V_last-p.deepE_deepI_iGABActx_EGABAa))))+((-(((p.deepE_midE_iAMPActx_gAMPA.*(deepE_midE_iAMPActx_s_last*p.deepE_midE_iAMPActx_netcon).*(deepE_V_last-p.deepE_midE_iAMPActx_EAMPA)))))+((((-p.deepE_midI_iGABActx_gGABAa.*(deepE_midI_iGABActx_s_last*p.deepE_midI_iGABActx_netcon).*(deepE_V_last-p.deepE_midI_iGABActx_EGABAa))))+((-(((p.deepE_supE_iAMPActx_gAMPA.*(deepE_supE_iAMPActx_s_last*p.deepE_supE_iAMPActx_netcon).*(deepE_V_last-p.deepE_supE_iAMPActx_EAMPA))))))))))))) + p.deepE_noise*randn(1, p.deepE_Npop))/p.deepE_C;
  deepE_iNa_m_k1 = (((2.5-.1*(deepE_V_last+65))./(exp(2.5-.1*(deepE_V_last+65))-1))).*(1-deepE_iNa_m_last)-((4*exp(-(deepE_V_last+65)/18))).*deepE_iNa_m_last;
  deepE_iNa_h_k1 = ((.07*exp(-(deepE_V_last+65)/20))).*(1-deepE_iNa_h_last)-((1./(exp(3-.1*(deepE_V_last+65))+1))).*deepE_iNa_h_last;
  deepE_iK_n_k1 = (((.1-.01*(deepE_V_last+65))./(exp(1-.1*(deepE_V_last+65))-1))).*(1-deepE_iK_n_last)-((.125*exp(-(deepE_V_last+65)/80))).*deepE_iK_n_last;
  deepI_V_k1 = (p.deepI_Iapp + ((((-p.deepI_iNa_gNa.*deepI_iNa_m_last.^3.*deepI_iNa_h_last.*(deepI_V_last-p.deepI_iNa_ENa))))+((((-p.deepI_iK_gK.*deepI_iK_n_last.^4.*(deepI_V_last-p.deepI_iK_EK))))+((((-((p.deepI_ctx_iPoisson_g_poisson.*deepI_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:))).*(deepI_V_last-p.deepI_ctx_iPoisson_E_poisson))))+((-(((p.deepI_deepE_iAMPActx_gAMPA.*(deepI_deepE_iAMPActx_s_last*p.deepI_deepE_iAMPActx_netcon).*(deepI_V_last-p.deepI_deepE_iAMPActx_EAMPA)))))+((((-p.deepI_deepI_iGABActx_gGABAa.*(deepI_deepI_iGABActx_s_last*p.deepI_deepI_iGABActx_netcon).*(deepI_V_last-p.deepI_deepI_iGABActx_EGABAa))))))))) + p.deepI_noise*randn(1, p.deepI_Npop))/p.deepI_C;
  deepI_iNa_m_k1 = (((2.5-.1*(deepI_V_last+65))./(exp(2.5-.1*(deepI_V_last+65))-1))).*(1-deepI_iNa_m_last)-((4*exp(-(deepI_V_last+65)/18))).*deepI_iNa_m_last;
  deepI_iNa_h_k1 = ((.07*exp(-(deepI_V_last+65)/20))).*(1-deepI_iNa_h_last)-((1./(exp(3-.1*(deepI_V_last+65))+1))).*deepI_iNa_h_last;
  deepI_iK_n_k1 = (((.1-.01*(deepI_V_last+65))./(exp(1-.1*(deepI_V_last+65))-1))).*(1-deepI_iK_n_last)-((.125*exp(-(deepI_V_last+65)/80))).*deepI_iK_n_last;
  SA1_V_k1 = (p.SA1_Iapp + ((((-p.SA1_iNa_gNa.*SA1_iNa_m_last.^3.*SA1_iNa_h_last.*(SA1_V_last-p.SA1_iNa_ENa))))+((((-p.SA1_iK_gK.*SA1_iK_n_last.^4.*(SA1_V_last-p.SA1_iK_EK))))+((((-((p.SA1_ctx_iPoisson_g_poisson.*SA1_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:))).*(SA1_V_last-p.SA1_ctx_iPoisson_E_poisson))))+((-(((p.SA1_SA1_iAMPActx_gAMPA.*(SA1_SA1_iAMPActx_s_last*p.SA1_SA1_iAMPActx_netcon).*(SA1_V_last-p.SA1_SA1_iAMPActx_EAMPA)))))+((((-p.SA1_SB1_iGABActx_gGABAa.*(SA1_SB1_iGABActx_s_last*p.SA1_SB1_iGABActx_netcon).*(SA1_V_last-p.SA1_SB1_iGABActx_EGABAa))))))))) + p.SA1_noise*randn(1, p.SA1_Npop))/p.SA1_C;
  SA1_iNa_m_k1 = (((2.5-.1*(SA1_V_last+65))./(exp(2.5-.1*(SA1_V_last+65))-1))).*(1-SA1_iNa_m_last)-((4*exp(-(SA1_V_last+65)/18))).*SA1_iNa_m_last;
  SA1_iNa_h_k1 = ((.07*exp(-(SA1_V_last+65)/20))).*(1-SA1_iNa_h_last)-((1./(exp(3-.1*(SA1_V_last+65))+1))).*SA1_iNa_h_last;
  SA1_iK_n_k1 = (((.1-.01*(SA1_V_last+65))./(exp(1-.1*(SA1_V_last+65))-1))).*(1-SA1_iK_n_last)-((.125*exp(-(SA1_V_last+65)/80))).*SA1_iK_n_last;
  SB1_V_k1 = (p.SB1_Iapp + ((((-p.SB1_iNa_gNa.*SB1_iNa_m_last.^3.*SB1_iNa_h_last.*(SB1_V_last-p.SB1_iNa_ENa))))+((((-p.SB1_iK_gK.*SB1_iK_n_last.^4.*(SB1_V_last-p.SB1_iK_EK))))+((((-((p.SB1_ctx_iPoisson_g_poisson.*SB1_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:))).*(SB1_V_last-p.SB1_ctx_iPoisson_E_poisson))))+((-(((p.SB1_SA1_iAMPActx_gAMPA.*(SB1_SA1_iAMPActx_s_last*p.SB1_SA1_iAMPActx_netcon).*(SB1_V_last-p.SB1_SA1_iAMPActx_EAMPA)))))+((((-p.SB1_SB1_iGABActx_gGABAa.*(SB1_SB1_iGABActx_s_last*p.SB1_SB1_iGABActx_netcon).*(SB1_V_last-p.SB1_SB1_iGABActx_EGABAa))))))))) + p.SB1_noise*randn(1, p.SB1_Npop))/p.SB1_C;
  SB1_iNa_m_k1 = (((2.5-.1*(SB1_V_last+65))./(exp(2.5-.1*(SB1_V_last+65))-1))).*(1-SB1_iNa_m_last)-((4*exp(-(SB1_V_last+65)/18))).*SB1_iNa_m_last;
  SB1_iNa_h_k1 = ((.07*exp(-(SB1_V_last+65)/20))).*(1-SB1_iNa_h_last)-((1./(exp(3-.1*(SB1_V_last+65))+1))).*SB1_iNa_h_last;
  SB1_iK_n_k1 = (((.1-.01*(SB1_V_last+65))./(exp(1-.1*(SB1_V_last+65))-1))).*(1-SB1_iK_n_last)-((.125*exp(-(SB1_V_last+65)/80))).*SB1_iK_n_last;
  SC1_V_k1 = (p.SC1_Iapp + ((((-p.SC1_iNa_gNa.*SC1_iNa_m_last.^3.*SC1_iNa_h_last.*(SC1_V_last-p.SC1_iNa_ENa))))+((((-p.SC1_iK_gK.*SC1_iK_n_last.^4.*(SC1_V_last-p.SC1_iK_EK))))+((((-((p.SC1_ctx_iPoisson_g_poisson.*SC1_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:))).*(SC1_V_last-p.SC1_ctx_iPoisson_E_poisson))))+((-(((p.SC1_SC1_iAMPActx_gAMPA.*(SC1_SC1_iAMPActx_s_last*p.SC1_SC1_iAMPActx_netcon).*(SC1_V_last-p.SC1_SC1_iAMPActx_EAMPA)))))+((((-p.SC1_SA2_iGABActx_gGABAa.*(SC1_SA2_iGABActx_s_last*p.SC1_SA2_iGABActx_netcon).*(SC1_V_last-p.SC1_SA2_iGABActx_EGABAa))))))))) + p.SC1_noise*randn(1, p.SC1_Npop))/p.SC1_C;
  SC1_iNa_m_k1 = (((2.5-.1*(SC1_V_last+65))./(exp(2.5-.1*(SC1_V_last+65))-1))).*(1-SC1_iNa_m_last)-((4*exp(-(SC1_V_last+65)/18))).*SC1_iNa_m_last;
  SC1_iNa_h_k1 = ((.07*exp(-(SC1_V_last+65)/20))).*(1-SC1_iNa_h_last)-((1./(exp(3-.1*(SC1_V_last+65))+1))).*SC1_iNa_h_last;
  SC1_iK_n_k1 = (((.1-.01*(SC1_V_last+65))./(exp(1-.1*(SC1_V_last+65))-1))).*(1-SC1_iK_n_last)-((.125*exp(-(SC1_V_last+65)/80))).*SC1_iK_n_last;
  SA2_V_k1 = (p.SA2_Iapp + ((((-p.SA2_iNa_gNa.*SA2_iNa_m_last.^3.*SA2_iNa_h_last.*(SA2_V_last-p.SA2_iNa_ENa))))+((((-p.SA2_iK_gK.*SA2_iK_n_last.^4.*(SA2_V_last-p.SA2_iK_EK))))+((((-((p.SA2_ctx_iPoisson_g_poisson.*SA2_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:))).*(SA2_V_last-p.SA2_ctx_iPoisson_E_poisson))))+((-(((p.SA2_SC1_iAMPActx_gAMPA.*(SA2_SC1_iAMPActx_s_last*p.SA2_SC1_iAMPActx_netcon).*(SA2_V_last-p.SA2_SC1_iAMPActx_EAMPA)))))+((((-p.SA2_SA2_iGABActx_gGABAa.*(SA2_SA2_iGABActx_s_last*p.SA2_SA2_iGABActx_netcon).*(SA2_V_last-p.SA2_SA2_iGABActx_EGABAa))))))))) + p.SA2_noise*randn(1, p.SA2_Npop))/p.SA2_C;
  SA2_iNa_m_k1 = (((2.5-.1*(SA2_V_last+65))./(exp(2.5-.1*(SA2_V_last+65))-1))).*(1-SA2_iNa_m_last)-((4*exp(-(SA2_V_last+65)/18))).*SA2_iNa_m_last;
  SA2_iNa_h_k1 = ((.07*exp(-(SA2_V_last+65)/20))).*(1-SA2_iNa_h_last)-((1./(exp(3-.1*(SA2_V_last+65))+1))).*SA2_iNa_h_last;
  SA2_iK_n_k1 = (((.1-.01*(SA2_V_last+65))./(exp(1-.1*(SA2_V_last+65))-1))).*(1-SA2_iK_n_last)-((.125*exp(-(SA2_V_last+65)/80))).*SA2_iK_n_last;
  SB2_V_k1 = (p.SB2_Iapp + ((((-p.SB2_iNa_gNa.*SB2_iNa_m_last.^3.*SB2_iNa_h_last.*(SB2_V_last-p.SB2_iNa_ENa))))+((((-p.SB2_iK_gK.*SB2_iK_n_last.^4.*(SB2_V_last-p.SB2_iK_EK))))+((((-((p.SB2_ctx_iPoisson_g_poisson.*SB2_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:))).*(SB2_V_last-p.SB2_ctx_iPoisson_E_poisson))))+((-(((p.SB2_SB2_iAMPActx_gAMPA.*(SB2_SB2_iAMPActx_s_last*p.SB2_SB2_iAMPActx_netcon).*(SB2_V_last-p.SB2_SB2_iAMPActx_EAMPA)))))+((((-p.SB2_SC2_iGABActx_gGABAa.*(SB2_SC2_iGABActx_s_last*p.SB2_SC2_iGABActx_netcon).*(SB2_V_last-p.SB2_SC2_iGABActx_EGABAa))))))))) + p.SB2_noise*randn(1, p.SB2_Npop))/p.SB2_C;
  SB2_iNa_m_k1 = (((2.5-.1*(SB2_V_last+65))./(exp(2.5-.1*(SB2_V_last+65))-1))).*(1-SB2_iNa_m_last)-((4*exp(-(SB2_V_last+65)/18))).*SB2_iNa_m_last;
  SB2_iNa_h_k1 = ((.07*exp(-(SB2_V_last+65)/20))).*(1-SB2_iNa_h_last)-((1./(exp(3-.1*(SB2_V_last+65))+1))).*SB2_iNa_h_last;
  SB2_iK_n_k1 = (((.1-.01*(SB2_V_last+65))./(exp(1-.1*(SB2_V_last+65))-1))).*(1-SB2_iK_n_last)-((.125*exp(-(SB2_V_last+65)/80))).*SB2_iK_n_last;
  SC2_V_k1 = (p.SC2_Iapp + ((((-p.SC2_iNa_gNa.*SC2_iNa_m_last.^3.*SC2_iNa_h_last.*(SC2_V_last-p.SC2_iNa_ENa))))+((((-p.SC2_iK_gK.*SC2_iK_n_last.^4.*(SC2_V_last-p.SC2_iK_EK))))+((((-((p.SC2_ctx_iPoisson_g_poisson.*SC2_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:))).*(SC2_V_last-p.SC2_ctx_iPoisson_E_poisson))))+((-(((p.SC2_SB2_iAMPActx_gAMPA.*(SC2_SB2_iAMPActx_s_last*p.SC2_SB2_iAMPActx_netcon).*(SC2_V_last-p.SC2_SB2_iAMPActx_EAMPA)))))+((((-p.SC2_SC2_iGABActx_gGABAa.*(SC2_SC2_iGABActx_s_last*p.SC2_SC2_iGABActx_netcon).*(SC2_V_last-p.SC2_SC2_iGABActx_EGABAa))))))))) + p.SC2_noise*randn(1, p.SC2_Npop))/p.SC2_C;
  SC2_iNa_m_k1 = (((2.5-.1*(SC2_V_last+65))./(exp(2.5-.1*(SC2_V_last+65))-1))).*(1-SC2_iNa_m_last)-((4*exp(-(SC2_V_last+65)/18))).*SC2_iNa_m_last;
  SC2_iNa_h_k1 = ((.07*exp(-(SC2_V_last+65)/20))).*(1-SC2_iNa_h_last)-((1./(exp(3-.1*(SC2_V_last+65))+1))).*SC2_iNa_h_last;
  SC2_iK_n_k1 = (((.1-.01*(SC2_V_last+65))./(exp(1-.1*(SC2_V_last+65))-1))).*(1-SC2_iK_n_last)-((.125*exp(-(SC2_V_last+65)/80))).*SC2_iK_n_last;
  Cx1_V_k1 = (p.Cx1_Iapp + ((((-p.Cx1_iNa_gNa.*Cx1_iNa_m_last.^3.*Cx1_iNa_h_last.*(Cx1_V_last-p.Cx1_iNa_ENa))))+((((-p.Cx1_iK_gK.*Cx1_iK_n_last.^4.*(Cx1_V_last-p.Cx1_iK_EK))))+((((-((p.Cx1_ctx_iPoisson_g_poisson.*Cx1_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:))).*(Cx1_V_last-p.Cx1_ctx_iPoisson_E_poisson))))+((-(((p.Cx1_Cx1_iAMPActx_gAMPA.*(Cx1_Cx1_iAMPActx_s_last*p.Cx1_Cx1_iAMPActx_netcon).*(Cx1_V_last-p.Cx1_Cx1_iAMPActx_EAMPA)))))+((((-p.Cx1_Cx2_iGABActx_gGABAa.*(Cx1_Cx2_iGABActx_s_last*p.Cx1_Cx2_iGABActx_netcon).*(Cx1_V_last-p.Cx1_Cx2_iGABActx_EGABAa))))))))) + p.Cx1_noise*randn(1, p.Cx1_Npop))/p.Cx1_C;
  Cx1_iNa_m_k1 = (((2.5-.1*(Cx1_V_last+65))./(exp(2.5-.1*(Cx1_V_last+65))-1))).*(1-Cx1_iNa_m_last)-((4*exp(-(Cx1_V_last+65)/18))).*Cx1_iNa_m_last;
  Cx1_iNa_h_k1 = ((.07*exp(-(Cx1_V_last+65)/20))).*(1-Cx1_iNa_h_last)-((1./(exp(3-.1*(Cx1_V_last+65))+1))).*Cx1_iNa_h_last;
  Cx1_iK_n_k1 = (((.1-.01*(Cx1_V_last+65))./(exp(1-.1*(Cx1_V_last+65))-1))).*(1-Cx1_iK_n_last)-((.125*exp(-(Cx1_V_last+65)/80))).*Cx1_iK_n_last;
  Cx2_V_k1 = (p.Cx2_Iapp + ((((-p.Cx2_iNa_gNa.*Cx2_iNa_m_last.^3.*Cx2_iNa_h_last.*(Cx2_V_last-p.Cx2_iNa_ENa))))+((((-p.Cx2_iK_gK.*Cx2_iK_n_last.^4.*(Cx2_V_last-p.Cx2_iK_EK))))+((((-((p.Cx2_ctx_iPoisson_g_poisson.*Cx2_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:))).*(Cx2_V_last-p.Cx2_ctx_iPoisson_E_poisson))))+((-(((p.Cx2_Cx1_iAMPActx_gAMPA.*(Cx2_Cx1_iAMPActx_s_last*p.Cx2_Cx1_iAMPActx_netcon).*(Cx2_V_last-p.Cx2_Cx1_iAMPActx_EAMPA)))))+((((-p.Cx2_Cx2_iGABActx_gGABAa.*(Cx2_Cx2_iGABActx_s_last*p.Cx2_Cx2_iGABActx_netcon).*(Cx2_V_last-p.Cx2_Cx2_iGABActx_EGABAa))))))))) + p.Cx2_noise*randn(1, p.Cx2_Npop))/p.Cx2_C;
  Cx2_iNa_m_k1 = (((2.5-.1*(Cx2_V_last+65))./(exp(2.5-.1*(Cx2_V_last+65))-1))).*(1-Cx2_iNa_m_last)-((4*exp(-(Cx2_V_last+65)/18))).*Cx2_iNa_m_last;
  Cx2_iNa_h_k1 = ((.07*exp(-(Cx2_V_last+65)/20))).*(1-Cx2_iNa_h_last)-((1./(exp(3-.1*(Cx2_V_last+65))+1))).*Cx2_iNa_h_last;
  Cx2_iK_n_k1 = (((.1-.01*(Cx2_V_last+65))./(exp(1-.1*(Cx2_V_last+65))-1))).*(1-Cx2_iK_n_last)-((.125*exp(-(Cx2_V_last+65)/80))).*Cx2_iK_n_last;
  supI_supE_iAMPActx_s_k1 = -supI_supE_iAMPActx_s_last./p.supI_supE_iAMPActx_tauAMPA + ((1-supI_supE_iAMPActx_s_last)/p.supI_supE_iAMPActx_tauAMPAr).*(1+tanh(supE_V_last/10));
  supE_supE_iAMPActx_s_k1 = -supE_supE_iAMPActx_s_last./p.supE_supE_iAMPActx_tauAMPA + ((1-supE_supE_iAMPActx_s_last)/p.supE_supE_iAMPActx_tauAMPAr).*(1+tanh(supE_V_last/10));
  supE_supI_iGABActx_s_k1 = -supE_supI_iGABActx_s_last./p.supE_supI_iGABActx_tauGABA + 1/2*(1+tanh(supI_V_last/10)).*((1-supE_supI_iGABActx_s_last)/p.supE_supI_iGABActx_tauGABAr);
  supI_supI_iGABActx_s_k1 = -supI_supI_iGABActx_s_last./p.supI_supI_iGABActx_tauGABA + 1/2*(1+tanh(supI_V_last/10)).*((1-supI_supI_iGABActx_s_last)/p.supI_supI_iGABActx_tauGABAr);
  midI_midE_iAMPActx_s_k1 = -midI_midE_iAMPActx_s_last./p.midI_midE_iAMPActx_tauAMPA + ((1-midI_midE_iAMPActx_s_last)/p.midI_midE_iAMPActx_tauAMPAr).*(1+tanh(midE_V_last/10));
  midE_midE_iAMPActx_s_k1 = -midE_midE_iAMPActx_s_last./p.midE_midE_iAMPActx_tauAMPA + ((1-midE_midE_iAMPActx_s_last)/p.midE_midE_iAMPActx_tauAMPAr).*(1+tanh(midE_V_last/10));
  midE_midI_iGABActx_s_k1 = -midE_midI_iGABActx_s_last./p.midE_midI_iGABActx_tauGABA + 1/2*(1+tanh(midI_V_last/10)).*((1-midE_midI_iGABActx_s_last)/p.midE_midI_iGABActx_tauGABAr);
  midI_midI_iGABActx_s_k1 = -midI_midI_iGABActx_s_last./p.midI_midI_iGABActx_tauGABA + 1/2*(1+tanh(midI_V_last/10)).*((1-midI_midI_iGABActx_s_last)/p.midI_midI_iGABActx_tauGABAr);
  deepI_deepE_iAMPActx_s_k1 = -deepI_deepE_iAMPActx_s_last./p.deepI_deepE_iAMPActx_tauAMPA + ((1-deepI_deepE_iAMPActx_s_last)/p.deepI_deepE_iAMPActx_tauAMPAr).*(1+tanh(deepE_V_last/10));
  deepE_deepE_iAMPActx_s_k1 = -deepE_deepE_iAMPActx_s_last./p.deepE_deepE_iAMPActx_tauAMPA + ((1-deepE_deepE_iAMPActx_s_last)/p.deepE_deepE_iAMPActx_tauAMPAr).*(1+tanh(deepE_V_last/10));
  deepE_deepI_iGABActx_s_k1 = -deepE_deepI_iGABActx_s_last./p.deepE_deepI_iGABActx_tauGABA + 1/2*(1+tanh(deepI_V_last/10)).*((1-deepE_deepI_iGABActx_s_last)/p.deepE_deepI_iGABActx_tauGABAr);
  deepI_deepI_iGABActx_s_k1 = -deepI_deepI_iGABActx_s_last./p.deepI_deepI_iGABActx_tauGABA + 1/2*(1+tanh(deepI_V_last/10)).*((1-deepI_deepI_iGABActx_s_last)/p.deepI_deepI_iGABActx_tauGABAr);
  SB1_SA1_iAMPActx_s_k1 = -SB1_SA1_iAMPActx_s_last./p.SB1_SA1_iAMPActx_tauAMPA + ((1-SB1_SA1_iAMPActx_s_last)/p.SB1_SA1_iAMPActx_tauAMPAr).*(1+tanh(SA1_V_last/10));
  SA1_SA1_iAMPActx_s_k1 = -SA1_SA1_iAMPActx_s_last./p.SA1_SA1_iAMPActx_tauAMPA + ((1-SA1_SA1_iAMPActx_s_last)/p.SA1_SA1_iAMPActx_tauAMPAr).*(1+tanh(SA1_V_last/10));
  SA1_SB1_iGABActx_s_k1 = -SA1_SB1_iGABActx_s_last./p.SA1_SB1_iGABActx_tauGABA + 1/2*(1+tanh(SB1_V_last/10)).*((1-SA1_SB1_iGABActx_s_last)/p.SA1_SB1_iGABActx_tauGABAr);
  SB1_SB1_iGABActx_s_k1 = -SB1_SB1_iGABActx_s_last./p.SB1_SB1_iGABActx_tauGABA + 1/2*(1+tanh(SB1_V_last/10)).*((1-SB1_SB1_iGABActx_s_last)/p.SB1_SB1_iGABActx_tauGABAr);
  SA2_SC1_iAMPActx_s_k1 = -SA2_SC1_iAMPActx_s_last./p.SA2_SC1_iAMPActx_tauAMPA + ((1-SA2_SC1_iAMPActx_s_last)/p.SA2_SC1_iAMPActx_tauAMPAr).*(1+tanh(SC1_V_last/10));
  SC1_SC1_iAMPActx_s_k1 = -SC1_SC1_iAMPActx_s_last./p.SC1_SC1_iAMPActx_tauAMPA + ((1-SC1_SC1_iAMPActx_s_last)/p.SC1_SC1_iAMPActx_tauAMPAr).*(1+tanh(SC1_V_last/10));
  SC1_SA2_iGABActx_s_k1 = -SC1_SA2_iGABActx_s_last./p.SC1_SA2_iGABActx_tauGABA + 1/2*(1+tanh(SA2_V_last/10)).*((1-SC1_SA2_iGABActx_s_last)/p.SC1_SA2_iGABActx_tauGABAr);
  SA2_SA2_iGABActx_s_k1 = -SA2_SA2_iGABActx_s_last./p.SA2_SA2_iGABActx_tauGABA + 1/2*(1+tanh(SA2_V_last/10)).*((1-SA2_SA2_iGABActx_s_last)/p.SA2_SA2_iGABActx_tauGABAr);
  SC2_SB2_iAMPActx_s_k1 = -SC2_SB2_iAMPActx_s_last./p.SC2_SB2_iAMPActx_tauAMPA + ((1-SC2_SB2_iAMPActx_s_last)/p.SC2_SB2_iAMPActx_tauAMPAr).*(1+tanh(SB2_V_last/10));
  SB2_SB2_iAMPActx_s_k1 = -SB2_SB2_iAMPActx_s_last./p.SB2_SB2_iAMPActx_tauAMPA + ((1-SB2_SB2_iAMPActx_s_last)/p.SB2_SB2_iAMPActx_tauAMPAr).*(1+tanh(SB2_V_last/10));
  SB2_SC2_iGABActx_s_k1 = -SB2_SC2_iGABActx_s_last./p.SB2_SC2_iGABActx_tauGABA + 1/2*(1+tanh(SC2_V_last/10)).*((1-SB2_SC2_iGABActx_s_last)/p.SB2_SC2_iGABActx_tauGABAr);
  SC2_SC2_iGABActx_s_k1 = -SC2_SC2_iGABActx_s_last./p.SC2_SC2_iGABActx_tauGABA + 1/2*(1+tanh(SC2_V_last/10)).*((1-SC2_SC2_iGABActx_s_last)/p.SC2_SC2_iGABActx_tauGABAr);
  Cx2_Cx1_iAMPActx_s_k1 = -Cx2_Cx1_iAMPActx_s_last./p.Cx2_Cx1_iAMPActx_tauAMPA + ((1-Cx2_Cx1_iAMPActx_s_last)/p.Cx2_Cx1_iAMPActx_tauAMPAr).*(1+tanh(Cx1_V_last/10));
  Cx1_Cx1_iAMPActx_s_k1 = -Cx1_Cx1_iAMPActx_s_last./p.Cx1_Cx1_iAMPActx_tauAMPA + ((1-Cx1_Cx1_iAMPActx_s_last)/p.Cx1_Cx1_iAMPActx_tauAMPAr).*(1+tanh(Cx1_V_last/10));
  Cx1_Cx2_iGABActx_s_k1 = -Cx1_Cx2_iGABActx_s_last./p.Cx1_Cx2_iGABActx_tauGABA + 1/2*(1+tanh(Cx2_V_last/10)).*((1-Cx1_Cx2_iGABActx_s_last)/p.Cx1_Cx2_iGABActx_tauGABAr);
  Cx2_Cx2_iGABActx_s_k1 = -Cx2_Cx2_iGABActx_s_last./p.Cx2_Cx2_iGABActx_tauGABA + 1/2*(1+tanh(Cx2_V_last/10)).*((1-Cx2_Cx2_iGABActx_s_last)/p.Cx2_Cx2_iGABActx_tauGABAr);
  midE_SA1_iAMPActx_s_k1 = -midE_SA1_iAMPActx_s_last./p.midE_SA1_iAMPActx_tauAMPA + ((1-midE_SA1_iAMPActx_s_last)/p.midE_SA1_iAMPActx_tauAMPAr).*(1+tanh(SA1_V_last/10));
  midE_SA2_iAMPActx_s_k1 = -midE_SA2_iAMPActx_s_last./p.midE_SA2_iAMPActx_tauAMPA + ((1-midE_SA2_iAMPActx_s_last)/p.midE_SA2_iAMPActx_tauAMPAr).*(1+tanh(SA2_V_last/10));
  midE_SB1_iAMPActx_s_k1 = -midE_SB1_iAMPActx_s_last./p.midE_SB1_iAMPActx_tauAMPA + ((1-midE_SB1_iAMPActx_s_last)/p.midE_SB1_iAMPActx_tauAMPAr).*(1+tanh(SB1_V_last/10));
  midE_SB2_iAMPActx_s_k1 = -midE_SB2_iAMPActx_s_last./p.midE_SB2_iAMPActx_tauAMPA + ((1-midE_SB2_iAMPActx_s_last)/p.midE_SB2_iAMPActx_tauAMPAr).*(1+tanh(SB2_V_last/10));
  midE_SC1_iAMPActx_s_k1 = -midE_SC1_iAMPActx_s_last./p.midE_SC1_iAMPActx_tauAMPA + ((1-midE_SC1_iAMPActx_s_last)/p.midE_SC1_iAMPActx_tauAMPAr).*(1+tanh(SC1_V_last/10));
  midE_SC2_iAMPActx_s_k1 = -midE_SC2_iAMPActx_s_last./p.midE_SC2_iAMPActx_tauAMPA + ((1-midE_SC2_iAMPActx_s_last)/p.midE_SC2_iAMPActx_tauAMPAr).*(1+tanh(SC2_V_last/10));
  midE_Cx1_iAMPActx_s_k1 = -midE_Cx1_iAMPActx_s_last./p.midE_Cx1_iAMPActx_tauAMPA + ((1-midE_Cx1_iAMPActx_s_last)/p.midE_Cx1_iAMPActx_tauAMPAr).*(1+tanh(Cx1_V_last/10));
  midE_Cx2_iAMPActx_s_k1 = -midE_Cx2_iAMPActx_s_last./p.midE_Cx2_iAMPActx_tauAMPA + ((1-midE_Cx2_iAMPActx_s_last)/p.midE_Cx2_iAMPActx_tauAMPAr).*(1+tanh(Cx2_V_last/10));
  supE_midE_iAMPActx_s_k1 = -supE_midE_iAMPActx_s_last./p.supE_midE_iAMPActx_tauAMPA + ((1-supE_midE_iAMPActx_s_last)/p.supE_midE_iAMPActx_tauAMPAr).*(1+tanh(midE_V_last/10));
  deepE_midE_iAMPActx_s_k1 = -deepE_midE_iAMPActx_s_last./p.deepE_midE_iAMPActx_tauAMPA + ((1-deepE_midE_iAMPActx_s_last)/p.deepE_midE_iAMPActx_tauAMPAr).*(1+tanh(midE_V_last/10));
  deepE_midI_iGABActx_s_k1 = -deepE_midI_iGABActx_s_last./p.deepE_midI_iGABActx_tauGABA + 1/2*(1+tanh(midI_V_last/10)).*((1-deepE_midI_iGABActx_s_last)/p.deepE_midI_iGABActx_tauGABAr);
  deepE_supE_iAMPActx_s_k1 = -deepE_supE_iAMPActx_s_last./p.deepE_supE_iAMPActx_tauAMPA + ((1-deepE_supE_iAMPActx_s_last)/p.deepE_supE_iAMPActx_tauAMPAr).*(1+tanh(supE_V_last/10));

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  supE_V_last = supE_V_last+dt*supE_V_k1;
  supE_iNa_m_last = supE_iNa_m_last+dt*supE_iNa_m_k1;
  supE_iNa_h_last = supE_iNa_h_last+dt*supE_iNa_h_k1;
  supE_iK_n_last = supE_iK_n_last+dt*supE_iK_n_k1;
  supI_V_last = supI_V_last+dt*supI_V_k1;
  supI_iNa_m_last = supI_iNa_m_last+dt*supI_iNa_m_k1;
  supI_iNa_h_last = supI_iNa_h_last+dt*supI_iNa_h_k1;
  supI_iK_n_last = supI_iK_n_last+dt*supI_iK_n_k1;
  midE_V_last = midE_V_last+dt*midE_V_k1;
  midE_iNa_m_last = midE_iNa_m_last+dt*midE_iNa_m_k1;
  midE_iNa_h_last = midE_iNa_h_last+dt*midE_iNa_h_k1;
  midE_iK_n_last = midE_iK_n_last+dt*midE_iK_n_k1;
  midI_V_last = midI_V_last+dt*midI_V_k1;
  midI_iNa_m_last = midI_iNa_m_last+dt*midI_iNa_m_k1;
  midI_iNa_h_last = midI_iNa_h_last+dt*midI_iNa_h_k1;
  midI_iK_n_last = midI_iK_n_last+dt*midI_iK_n_k1;
  deepE_V_last = deepE_V_last+dt*deepE_V_k1;
  deepE_iNa_m_last = deepE_iNa_m_last+dt*deepE_iNa_m_k1;
  deepE_iNa_h_last = deepE_iNa_h_last+dt*deepE_iNa_h_k1;
  deepE_iK_n_last = deepE_iK_n_last+dt*deepE_iK_n_k1;
  deepI_V_last = deepI_V_last+dt*deepI_V_k1;
  deepI_iNa_m_last = deepI_iNa_m_last+dt*deepI_iNa_m_k1;
  deepI_iNa_h_last = deepI_iNa_h_last+dt*deepI_iNa_h_k1;
  deepI_iK_n_last = deepI_iK_n_last+dt*deepI_iK_n_k1;
  SA1_V_last = SA1_V_last+dt*SA1_V_k1;
  SA1_iNa_m_last = SA1_iNa_m_last+dt*SA1_iNa_m_k1;
  SA1_iNa_h_last = SA1_iNa_h_last+dt*SA1_iNa_h_k1;
  SA1_iK_n_last = SA1_iK_n_last+dt*SA1_iK_n_k1;
  SB1_V_last = SB1_V_last+dt*SB1_V_k1;
  SB1_iNa_m_last = SB1_iNa_m_last+dt*SB1_iNa_m_k1;
  SB1_iNa_h_last = SB1_iNa_h_last+dt*SB1_iNa_h_k1;
  SB1_iK_n_last = SB1_iK_n_last+dt*SB1_iK_n_k1;
  SC1_V_last = SC1_V_last+dt*SC1_V_k1;
  SC1_iNa_m_last = SC1_iNa_m_last+dt*SC1_iNa_m_k1;
  SC1_iNa_h_last = SC1_iNa_h_last+dt*SC1_iNa_h_k1;
  SC1_iK_n_last = SC1_iK_n_last+dt*SC1_iK_n_k1;
  SA2_V_last = SA2_V_last+dt*SA2_V_k1;
  SA2_iNa_m_last = SA2_iNa_m_last+dt*SA2_iNa_m_k1;
  SA2_iNa_h_last = SA2_iNa_h_last+dt*SA2_iNa_h_k1;
  SA2_iK_n_last = SA2_iK_n_last+dt*SA2_iK_n_k1;
  SB2_V_last = SB2_V_last+dt*SB2_V_k1;
  SB2_iNa_m_last = SB2_iNa_m_last+dt*SB2_iNa_m_k1;
  SB2_iNa_h_last = SB2_iNa_h_last+dt*SB2_iNa_h_k1;
  SB2_iK_n_last = SB2_iK_n_last+dt*SB2_iK_n_k1;
  SC2_V_last = SC2_V_last+dt*SC2_V_k1;
  SC2_iNa_m_last = SC2_iNa_m_last+dt*SC2_iNa_m_k1;
  SC2_iNa_h_last = SC2_iNa_h_last+dt*SC2_iNa_h_k1;
  SC2_iK_n_last = SC2_iK_n_last+dt*SC2_iK_n_k1;
  Cx1_V_last = Cx1_V_last+dt*Cx1_V_k1;
  Cx1_iNa_m_last = Cx1_iNa_m_last+dt*Cx1_iNa_m_k1;
  Cx1_iNa_h_last = Cx1_iNa_h_last+dt*Cx1_iNa_h_k1;
  Cx1_iK_n_last = Cx1_iK_n_last+dt*Cx1_iK_n_k1;
  Cx2_V_last = Cx2_V_last+dt*Cx2_V_k1;
  Cx2_iNa_m_last = Cx2_iNa_m_last+dt*Cx2_iNa_m_k1;
  Cx2_iNa_h_last = Cx2_iNa_h_last+dt*Cx2_iNa_h_k1;
  Cx2_iK_n_last = Cx2_iK_n_last+dt*Cx2_iK_n_k1;
  supI_supE_iAMPActx_s_last = supI_supE_iAMPActx_s_last+dt*supI_supE_iAMPActx_s_k1;
  supE_supE_iAMPActx_s_last = supE_supE_iAMPActx_s_last+dt*supE_supE_iAMPActx_s_k1;
  supE_supI_iGABActx_s_last = supE_supI_iGABActx_s_last+dt*supE_supI_iGABActx_s_k1;
  supI_supI_iGABActx_s_last = supI_supI_iGABActx_s_last+dt*supI_supI_iGABActx_s_k1;
  midI_midE_iAMPActx_s_last = midI_midE_iAMPActx_s_last+dt*midI_midE_iAMPActx_s_k1;
  midE_midE_iAMPActx_s_last = midE_midE_iAMPActx_s_last+dt*midE_midE_iAMPActx_s_k1;
  midE_midI_iGABActx_s_last = midE_midI_iGABActx_s_last+dt*midE_midI_iGABActx_s_k1;
  midI_midI_iGABActx_s_last = midI_midI_iGABActx_s_last+dt*midI_midI_iGABActx_s_k1;
  deepI_deepE_iAMPActx_s_last = deepI_deepE_iAMPActx_s_last+dt*deepI_deepE_iAMPActx_s_k1;
  deepE_deepE_iAMPActx_s_last = deepE_deepE_iAMPActx_s_last+dt*deepE_deepE_iAMPActx_s_k1;
  deepE_deepI_iGABActx_s_last = deepE_deepI_iGABActx_s_last+dt*deepE_deepI_iGABActx_s_k1;
  deepI_deepI_iGABActx_s_last = deepI_deepI_iGABActx_s_last+dt*deepI_deepI_iGABActx_s_k1;
  SB1_SA1_iAMPActx_s_last = SB1_SA1_iAMPActx_s_last+dt*SB1_SA1_iAMPActx_s_k1;
  SA1_SA1_iAMPActx_s_last = SA1_SA1_iAMPActx_s_last+dt*SA1_SA1_iAMPActx_s_k1;
  SA1_SB1_iGABActx_s_last = SA1_SB1_iGABActx_s_last+dt*SA1_SB1_iGABActx_s_k1;
  SB1_SB1_iGABActx_s_last = SB1_SB1_iGABActx_s_last+dt*SB1_SB1_iGABActx_s_k1;
  SA2_SC1_iAMPActx_s_last = SA2_SC1_iAMPActx_s_last+dt*SA2_SC1_iAMPActx_s_k1;
  SC1_SC1_iAMPActx_s_last = SC1_SC1_iAMPActx_s_last+dt*SC1_SC1_iAMPActx_s_k1;
  SC1_SA2_iGABActx_s_last = SC1_SA2_iGABActx_s_last+dt*SC1_SA2_iGABActx_s_k1;
  SA2_SA2_iGABActx_s_last = SA2_SA2_iGABActx_s_last+dt*SA2_SA2_iGABActx_s_k1;
  SC2_SB2_iAMPActx_s_last = SC2_SB2_iAMPActx_s_last+dt*SC2_SB2_iAMPActx_s_k1;
  SB2_SB2_iAMPActx_s_last = SB2_SB2_iAMPActx_s_last+dt*SB2_SB2_iAMPActx_s_k1;
  SB2_SC2_iGABActx_s_last = SB2_SC2_iGABActx_s_last+dt*SB2_SC2_iGABActx_s_k1;
  SC2_SC2_iGABActx_s_last = SC2_SC2_iGABActx_s_last+dt*SC2_SC2_iGABActx_s_k1;
  Cx2_Cx1_iAMPActx_s_last = Cx2_Cx1_iAMPActx_s_last+dt*Cx2_Cx1_iAMPActx_s_k1;
  Cx1_Cx1_iAMPActx_s_last = Cx1_Cx1_iAMPActx_s_last+dt*Cx1_Cx1_iAMPActx_s_k1;
  Cx1_Cx2_iGABActx_s_last = Cx1_Cx2_iGABActx_s_last+dt*Cx1_Cx2_iGABActx_s_k1;
  Cx2_Cx2_iGABActx_s_last = Cx2_Cx2_iGABActx_s_last+dt*Cx2_Cx2_iGABActx_s_k1;
  midE_SA1_iAMPActx_s_last = midE_SA1_iAMPActx_s_last+dt*midE_SA1_iAMPActx_s_k1;
  midE_SA2_iAMPActx_s_last = midE_SA2_iAMPActx_s_last+dt*midE_SA2_iAMPActx_s_k1;
  midE_SB1_iAMPActx_s_last = midE_SB1_iAMPActx_s_last+dt*midE_SB1_iAMPActx_s_k1;
  midE_SB2_iAMPActx_s_last = midE_SB2_iAMPActx_s_last+dt*midE_SB2_iAMPActx_s_k1;
  midE_SC1_iAMPActx_s_last = midE_SC1_iAMPActx_s_last+dt*midE_SC1_iAMPActx_s_k1;
  midE_SC2_iAMPActx_s_last = midE_SC2_iAMPActx_s_last+dt*midE_SC2_iAMPActx_s_k1;
  midE_Cx1_iAMPActx_s_last = midE_Cx1_iAMPActx_s_last+dt*midE_Cx1_iAMPActx_s_k1;
  midE_Cx2_iAMPActx_s_last = midE_Cx2_iAMPActx_s_last+dt*midE_Cx2_iAMPActx_s_k1;
  supE_midE_iAMPActx_s_last = supE_midE_iAMPActx_s_last+dt*supE_midE_iAMPActx_s_k1;
  deepE_midE_iAMPActx_s_last = deepE_midE_iAMPActx_s_last+dt*deepE_midE_iAMPActx_s_k1;
  deepE_midI_iGABActx_s_last = deepE_midI_iGABActx_s_last+dt*deepE_midI_iGABActx_s_k1;
  deepE_supE_iAMPActx_s_last = deepE_supE_iAMPActx_s_last+dt*deepE_supE_iAMPActx_s_k1;

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    supE_V(n,:) = supE_V_last;
    supE_iNa_m(n,:) = supE_iNa_m_last;
    supE_iNa_h(n,:) = supE_iNa_h_last;
    supE_iK_n(n,:) = supE_iK_n_last;
    supI_V(n,:) = supI_V_last;
    supI_iNa_m(n,:) = supI_iNa_m_last;
    supI_iNa_h(n,:) = supI_iNa_h_last;
    supI_iK_n(n,:) = supI_iK_n_last;
    midE_V(n,:) = midE_V_last;
    midE_iNa_m(n,:) = midE_iNa_m_last;
    midE_iNa_h(n,:) = midE_iNa_h_last;
    midE_iK_n(n,:) = midE_iK_n_last;
    midI_V(n,:) = midI_V_last;
    midI_iNa_m(n,:) = midI_iNa_m_last;
    midI_iNa_h(n,:) = midI_iNa_h_last;
    midI_iK_n(n,:) = midI_iK_n_last;
    deepE_V(n,:) = deepE_V_last;
    deepE_iNa_m(n,:) = deepE_iNa_m_last;
    deepE_iNa_h(n,:) = deepE_iNa_h_last;
    deepE_iK_n(n,:) = deepE_iK_n_last;
    deepI_V(n,:) = deepI_V_last;
    deepI_iNa_m(n,:) = deepI_iNa_m_last;
    deepI_iNa_h(n,:) = deepI_iNa_h_last;
    deepI_iK_n(n,:) = deepI_iK_n_last;
    SA1_V(n,:) = SA1_V_last;
    SA1_iNa_m(n,:) = SA1_iNa_m_last;
    SA1_iNa_h(n,:) = SA1_iNa_h_last;
    SA1_iK_n(n,:) = SA1_iK_n_last;
    SB1_V(n,:) = SB1_V_last;
    SB1_iNa_m(n,:) = SB1_iNa_m_last;
    SB1_iNa_h(n,:) = SB1_iNa_h_last;
    SB1_iK_n(n,:) = SB1_iK_n_last;
    SC1_V(n,:) = SC1_V_last;
    SC1_iNa_m(n,:) = SC1_iNa_m_last;
    SC1_iNa_h(n,:) = SC1_iNa_h_last;
    SC1_iK_n(n,:) = SC1_iK_n_last;
    SA2_V(n,:) = SA2_V_last;
    SA2_iNa_m(n,:) = SA2_iNa_m_last;
    SA2_iNa_h(n,:) = SA2_iNa_h_last;
    SA2_iK_n(n,:) = SA2_iK_n_last;
    SB2_V(n,:) = SB2_V_last;
    SB2_iNa_m(n,:) = SB2_iNa_m_last;
    SB2_iNa_h(n,:) = SB2_iNa_h_last;
    SB2_iK_n(n,:) = SB2_iK_n_last;
    SC2_V(n,:) = SC2_V_last;
    SC2_iNa_m(n,:) = SC2_iNa_m_last;
    SC2_iNa_h(n,:) = SC2_iNa_h_last;
    SC2_iK_n(n,:) = SC2_iK_n_last;
    Cx1_V(n,:) = Cx1_V_last;
    Cx1_iNa_m(n,:) = Cx1_iNa_m_last;
    Cx1_iNa_h(n,:) = Cx1_iNa_h_last;
    Cx1_iK_n(n,:) = Cx1_iK_n_last;
    Cx2_V(n,:) = Cx2_V_last;
    Cx2_iNa_m(n,:) = Cx2_iNa_m_last;
    Cx2_iNa_h(n,:) = Cx2_iNa_h_last;
    Cx2_iK_n(n,:) = Cx2_iK_n_last;
    supI_supE_iAMPActx_s(n,:) = supI_supE_iAMPActx_s_last;
    supE_supE_iAMPActx_s(n,:) = supE_supE_iAMPActx_s_last;
    supE_supI_iGABActx_s(n,:) = supE_supI_iGABActx_s_last;
    supI_supI_iGABActx_s(n,:) = supI_supI_iGABActx_s_last;
    midI_midE_iAMPActx_s(n,:) = midI_midE_iAMPActx_s_last;
    midE_midE_iAMPActx_s(n,:) = midE_midE_iAMPActx_s_last;
    midE_midI_iGABActx_s(n,:) = midE_midI_iGABActx_s_last;
    midI_midI_iGABActx_s(n,:) = midI_midI_iGABActx_s_last;
    deepI_deepE_iAMPActx_s(n,:) = deepI_deepE_iAMPActx_s_last;
    deepE_deepE_iAMPActx_s(n,:) = deepE_deepE_iAMPActx_s_last;
    deepE_deepI_iGABActx_s(n,:) = deepE_deepI_iGABActx_s_last;
    deepI_deepI_iGABActx_s(n,:) = deepI_deepI_iGABActx_s_last;
    SB1_SA1_iAMPActx_s(n,:) = SB1_SA1_iAMPActx_s_last;
    SA1_SA1_iAMPActx_s(n,:) = SA1_SA1_iAMPActx_s_last;
    SA1_SB1_iGABActx_s(n,:) = SA1_SB1_iGABActx_s_last;
    SB1_SB1_iGABActx_s(n,:) = SB1_SB1_iGABActx_s_last;
    SA2_SC1_iAMPActx_s(n,:) = SA2_SC1_iAMPActx_s_last;
    SC1_SC1_iAMPActx_s(n,:) = SC1_SC1_iAMPActx_s_last;
    SC1_SA2_iGABActx_s(n,:) = SC1_SA2_iGABActx_s_last;
    SA2_SA2_iGABActx_s(n,:) = SA2_SA2_iGABActx_s_last;
    SC2_SB2_iAMPActx_s(n,:) = SC2_SB2_iAMPActx_s_last;
    SB2_SB2_iAMPActx_s(n,:) = SB2_SB2_iAMPActx_s_last;
    SB2_SC2_iGABActx_s(n,:) = SB2_SC2_iGABActx_s_last;
    SC2_SC2_iGABActx_s(n,:) = SC2_SC2_iGABActx_s_last;
    Cx2_Cx1_iAMPActx_s(n,:) = Cx2_Cx1_iAMPActx_s_last;
    Cx1_Cx1_iAMPActx_s(n,:) = Cx1_Cx1_iAMPActx_s_last;
    Cx1_Cx2_iGABActx_s(n,:) = Cx1_Cx2_iGABActx_s_last;
    Cx2_Cx2_iGABActx_s(n,:) = Cx2_Cx2_iGABActx_s_last;
    midE_SA1_iAMPActx_s(n,:) = midE_SA1_iAMPActx_s_last;
    midE_SA2_iAMPActx_s(n,:) = midE_SA2_iAMPActx_s_last;
    midE_SB1_iAMPActx_s(n,:) = midE_SB1_iAMPActx_s_last;
    midE_SB2_iAMPActx_s(n,:) = midE_SB2_iAMPActx_s_last;
    midE_SC1_iAMPActx_s(n,:) = midE_SC1_iAMPActx_s_last;
    midE_SC2_iAMPActx_s(n,:) = midE_SC2_iAMPActx_s_last;
    midE_Cx1_iAMPActx_s(n,:) = midE_Cx1_iAMPActx_s_last;
    midE_Cx2_iAMPActx_s(n,:) = midE_Cx2_iAMPActx_s_last;
    supE_midE_iAMPActx_s(n,:) = supE_midE_iAMPActx_s_last;
    deepE_midE_iAMPActx_s(n,:) = deepE_midE_iAMPActx_s_last;
    deepE_midI_iGABActx_s(n,:) = deepE_midI_iGABActx_s_last;
    deepE_supE_iAMPActx_s(n,:) = deepE_supE_iAMPActx_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  supE_ctx_iPoisson_g_poisson(n,:)=p.supE_ctx_iPoisson_g_poisson.*supE_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:);
  supE_ctx_iPoisson_I_poisson(n,:)=-((p.supE_ctx_iPoisson_g_poisson.*supE_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:))).*(supE_V(n,:)-p.supE_ctx_iPoisson_E_poisson);
  supI_ctx_iPoisson_g_poisson(n,:)=p.supI_ctx_iPoisson_g_poisson.*supI_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:);
  supI_ctx_iPoisson_I_poisson(n,:)=-((p.supI_ctx_iPoisson_g_poisson.*supI_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:))).*(supI_V(n,:)-p.supI_ctx_iPoisson_E_poisson);
  midE_ctx_iPoisson_g_poisson(n,:)=p.midE_ctx_iPoisson_g_poisson.*midE_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:);
  midE_ctx_iPoisson_I_poisson(n,:)=-((p.midE_ctx_iPoisson_g_poisson.*midE_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:))).*(midE_V(n,:)-p.midE_ctx_iPoisson_E_poisson);
  midI_ctx_iPoisson_g_poisson(n,:)=p.midI_ctx_iPoisson_g_poisson.*midI_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:);
  midI_ctx_iPoisson_I_poisson(n,:)=-((p.midI_ctx_iPoisson_g_poisson.*midI_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:))).*(midI_V(n,:)-p.midI_ctx_iPoisson_E_poisson);
  deepE_ctx_iPoisson_g_poisson(n,:)=p.deepE_ctx_iPoisson_g_poisson.*deepE_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:);
  deepE_ctx_iPoisson_I_poisson(n,:)=-((p.deepE_ctx_iPoisson_g_poisson.*deepE_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:))).*(deepE_V(n,:)-p.deepE_ctx_iPoisson_E_poisson);
  deepI_ctx_iPoisson_g_poisson(n,:)=p.deepI_ctx_iPoisson_g_poisson.*deepI_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:);
  deepI_ctx_iPoisson_I_poisson(n,:)=-((p.deepI_ctx_iPoisson_g_poisson.*deepI_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:))).*(deepI_V(n,:)-p.deepI_ctx_iPoisson_E_poisson);
  SA1_ctx_iPoisson_g_poisson(n,:)=p.SA1_ctx_iPoisson_g_poisson.*SA1_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:);
  SA1_ctx_iPoisson_I_poisson(n,:)=-((p.SA1_ctx_iPoisson_g_poisson.*SA1_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:))).*(SA1_V(n,:)-p.SA1_ctx_iPoisson_E_poisson);
  SB1_ctx_iPoisson_g_poisson(n,:)=p.SB1_ctx_iPoisson_g_poisson.*SB1_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:);
  SB1_ctx_iPoisson_I_poisson(n,:)=-((p.SB1_ctx_iPoisson_g_poisson.*SB1_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:))).*(SB1_V(n,:)-p.SB1_ctx_iPoisson_E_poisson);
  SC1_ctx_iPoisson_g_poisson(n,:)=p.SC1_ctx_iPoisson_g_poisson.*SC1_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:);
  SC1_ctx_iPoisson_I_poisson(n,:)=-((p.SC1_ctx_iPoisson_g_poisson.*SC1_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:))).*(SC1_V(n,:)-p.SC1_ctx_iPoisson_E_poisson);
  SA2_ctx_iPoisson_g_poisson(n,:)=p.SA2_ctx_iPoisson_g_poisson.*SA2_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:);
  SA2_ctx_iPoisson_I_poisson(n,:)=-((p.SA2_ctx_iPoisson_g_poisson.*SA2_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:))).*(SA2_V(n,:)-p.SA2_ctx_iPoisson_E_poisson);
  SB2_ctx_iPoisson_g_poisson(n,:)=p.SB2_ctx_iPoisson_g_poisson.*SB2_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:);
  SB2_ctx_iPoisson_I_poisson(n,:)=-((p.SB2_ctx_iPoisson_g_poisson.*SB2_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:))).*(SB2_V(n,:)-p.SB2_ctx_iPoisson_E_poisson);
  SC2_ctx_iPoisson_g_poisson(n,:)=p.SC2_ctx_iPoisson_g_poisson.*SC2_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:);
  SC2_ctx_iPoisson_I_poisson(n,:)=-((p.SC2_ctx_iPoisson_g_poisson.*SC2_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:))).*(SC2_V(n,:)-p.SC2_ctx_iPoisson_E_poisson);
  Cx1_ctx_iPoisson_g_poisson(n,:)=p.Cx1_ctx_iPoisson_g_poisson.*Cx1_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:);
  Cx1_ctx_iPoisson_I_poisson(n,:)=-((p.Cx1_ctx_iPoisson_g_poisson.*Cx1_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:))).*(Cx1_V(n,:)-p.Cx1_ctx_iPoisson_E_poisson);
  Cx2_ctx_iPoisson_g_poisson(n,:)=p.Cx2_ctx_iPoisson_g_poisson.*Cx2_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:);
  Cx2_ctx_iPoisson_I_poisson(n,:)=-((p.Cx2_ctx_iPoisson_g_poisson.*Cx2_ctx_iPoisson_s_poisson(1+floor(t/(0.5*dt)),:))).*(Cx2_V(n,:)-p.Cx2_ctx_iPoisson_E_poisson);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
