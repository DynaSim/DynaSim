function [T,supExBASE_V,supExBASE_iNa_m,supExBASE_iNa_h,supExBASE_iK_n,supIxBASE_V,supIxBASE_iNa_m,supIxBASE_iNa_h,supIxBASE_iK_n,midExBASE_V,midExBASE_iNa_m,midExBASE_iNa_h,midExBASE_iK_n,midIxBASE_V,midIxBASE_iNa_m,midIxBASE_iNa_h,midIxBASE_iK_n,deepExBASE_V,deepExBASE_iNa_m,deepExBASE_iNa_h,deepExBASE_iK_n,deepIxBASE_V,deepIxBASE_iNa_m,deepIxBASE_iNa_h,deepIxBASE_iK_n,EAxBASE_V,EAxBASE_iNa_m,EAxBASE_iNa_h,EAxBASE_iK_n,IAxBASE_V,IAxBASE_iNa_m,IAxBASE_iNa_h,IAxBASE_iK_n,EBxBASE_V,EBxBASE_iNa_m,EBxBASE_iNa_h,EBxBASE_iK_n,IBxBASE_V,IBxBASE_iNa_m,IBxBASE_iNa_h,IBxBASE_iK_n,ECxBASE_V,ECxBASE_iNa_m,ECxBASE_iNa_h,ECxBASE_iK_n,ICxBASE_V,ICxBASE_iNa_m,ICxBASE_iNa_h,ICxBASE_iK_n,supIxBASE_supExBASE_iAMPActx_s,supExBASE_supExBASE_iAMPActx_s,supExBASE_supIxBASE_iGABActx_s,supIxBASE_supIxBASE_iGABActx_s,midIxBASE_midExBASE_iAMPActx_s,midExBASE_midExBASE_iAMPActx_s,midExBASE_midIxBASE_iGABActx_s,midIxBASE_midIxBASE_iGABActx_s,deepIxBASE_deepExBASE_iAMPActx_s,deepExBASE_deepExBASE_iAMPActx_s,deepExBASE_deepIxBASE_iGABActx_s,deepIxBASE_deepIxBASE_iGABActx_s,IAxBASE_EAxBASE_iAMPActx_s,EAxBASE_EAxBASE_iAMPActx_s,EAxBASE_IAxBASE_iAMPActx_s,IAxBASE_IAxBASE_iAMPActx_s,IBxBASE_EBxBASE_iAMPActx_s,EBxBASE_EBxBASE_iAMPActx_s,EBxBASE_IBxBASE_iAMPActx_s,IBxBASE_IBxBASE_iAMPActx_s,ICxBASE_ECxBASE_iAMPActx_s,ECxBASE_ECxBASE_iAMPActx_s,ECxBASE_ICxBASE_iAMPActx_s,ICxBASE_ICxBASE_iAMPActx_s,midExBASE_EAxBASE_iAMPActx_s,midExBASE_IAxBASE_iAMPActx_s,midExBASE_EBxBASE_iAMPActx_s,midExBASE_IBxBASE_iAMPActx_s,midExBASE_ECxBASE_iAMPActx_s,midExBASE_ICxBASE_iAMPActx_s,supExBASE_midExBASE_iAMPActx_s,deepExBASE_midExBASE_iAMPActx_s,deepExBASE_midIxBASE_iGABActx_s,deepExBASE_supExBASE_iAMPActx_s]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% seed the random number generator
rng(p.random_seed);

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
supExBASE_V_last =  -rand(1, p.supExBASE_Npop)*74;
supExBASE_V = zeros(nsamp,p.supExBASE_Npop);
supExBASE_V(1,:) = supExBASE_V_last;
supExBASE_iNa_m_last = p.supExBASE_iNa_m_IC+p.supExBASE_iNa_IC_noise*rand(1,p.supExBASE_Npop);
supExBASE_iNa_m = zeros(nsamp,p.supExBASE_Npop);
supExBASE_iNa_m(1,:) = supExBASE_iNa_m_last;
supExBASE_iNa_h_last = p.supExBASE_iNa_h_IC+p.supExBASE_iNa_IC_noise*rand(1,p.supExBASE_Npop);
supExBASE_iNa_h = zeros(nsamp,p.supExBASE_Npop);
supExBASE_iNa_h(1,:) = supExBASE_iNa_h_last;
supExBASE_iK_n_last = p.supExBASE_iK_n_IC+p.supExBASE_iK_IC_noise*rand(1,p.supExBASE_Npop);
supExBASE_iK_n = zeros(nsamp,p.supExBASE_Npop);
supExBASE_iK_n(1,:) = supExBASE_iK_n_last;
supIxBASE_V_last =  -rand(1, p.supIxBASE_Npop)*74;
supIxBASE_V = zeros(nsamp,p.supIxBASE_Npop);
supIxBASE_V(1,:) = supIxBASE_V_last;
supIxBASE_iNa_m_last = p.supIxBASE_iNa_m_IC+p.supIxBASE_iNa_IC_noise*rand(1,p.supIxBASE_Npop);
supIxBASE_iNa_m = zeros(nsamp,p.supIxBASE_Npop);
supIxBASE_iNa_m(1,:) = supIxBASE_iNa_m_last;
supIxBASE_iNa_h_last = p.supIxBASE_iNa_h_IC+p.supIxBASE_iNa_IC_noise*rand(1,p.supIxBASE_Npop);
supIxBASE_iNa_h = zeros(nsamp,p.supIxBASE_Npop);
supIxBASE_iNa_h(1,:) = supIxBASE_iNa_h_last;
supIxBASE_iK_n_last = p.supIxBASE_iK_n_IC+p.supIxBASE_iK_IC_noise*rand(1,p.supIxBASE_Npop);
supIxBASE_iK_n = zeros(nsamp,p.supIxBASE_Npop);
supIxBASE_iK_n(1,:) = supIxBASE_iK_n_last;
midExBASE_V_last =  -rand(1, p.midExBASE_Npop)*74;
midExBASE_V = zeros(nsamp,p.midExBASE_Npop);
midExBASE_V(1,:) = midExBASE_V_last;
midExBASE_iNa_m_last = p.midExBASE_iNa_m_IC+p.midExBASE_iNa_IC_noise*rand(1,p.midExBASE_Npop);
midExBASE_iNa_m = zeros(nsamp,p.midExBASE_Npop);
midExBASE_iNa_m(1,:) = midExBASE_iNa_m_last;
midExBASE_iNa_h_last = p.midExBASE_iNa_h_IC+p.midExBASE_iNa_IC_noise*rand(1,p.midExBASE_Npop);
midExBASE_iNa_h = zeros(nsamp,p.midExBASE_Npop);
midExBASE_iNa_h(1,:) = midExBASE_iNa_h_last;
midExBASE_iK_n_last = p.midExBASE_iK_n_IC+p.midExBASE_iK_IC_noise*rand(1,p.midExBASE_Npop);
midExBASE_iK_n = zeros(nsamp,p.midExBASE_Npop);
midExBASE_iK_n(1,:) = midExBASE_iK_n_last;
midIxBASE_V_last =  -rand(1, p.midIxBASE_Npop)*74;
midIxBASE_V = zeros(nsamp,p.midIxBASE_Npop);
midIxBASE_V(1,:) = midIxBASE_V_last;
midIxBASE_iNa_m_last = p.midIxBASE_iNa_m_IC+p.midIxBASE_iNa_IC_noise*rand(1,p.midIxBASE_Npop);
midIxBASE_iNa_m = zeros(nsamp,p.midIxBASE_Npop);
midIxBASE_iNa_m(1,:) = midIxBASE_iNa_m_last;
midIxBASE_iNa_h_last = p.midIxBASE_iNa_h_IC+p.midIxBASE_iNa_IC_noise*rand(1,p.midIxBASE_Npop);
midIxBASE_iNa_h = zeros(nsamp,p.midIxBASE_Npop);
midIxBASE_iNa_h(1,:) = midIxBASE_iNa_h_last;
midIxBASE_iK_n_last = p.midIxBASE_iK_n_IC+p.midIxBASE_iK_IC_noise*rand(1,p.midIxBASE_Npop);
midIxBASE_iK_n = zeros(nsamp,p.midIxBASE_Npop);
midIxBASE_iK_n(1,:) = midIxBASE_iK_n_last;
deepExBASE_V_last =  -rand(1, p.deepExBASE_Npop)*74;
deepExBASE_V = zeros(nsamp,p.deepExBASE_Npop);
deepExBASE_V(1,:) = deepExBASE_V_last;
deepExBASE_iNa_m_last = p.deepExBASE_iNa_m_IC+p.deepExBASE_iNa_IC_noise*rand(1,p.deepExBASE_Npop);
deepExBASE_iNa_m = zeros(nsamp,p.deepExBASE_Npop);
deepExBASE_iNa_m(1,:) = deepExBASE_iNa_m_last;
deepExBASE_iNa_h_last = p.deepExBASE_iNa_h_IC+p.deepExBASE_iNa_IC_noise*rand(1,p.deepExBASE_Npop);
deepExBASE_iNa_h = zeros(nsamp,p.deepExBASE_Npop);
deepExBASE_iNa_h(1,:) = deepExBASE_iNa_h_last;
deepExBASE_iK_n_last = p.deepExBASE_iK_n_IC+p.deepExBASE_iK_IC_noise*rand(1,p.deepExBASE_Npop);
deepExBASE_iK_n = zeros(nsamp,p.deepExBASE_Npop);
deepExBASE_iK_n(1,:) = deepExBASE_iK_n_last;
deepIxBASE_V_last =  -rand(1, p.deepIxBASE_Npop)*74;
deepIxBASE_V = zeros(nsamp,p.deepIxBASE_Npop);
deepIxBASE_V(1,:) = deepIxBASE_V_last;
deepIxBASE_iNa_m_last = p.deepIxBASE_iNa_m_IC+p.deepIxBASE_iNa_IC_noise*rand(1,p.deepIxBASE_Npop);
deepIxBASE_iNa_m = zeros(nsamp,p.deepIxBASE_Npop);
deepIxBASE_iNa_m(1,:) = deepIxBASE_iNa_m_last;
deepIxBASE_iNa_h_last = p.deepIxBASE_iNa_h_IC+p.deepIxBASE_iNa_IC_noise*rand(1,p.deepIxBASE_Npop);
deepIxBASE_iNa_h = zeros(nsamp,p.deepIxBASE_Npop);
deepIxBASE_iNa_h(1,:) = deepIxBASE_iNa_h_last;
deepIxBASE_iK_n_last = p.deepIxBASE_iK_n_IC+p.deepIxBASE_iK_IC_noise*rand(1,p.deepIxBASE_Npop);
deepIxBASE_iK_n = zeros(nsamp,p.deepIxBASE_Npop);
deepIxBASE_iK_n(1,:) = deepIxBASE_iK_n_last;
EAxBASE_V_last =  -60 - rand(1, p.EAxBASE_Npop)*17;
EAxBASE_V = zeros(nsamp,p.EAxBASE_Npop);
EAxBASE_V(1,:) = EAxBASE_V_last;
EAxBASE_iNa_m_last = p.EAxBASE_iNa_m_IC+p.EAxBASE_iNa_IC_noise*rand(1,p.EAxBASE_Npop);
EAxBASE_iNa_m = zeros(nsamp,p.EAxBASE_Npop);
EAxBASE_iNa_m(1,:) = EAxBASE_iNa_m_last;
EAxBASE_iNa_h_last = p.EAxBASE_iNa_h_IC+p.EAxBASE_iNa_IC_noise*rand(1,p.EAxBASE_Npop);
EAxBASE_iNa_h = zeros(nsamp,p.EAxBASE_Npop);
EAxBASE_iNa_h(1,:) = EAxBASE_iNa_h_last;
EAxBASE_iK_n_last = p.EAxBASE_iK_n_IC+p.EAxBASE_iK_IC_noise*rand(1,p.EAxBASE_Npop);
EAxBASE_iK_n = zeros(nsamp,p.EAxBASE_Npop);
EAxBASE_iK_n(1,:) = EAxBASE_iK_n_last;
IAxBASE_V_last =  -60 - rand(1, p.IAxBASE_Npop)*17;
IAxBASE_V = zeros(nsamp,p.IAxBASE_Npop);
IAxBASE_V(1,:) = IAxBASE_V_last;
IAxBASE_iNa_m_last = p.IAxBASE_iNa_m_IC+p.IAxBASE_iNa_IC_noise*rand(1,p.IAxBASE_Npop);
IAxBASE_iNa_m = zeros(nsamp,p.IAxBASE_Npop);
IAxBASE_iNa_m(1,:) = IAxBASE_iNa_m_last;
IAxBASE_iNa_h_last = p.IAxBASE_iNa_h_IC+p.IAxBASE_iNa_IC_noise*rand(1,p.IAxBASE_Npop);
IAxBASE_iNa_h = zeros(nsamp,p.IAxBASE_Npop);
IAxBASE_iNa_h(1,:) = IAxBASE_iNa_h_last;
IAxBASE_iK_n_last = p.IAxBASE_iK_n_IC+p.IAxBASE_iK_IC_noise*rand(1,p.IAxBASE_Npop);
IAxBASE_iK_n = zeros(nsamp,p.IAxBASE_Npop);
IAxBASE_iK_n(1,:) = IAxBASE_iK_n_last;
EBxBASE_V_last =  -60 - rand(1, p.EBxBASE_Npop)*17;
EBxBASE_V = zeros(nsamp,p.EBxBASE_Npop);
EBxBASE_V(1,:) = EBxBASE_V_last;
EBxBASE_iNa_m_last = p.EBxBASE_iNa_m_IC+p.EBxBASE_iNa_IC_noise*rand(1,p.EBxBASE_Npop);
EBxBASE_iNa_m = zeros(nsamp,p.EBxBASE_Npop);
EBxBASE_iNa_m(1,:) = EBxBASE_iNa_m_last;
EBxBASE_iNa_h_last = p.EBxBASE_iNa_h_IC+p.EBxBASE_iNa_IC_noise*rand(1,p.EBxBASE_Npop);
EBxBASE_iNa_h = zeros(nsamp,p.EBxBASE_Npop);
EBxBASE_iNa_h(1,:) = EBxBASE_iNa_h_last;
EBxBASE_iK_n_last = p.EBxBASE_iK_n_IC+p.EBxBASE_iK_IC_noise*rand(1,p.EBxBASE_Npop);
EBxBASE_iK_n = zeros(nsamp,p.EBxBASE_Npop);
EBxBASE_iK_n(1,:) = EBxBASE_iK_n_last;
IBxBASE_V_last =  -60 - rand(1, p.IBxBASE_Npop)*17;
IBxBASE_V = zeros(nsamp,p.IBxBASE_Npop);
IBxBASE_V(1,:) = IBxBASE_V_last;
IBxBASE_iNa_m_last = p.IBxBASE_iNa_m_IC+p.IBxBASE_iNa_IC_noise*rand(1,p.IBxBASE_Npop);
IBxBASE_iNa_m = zeros(nsamp,p.IBxBASE_Npop);
IBxBASE_iNa_m(1,:) = IBxBASE_iNa_m_last;
IBxBASE_iNa_h_last = p.IBxBASE_iNa_h_IC+p.IBxBASE_iNa_IC_noise*rand(1,p.IBxBASE_Npop);
IBxBASE_iNa_h = zeros(nsamp,p.IBxBASE_Npop);
IBxBASE_iNa_h(1,:) = IBxBASE_iNa_h_last;
IBxBASE_iK_n_last = p.IBxBASE_iK_n_IC+p.IBxBASE_iK_IC_noise*rand(1,p.IBxBASE_Npop);
IBxBASE_iK_n = zeros(nsamp,p.IBxBASE_Npop);
IBxBASE_iK_n(1,:) = IBxBASE_iK_n_last;
ECxBASE_V_last =  -60 - rand(1, p.ECxBASE_Npop)*17;
ECxBASE_V = zeros(nsamp,p.ECxBASE_Npop);
ECxBASE_V(1,:) = ECxBASE_V_last;
ECxBASE_iNa_m_last = p.ECxBASE_iNa_m_IC+p.ECxBASE_iNa_IC_noise*rand(1,p.ECxBASE_Npop);
ECxBASE_iNa_m = zeros(nsamp,p.ECxBASE_Npop);
ECxBASE_iNa_m(1,:) = ECxBASE_iNa_m_last;
ECxBASE_iNa_h_last = p.ECxBASE_iNa_h_IC+p.ECxBASE_iNa_IC_noise*rand(1,p.ECxBASE_Npop);
ECxBASE_iNa_h = zeros(nsamp,p.ECxBASE_Npop);
ECxBASE_iNa_h(1,:) = ECxBASE_iNa_h_last;
ECxBASE_iK_n_last = p.ECxBASE_iK_n_IC+p.ECxBASE_iK_IC_noise*rand(1,p.ECxBASE_Npop);
ECxBASE_iK_n = zeros(nsamp,p.ECxBASE_Npop);
ECxBASE_iK_n(1,:) = ECxBASE_iK_n_last;
ICxBASE_V_last =  -60 - rand(1, p.ICxBASE_Npop)*17;
ICxBASE_V = zeros(nsamp,p.ICxBASE_Npop);
ICxBASE_V(1,:) = ICxBASE_V_last;
ICxBASE_iNa_m_last = p.ICxBASE_iNa_m_IC+p.ICxBASE_iNa_IC_noise*rand(1,p.ICxBASE_Npop);
ICxBASE_iNa_m = zeros(nsamp,p.ICxBASE_Npop);
ICxBASE_iNa_m(1,:) = ICxBASE_iNa_m_last;
ICxBASE_iNa_h_last = p.ICxBASE_iNa_h_IC+p.ICxBASE_iNa_IC_noise*rand(1,p.ICxBASE_Npop);
ICxBASE_iNa_h = zeros(nsamp,p.ICxBASE_Npop);
ICxBASE_iNa_h(1,:) = ICxBASE_iNa_h_last;
ICxBASE_iK_n_last = p.ICxBASE_iK_n_IC+p.ICxBASE_iK_IC_noise*rand(1,p.ICxBASE_Npop);
ICxBASE_iK_n = zeros(nsamp,p.ICxBASE_Npop);
ICxBASE_iK_n(1,:) = ICxBASE_iK_n_last;
supIxBASE_supExBASE_iAMPActx_s_last =  p.supIxBASE_supExBASE_iAMPActx_IC+p.supIxBASE_supExBASE_iAMPActx_IC_noise.*rand(1,p.supExBASE_Npop);
supIxBASE_supExBASE_iAMPActx_s = zeros(nsamp,p.supExBASE_Npop);
supIxBASE_supExBASE_iAMPActx_s(1,:) = supIxBASE_supExBASE_iAMPActx_s_last;
supExBASE_supExBASE_iAMPActx_s_last =  p.supExBASE_supExBASE_iAMPActx_IC+p.supExBASE_supExBASE_iAMPActx_IC_noise.*rand(1,p.supExBASE_Npop);
supExBASE_supExBASE_iAMPActx_s = zeros(nsamp,p.supExBASE_Npop);
supExBASE_supExBASE_iAMPActx_s(1,:) = supExBASE_supExBASE_iAMPActx_s_last;
supExBASE_supIxBASE_iGABActx_s_last =  p.supExBASE_supIxBASE_iGABActx_IC+p.supExBASE_supIxBASE_iGABActx_IC_noise.*rand(1,p.supIxBASE_Npop);
supExBASE_supIxBASE_iGABActx_s = zeros(nsamp,p.supIxBASE_Npop);
supExBASE_supIxBASE_iGABActx_s(1,:) = supExBASE_supIxBASE_iGABActx_s_last;
supIxBASE_supIxBASE_iGABActx_s_last =  p.supIxBASE_supIxBASE_iGABActx_IC+p.supIxBASE_supIxBASE_iGABActx_IC_noise.*rand(1,p.supIxBASE_Npop);
supIxBASE_supIxBASE_iGABActx_s = zeros(nsamp,p.supIxBASE_Npop);
supIxBASE_supIxBASE_iGABActx_s(1,:) = supIxBASE_supIxBASE_iGABActx_s_last;
midIxBASE_midExBASE_iAMPActx_s_last =  p.midIxBASE_midExBASE_iAMPActx_IC+p.midIxBASE_midExBASE_iAMPActx_IC_noise.*rand(1,p.midExBASE_Npop);
midIxBASE_midExBASE_iAMPActx_s = zeros(nsamp,p.midExBASE_Npop);
midIxBASE_midExBASE_iAMPActx_s(1,:) = midIxBASE_midExBASE_iAMPActx_s_last;
midExBASE_midExBASE_iAMPActx_s_last =  p.midExBASE_midExBASE_iAMPActx_IC+p.midExBASE_midExBASE_iAMPActx_IC_noise.*rand(1,p.midExBASE_Npop);
midExBASE_midExBASE_iAMPActx_s = zeros(nsamp,p.midExBASE_Npop);
midExBASE_midExBASE_iAMPActx_s(1,:) = midExBASE_midExBASE_iAMPActx_s_last;
midExBASE_midIxBASE_iGABActx_s_last =  p.midExBASE_midIxBASE_iGABActx_IC+p.midExBASE_midIxBASE_iGABActx_IC_noise.*rand(1,p.midIxBASE_Npop);
midExBASE_midIxBASE_iGABActx_s = zeros(nsamp,p.midIxBASE_Npop);
midExBASE_midIxBASE_iGABActx_s(1,:) = midExBASE_midIxBASE_iGABActx_s_last;
midIxBASE_midIxBASE_iGABActx_s_last =  p.midIxBASE_midIxBASE_iGABActx_IC+p.midIxBASE_midIxBASE_iGABActx_IC_noise.*rand(1,p.midIxBASE_Npop);
midIxBASE_midIxBASE_iGABActx_s = zeros(nsamp,p.midIxBASE_Npop);
midIxBASE_midIxBASE_iGABActx_s(1,:) = midIxBASE_midIxBASE_iGABActx_s_last;
deepIxBASE_deepExBASE_iAMPActx_s_last =  p.deepIxBASE_deepExBASE_iAMPActx_IC+p.deepIxBASE_deepExBASE_iAMPActx_IC_noise.*rand(1,p.deepExBASE_Npop);
deepIxBASE_deepExBASE_iAMPActx_s = zeros(nsamp,p.deepExBASE_Npop);
deepIxBASE_deepExBASE_iAMPActx_s(1,:) = deepIxBASE_deepExBASE_iAMPActx_s_last;
deepExBASE_deepExBASE_iAMPActx_s_last =  p.deepExBASE_deepExBASE_iAMPActx_IC+p.deepExBASE_deepExBASE_iAMPActx_IC_noise.*rand(1,p.deepExBASE_Npop);
deepExBASE_deepExBASE_iAMPActx_s = zeros(nsamp,p.deepExBASE_Npop);
deepExBASE_deepExBASE_iAMPActx_s(1,:) = deepExBASE_deepExBASE_iAMPActx_s_last;
deepExBASE_deepIxBASE_iGABActx_s_last =  p.deepExBASE_deepIxBASE_iGABActx_IC+p.deepExBASE_deepIxBASE_iGABActx_IC_noise.*rand(1,p.deepIxBASE_Npop);
deepExBASE_deepIxBASE_iGABActx_s = zeros(nsamp,p.deepIxBASE_Npop);
deepExBASE_deepIxBASE_iGABActx_s(1,:) = deepExBASE_deepIxBASE_iGABActx_s_last;
deepIxBASE_deepIxBASE_iGABActx_s_last =  p.deepIxBASE_deepIxBASE_iGABActx_IC+p.deepIxBASE_deepIxBASE_iGABActx_IC_noise.*rand(1,p.deepIxBASE_Npop);
deepIxBASE_deepIxBASE_iGABActx_s = zeros(nsamp,p.deepIxBASE_Npop);
deepIxBASE_deepIxBASE_iGABActx_s(1,:) = deepIxBASE_deepIxBASE_iGABActx_s_last;
IAxBASE_EAxBASE_iAMPActx_s_last =  p.IAxBASE_EAxBASE_iAMPActx_IC+p.IAxBASE_EAxBASE_iAMPActx_IC_noise.*rand(1,p.EAxBASE_Npop);
IAxBASE_EAxBASE_iAMPActx_s = zeros(nsamp,p.EAxBASE_Npop);
IAxBASE_EAxBASE_iAMPActx_s(1,:) = IAxBASE_EAxBASE_iAMPActx_s_last;
EAxBASE_EAxBASE_iAMPActx_s_last =  p.EAxBASE_EAxBASE_iAMPActx_IC+p.EAxBASE_EAxBASE_iAMPActx_IC_noise.*rand(1,p.EAxBASE_Npop);
EAxBASE_EAxBASE_iAMPActx_s = zeros(nsamp,p.EAxBASE_Npop);
EAxBASE_EAxBASE_iAMPActx_s(1,:) = EAxBASE_EAxBASE_iAMPActx_s_last;
EAxBASE_IAxBASE_iAMPActx_s_last =  p.EAxBASE_IAxBASE_iAMPActx_IC+p.EAxBASE_IAxBASE_iAMPActx_IC_noise.*rand(1,p.IAxBASE_Npop);
EAxBASE_IAxBASE_iAMPActx_s = zeros(nsamp,p.IAxBASE_Npop);
EAxBASE_IAxBASE_iAMPActx_s(1,:) = EAxBASE_IAxBASE_iAMPActx_s_last;
IAxBASE_IAxBASE_iAMPActx_s_last =  p.IAxBASE_IAxBASE_iAMPActx_IC+p.IAxBASE_IAxBASE_iAMPActx_IC_noise.*rand(1,p.IAxBASE_Npop);
IAxBASE_IAxBASE_iAMPActx_s = zeros(nsamp,p.IAxBASE_Npop);
IAxBASE_IAxBASE_iAMPActx_s(1,:) = IAxBASE_IAxBASE_iAMPActx_s_last;
IBxBASE_EBxBASE_iAMPActx_s_last =  p.IBxBASE_EBxBASE_iAMPActx_IC+p.IBxBASE_EBxBASE_iAMPActx_IC_noise.*rand(1,p.EBxBASE_Npop);
IBxBASE_EBxBASE_iAMPActx_s = zeros(nsamp,p.EBxBASE_Npop);
IBxBASE_EBxBASE_iAMPActx_s(1,:) = IBxBASE_EBxBASE_iAMPActx_s_last;
EBxBASE_EBxBASE_iAMPActx_s_last =  p.EBxBASE_EBxBASE_iAMPActx_IC+p.EBxBASE_EBxBASE_iAMPActx_IC_noise.*rand(1,p.EBxBASE_Npop);
EBxBASE_EBxBASE_iAMPActx_s = zeros(nsamp,p.EBxBASE_Npop);
EBxBASE_EBxBASE_iAMPActx_s(1,:) = EBxBASE_EBxBASE_iAMPActx_s_last;
EBxBASE_IBxBASE_iAMPActx_s_last =  p.EBxBASE_IBxBASE_iAMPActx_IC+p.EBxBASE_IBxBASE_iAMPActx_IC_noise.*rand(1,p.IBxBASE_Npop);
EBxBASE_IBxBASE_iAMPActx_s = zeros(nsamp,p.IBxBASE_Npop);
EBxBASE_IBxBASE_iAMPActx_s(1,:) = EBxBASE_IBxBASE_iAMPActx_s_last;
IBxBASE_IBxBASE_iAMPActx_s_last =  p.IBxBASE_IBxBASE_iAMPActx_IC+p.IBxBASE_IBxBASE_iAMPActx_IC_noise.*rand(1,p.IBxBASE_Npop);
IBxBASE_IBxBASE_iAMPActx_s = zeros(nsamp,p.IBxBASE_Npop);
IBxBASE_IBxBASE_iAMPActx_s(1,:) = IBxBASE_IBxBASE_iAMPActx_s_last;
ICxBASE_ECxBASE_iAMPActx_s_last =  p.ICxBASE_ECxBASE_iAMPActx_IC+p.ICxBASE_ECxBASE_iAMPActx_IC_noise.*rand(1,p.ECxBASE_Npop);
ICxBASE_ECxBASE_iAMPActx_s = zeros(nsamp,p.ECxBASE_Npop);
ICxBASE_ECxBASE_iAMPActx_s(1,:) = ICxBASE_ECxBASE_iAMPActx_s_last;
ECxBASE_ECxBASE_iAMPActx_s_last =  p.ECxBASE_ECxBASE_iAMPActx_IC+p.ECxBASE_ECxBASE_iAMPActx_IC_noise.*rand(1,p.ECxBASE_Npop);
ECxBASE_ECxBASE_iAMPActx_s = zeros(nsamp,p.ECxBASE_Npop);
ECxBASE_ECxBASE_iAMPActx_s(1,:) = ECxBASE_ECxBASE_iAMPActx_s_last;
ECxBASE_ICxBASE_iAMPActx_s_last =  p.ECxBASE_ICxBASE_iAMPActx_IC+p.ECxBASE_ICxBASE_iAMPActx_IC_noise.*rand(1,p.ICxBASE_Npop);
ECxBASE_ICxBASE_iAMPActx_s = zeros(nsamp,p.ICxBASE_Npop);
ECxBASE_ICxBASE_iAMPActx_s(1,:) = ECxBASE_ICxBASE_iAMPActx_s_last;
ICxBASE_ICxBASE_iAMPActx_s_last =  p.ICxBASE_ICxBASE_iAMPActx_IC+p.ICxBASE_ICxBASE_iAMPActx_IC_noise.*rand(1,p.ICxBASE_Npop);
ICxBASE_ICxBASE_iAMPActx_s = zeros(nsamp,p.ICxBASE_Npop);
ICxBASE_ICxBASE_iAMPActx_s(1,:) = ICxBASE_ICxBASE_iAMPActx_s_last;
midExBASE_EAxBASE_iAMPActx_s_last =  p.midExBASE_EAxBASE_iAMPActx_IC+p.midExBASE_EAxBASE_iAMPActx_IC_noise.*rand(1,p.EAxBASE_Npop);
midExBASE_EAxBASE_iAMPActx_s = zeros(nsamp,p.EAxBASE_Npop);
midExBASE_EAxBASE_iAMPActx_s(1,:) = midExBASE_EAxBASE_iAMPActx_s_last;
midExBASE_IAxBASE_iAMPActx_s_last =  p.midExBASE_IAxBASE_iAMPActx_IC+p.midExBASE_IAxBASE_iAMPActx_IC_noise.*rand(1,p.IAxBASE_Npop);
midExBASE_IAxBASE_iAMPActx_s = zeros(nsamp,p.IAxBASE_Npop);
midExBASE_IAxBASE_iAMPActx_s(1,:) = midExBASE_IAxBASE_iAMPActx_s_last;
midExBASE_EBxBASE_iAMPActx_s_last =  p.midExBASE_EBxBASE_iAMPActx_IC+p.midExBASE_EBxBASE_iAMPActx_IC_noise.*rand(1,p.EBxBASE_Npop);
midExBASE_EBxBASE_iAMPActx_s = zeros(nsamp,p.EBxBASE_Npop);
midExBASE_EBxBASE_iAMPActx_s(1,:) = midExBASE_EBxBASE_iAMPActx_s_last;
midExBASE_IBxBASE_iAMPActx_s_last =  p.midExBASE_IBxBASE_iAMPActx_IC+p.midExBASE_IBxBASE_iAMPActx_IC_noise.*rand(1,p.IBxBASE_Npop);
midExBASE_IBxBASE_iAMPActx_s = zeros(nsamp,p.IBxBASE_Npop);
midExBASE_IBxBASE_iAMPActx_s(1,:) = midExBASE_IBxBASE_iAMPActx_s_last;
midExBASE_ECxBASE_iAMPActx_s_last =  p.midExBASE_ECxBASE_iAMPActx_IC+p.midExBASE_ECxBASE_iAMPActx_IC_noise.*rand(1,p.ECxBASE_Npop);
midExBASE_ECxBASE_iAMPActx_s = zeros(nsamp,p.ECxBASE_Npop);
midExBASE_ECxBASE_iAMPActx_s(1,:) = midExBASE_ECxBASE_iAMPActx_s_last;
midExBASE_ICxBASE_iAMPActx_s_last =  p.midExBASE_ICxBASE_iAMPActx_IC+p.midExBASE_ICxBASE_iAMPActx_IC_noise.*rand(1,p.ICxBASE_Npop);
midExBASE_ICxBASE_iAMPActx_s = zeros(nsamp,p.ICxBASE_Npop);
midExBASE_ICxBASE_iAMPActx_s(1,:) = midExBASE_ICxBASE_iAMPActx_s_last;
supExBASE_midExBASE_iAMPActx_s_last =  p.supExBASE_midExBASE_iAMPActx_IC+p.supExBASE_midExBASE_iAMPActx_IC_noise.*rand(1,p.midExBASE_Npop);
supExBASE_midExBASE_iAMPActx_s = zeros(nsamp,p.midExBASE_Npop);
supExBASE_midExBASE_iAMPActx_s(1,:) = supExBASE_midExBASE_iAMPActx_s_last;
deepExBASE_midExBASE_iAMPActx_s_last =  p.deepExBASE_midExBASE_iAMPActx_IC+p.deepExBASE_midExBASE_iAMPActx_IC_noise.*rand(1,p.midExBASE_Npop);
deepExBASE_midExBASE_iAMPActx_s = zeros(nsamp,p.midExBASE_Npop);
deepExBASE_midExBASE_iAMPActx_s(1,:) = deepExBASE_midExBASE_iAMPActx_s_last;
deepExBASE_midIxBASE_iGABActx_s_last =  p.deepExBASE_midIxBASE_iGABActx_IC+p.deepExBASE_midIxBASE_iGABActx_IC_noise.*rand(1,p.midIxBASE_Npop);
deepExBASE_midIxBASE_iGABActx_s = zeros(nsamp,p.midIxBASE_Npop);
deepExBASE_midIxBASE_iGABActx_s(1,:) = deepExBASE_midIxBASE_iGABActx_s_last;
deepExBASE_supExBASE_iAMPActx_s_last =  p.deepExBASE_supExBASE_iAMPActx_IC+p.deepExBASE_supExBASE_iAMPActx_IC_noise.*rand(1,p.supExBASE_Npop);
deepExBASE_supExBASE_iAMPActx_s = zeros(nsamp,p.supExBASE_Npop);
deepExBASE_supExBASE_iAMPActx_s(1,:) = deepExBASE_supExBASE_iAMPActx_s_last;

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  supExBASE_V_k1 = (p.supExBASE_Iapp + ((((-p.supExBASE_iNa_gNa.*supExBASE_iNa_m_last.^3.*supExBASE_iNa_h_last.*(supExBASE_V_last-p.supExBASE_iNa_ENa))))+((((-p.supExBASE_iK_gK.*supExBASE_iK_n_last.^4.*(supExBASE_V_last-p.supExBASE_iK_EK))))+((-(((p.supExBASE_supExBASE_iAMPActx_gAMPA.*(supExBASE_supExBASE_iAMPActx_s_last*p.supExBASE_supExBASE_iAMPActx_netcon).*(supExBASE_V_last-p.supExBASE_supExBASE_iAMPActx_EAMPA)))))+((((-p.supExBASE_supIxBASE_iGABActx_gGABAa.*(supExBASE_supIxBASE_iGABActx_s_last*p.supExBASE_supIxBASE_iGABActx_netcon).*(supExBASE_V_last-p.supExBASE_supIxBASE_iGABActx_EGABAa))))+((-(((p.supExBASE_midExBASE_iAMPActx_gAMPA.*(supExBASE_midExBASE_iAMPActx_s_last*p.supExBASE_midExBASE_iAMPActx_netcon).*(supExBASE_V_last-p.supExBASE_midExBASE_iAMPActx_EAMPA)))))))))) + p.supExBASE_noise*randn(1, p.supExBASE_Npop))/p.supExBASE_C;
  supExBASE_iNa_m_k1 = (((2.5-.1*(supExBASE_V_last+65))./(exp(2.5-.1*(supExBASE_V_last+65))-1))).*(1-supExBASE_iNa_m_last)-((4*exp(-(supExBASE_V_last+65)/18))).*supExBASE_iNa_m_last;
  supExBASE_iNa_h_k1 = ((.07*exp(-(supExBASE_V_last+65)/20))).*(1-supExBASE_iNa_h_last)-((1./(exp(3-.1*(supExBASE_V_last+65))+1))).*supExBASE_iNa_h_last;
  supExBASE_iK_n_k1 = (((.1-.01*(supExBASE_V_last+65))./(exp(1-.1*(supExBASE_V_last+65))-1))).*(1-supExBASE_iK_n_last)-((.125*exp(-(supExBASE_V_last+65)/80))).*supExBASE_iK_n_last;
  supIxBASE_V_k1 = (p.supIxBASE_Iapp + ((((-p.supIxBASE_iNa_gNa.*supIxBASE_iNa_m_last.^3.*supIxBASE_iNa_h_last.*(supIxBASE_V_last-p.supIxBASE_iNa_ENa))))+((((-p.supIxBASE_iK_gK.*supIxBASE_iK_n_last.^4.*(supIxBASE_V_last-p.supIxBASE_iK_EK))))+((-(((p.supIxBASE_supExBASE_iAMPActx_gAMPA.*(supIxBASE_supExBASE_iAMPActx_s_last*p.supIxBASE_supExBASE_iAMPActx_netcon).*(supIxBASE_V_last-p.supIxBASE_supExBASE_iAMPActx_EAMPA)))))+((((-p.supIxBASE_supIxBASE_iGABActx_gGABAa.*(supIxBASE_supIxBASE_iGABActx_s_last*p.supIxBASE_supIxBASE_iGABActx_netcon).*(supIxBASE_V_last-p.supIxBASE_supIxBASE_iGABActx_EGABAa)))))))) + p.supIxBASE_noise*randn(1, p.supIxBASE_Npop))/p.supIxBASE_C;
  supIxBASE_iNa_m_k1 = (((2.5-.1*(supIxBASE_V_last+65))./(exp(2.5-.1*(supIxBASE_V_last+65))-1))).*(1-supIxBASE_iNa_m_last)-((4*exp(-(supIxBASE_V_last+65)/18))).*supIxBASE_iNa_m_last;
  supIxBASE_iNa_h_k1 = ((.07*exp(-(supIxBASE_V_last+65)/20))).*(1-supIxBASE_iNa_h_last)-((1./(exp(3-.1*(supIxBASE_V_last+65))+1))).*supIxBASE_iNa_h_last;
  supIxBASE_iK_n_k1 = (((.1-.01*(supIxBASE_V_last+65))./(exp(1-.1*(supIxBASE_V_last+65))-1))).*(1-supIxBASE_iK_n_last)-((.125*exp(-(supIxBASE_V_last+65)/80))).*supIxBASE_iK_n_last;
  midExBASE_V_k1 = (p.midExBASE_Iapp + ((((-p.midExBASE_iNa_gNa.*midExBASE_iNa_m_last.^3.*midExBASE_iNa_h_last.*(midExBASE_V_last-p.midExBASE_iNa_ENa))))+((((-p.midExBASE_iK_gK.*midExBASE_iK_n_last.^4.*(midExBASE_V_last-p.midExBASE_iK_EK))))+((-(((p.midExBASE_midExBASE_iAMPActx_gAMPA.*(midExBASE_midExBASE_iAMPActx_s_last*p.midExBASE_midExBASE_iAMPActx_netcon).*(midExBASE_V_last-p.midExBASE_midExBASE_iAMPActx_EAMPA)))))+((((-p.midExBASE_midIxBASE_iGABActx_gGABAa.*(midExBASE_midIxBASE_iGABActx_s_last*p.midExBASE_midIxBASE_iGABActx_netcon).*(midExBASE_V_last-p.midExBASE_midIxBASE_iGABActx_EGABAa))))+((-(((p.midExBASE_EAxBASE_iAMPActx_gAMPA.*(midExBASE_EAxBASE_iAMPActx_s_last*p.midExBASE_EAxBASE_iAMPActx_netcon).*(midExBASE_V_last-p.midExBASE_EAxBASE_iAMPActx_EAMPA)))))+((-(((p.midExBASE_IAxBASE_iAMPActx_gAMPA.*(midExBASE_IAxBASE_iAMPActx_s_last*p.midExBASE_IAxBASE_iAMPActx_netcon).*(midExBASE_V_last-p.midExBASE_IAxBASE_iAMPActx_EAMPA)))))+((-(((p.midExBASE_EBxBASE_iAMPActx_gAMPA.*(midExBASE_EBxBASE_iAMPActx_s_last*p.midExBASE_EBxBASE_iAMPActx_netcon).*(midExBASE_V_last-p.midExBASE_EBxBASE_iAMPActx_EAMPA)))))+((-(((p.midExBASE_IBxBASE_iAMPActx_gAMPA.*(midExBASE_IBxBASE_iAMPActx_s_last*p.midExBASE_IBxBASE_iAMPActx_netcon).*(midExBASE_V_last-p.midExBASE_IBxBASE_iAMPActx_EAMPA)))))+((-(((p.midExBASE_ECxBASE_iAMPActx_gAMPA.*(midExBASE_ECxBASE_iAMPActx_s_last*p.midExBASE_ECxBASE_iAMPActx_netcon).*(midExBASE_V_last-p.midExBASE_ECxBASE_iAMPActx_EAMPA)))))+((-(((p.midExBASE_ICxBASE_iAMPActx_gAMPA.*(midExBASE_ICxBASE_iAMPActx_s_last*p.midExBASE_ICxBASE_iAMPActx_netcon).*(midExBASE_V_last-p.midExBASE_ICxBASE_iAMPActx_EAMPA))))))))))))))) + p.midExBASE_noise*randn(1, p.midExBASE_Npop))/p.midExBASE_C;
  midExBASE_iNa_m_k1 = (((2.5-.1*(midExBASE_V_last+65))./(exp(2.5-.1*(midExBASE_V_last+65))-1))).*(1-midExBASE_iNa_m_last)-((4*exp(-(midExBASE_V_last+65)/18))).*midExBASE_iNa_m_last;
  midExBASE_iNa_h_k1 = ((.07*exp(-(midExBASE_V_last+65)/20))).*(1-midExBASE_iNa_h_last)-((1./(exp(3-.1*(midExBASE_V_last+65))+1))).*midExBASE_iNa_h_last;
  midExBASE_iK_n_k1 = (((.1-.01*(midExBASE_V_last+65))./(exp(1-.1*(midExBASE_V_last+65))-1))).*(1-midExBASE_iK_n_last)-((.125*exp(-(midExBASE_V_last+65)/80))).*midExBASE_iK_n_last;
  midIxBASE_V_k1 = (p.midIxBASE_Iapp + ((((-p.midIxBASE_iNa_gNa.*midIxBASE_iNa_m_last.^3.*midIxBASE_iNa_h_last.*(midIxBASE_V_last-p.midIxBASE_iNa_ENa))))+((((-p.midIxBASE_iK_gK.*midIxBASE_iK_n_last.^4.*(midIxBASE_V_last-p.midIxBASE_iK_EK))))+((-(((p.midIxBASE_midExBASE_iAMPActx_gAMPA.*(midIxBASE_midExBASE_iAMPActx_s_last*p.midIxBASE_midExBASE_iAMPActx_netcon).*(midIxBASE_V_last-p.midIxBASE_midExBASE_iAMPActx_EAMPA)))))+((((-p.midIxBASE_midIxBASE_iGABActx_gGABAa.*(midIxBASE_midIxBASE_iGABActx_s_last*p.midIxBASE_midIxBASE_iGABActx_netcon).*(midIxBASE_V_last-p.midIxBASE_midIxBASE_iGABActx_EGABAa)))))))) + p.midIxBASE_noise*randn(1, p.midIxBASE_Npop))/p.midIxBASE_C;
  midIxBASE_iNa_m_k1 = (((2.5-.1*(midIxBASE_V_last+65))./(exp(2.5-.1*(midIxBASE_V_last+65))-1))).*(1-midIxBASE_iNa_m_last)-((4*exp(-(midIxBASE_V_last+65)/18))).*midIxBASE_iNa_m_last;
  midIxBASE_iNa_h_k1 = ((.07*exp(-(midIxBASE_V_last+65)/20))).*(1-midIxBASE_iNa_h_last)-((1./(exp(3-.1*(midIxBASE_V_last+65))+1))).*midIxBASE_iNa_h_last;
  midIxBASE_iK_n_k1 = (((.1-.01*(midIxBASE_V_last+65))./(exp(1-.1*(midIxBASE_V_last+65))-1))).*(1-midIxBASE_iK_n_last)-((.125*exp(-(midIxBASE_V_last+65)/80))).*midIxBASE_iK_n_last;
  deepExBASE_V_k1 = (p.deepExBASE_Iapp + ((((-p.deepExBASE_iNa_gNa.*deepExBASE_iNa_m_last.^3.*deepExBASE_iNa_h_last.*(deepExBASE_V_last-p.deepExBASE_iNa_ENa))))+((((-p.deepExBASE_iK_gK.*deepExBASE_iK_n_last.^4.*(deepExBASE_V_last-p.deepExBASE_iK_EK))))+((-(((p.deepExBASE_deepExBASE_iAMPActx_gAMPA.*(deepExBASE_deepExBASE_iAMPActx_s_last*p.deepExBASE_deepExBASE_iAMPActx_netcon).*(deepExBASE_V_last-p.deepExBASE_deepExBASE_iAMPActx_EAMPA)))))+((((-p.deepExBASE_deepIxBASE_iGABActx_gGABAa.*(deepExBASE_deepIxBASE_iGABActx_s_last*p.deepExBASE_deepIxBASE_iGABActx_netcon).*(deepExBASE_V_last-p.deepExBASE_deepIxBASE_iGABActx_EGABAa))))+((-(((p.deepExBASE_midExBASE_iAMPActx_gAMPA.*(deepExBASE_midExBASE_iAMPActx_s_last*p.deepExBASE_midExBASE_iAMPActx_netcon).*(deepExBASE_V_last-p.deepExBASE_midExBASE_iAMPActx_EAMPA)))))+((((-p.deepExBASE_midIxBASE_iGABActx_gGABAa.*(deepExBASE_midIxBASE_iGABActx_s_last*p.deepExBASE_midIxBASE_iGABActx_netcon).*(deepExBASE_V_last-p.deepExBASE_midIxBASE_iGABActx_EGABAa))))+((-(((p.deepExBASE_supExBASE_iAMPActx_gAMPA.*(deepExBASE_supExBASE_iAMPActx_s_last*p.deepExBASE_supExBASE_iAMPActx_netcon).*(deepExBASE_V_last-p.deepExBASE_supExBASE_iAMPActx_EAMPA)))))))))))) + p.deepExBASE_noise*randn(1, p.deepExBASE_Npop))/p.deepExBASE_C;
  deepExBASE_iNa_m_k1 = (((2.5-.1*(deepExBASE_V_last+65))./(exp(2.5-.1*(deepExBASE_V_last+65))-1))).*(1-deepExBASE_iNa_m_last)-((4*exp(-(deepExBASE_V_last+65)/18))).*deepExBASE_iNa_m_last;
  deepExBASE_iNa_h_k1 = ((.07*exp(-(deepExBASE_V_last+65)/20))).*(1-deepExBASE_iNa_h_last)-((1./(exp(3-.1*(deepExBASE_V_last+65))+1))).*deepExBASE_iNa_h_last;
  deepExBASE_iK_n_k1 = (((.1-.01*(deepExBASE_V_last+65))./(exp(1-.1*(deepExBASE_V_last+65))-1))).*(1-deepExBASE_iK_n_last)-((.125*exp(-(deepExBASE_V_last+65)/80))).*deepExBASE_iK_n_last;
  deepIxBASE_V_k1 = (p.deepIxBASE_Iapp + ((((-p.deepIxBASE_iNa_gNa.*deepIxBASE_iNa_m_last.^3.*deepIxBASE_iNa_h_last.*(deepIxBASE_V_last-p.deepIxBASE_iNa_ENa))))+((((-p.deepIxBASE_iK_gK.*deepIxBASE_iK_n_last.^4.*(deepIxBASE_V_last-p.deepIxBASE_iK_EK))))+((-(((p.deepIxBASE_deepExBASE_iAMPActx_gAMPA.*(deepIxBASE_deepExBASE_iAMPActx_s_last*p.deepIxBASE_deepExBASE_iAMPActx_netcon).*(deepIxBASE_V_last-p.deepIxBASE_deepExBASE_iAMPActx_EAMPA)))))+((((-p.deepIxBASE_deepIxBASE_iGABActx_gGABAa.*(deepIxBASE_deepIxBASE_iGABActx_s_last*p.deepIxBASE_deepIxBASE_iGABActx_netcon).*(deepIxBASE_V_last-p.deepIxBASE_deepIxBASE_iGABActx_EGABAa)))))))) + p.deepIxBASE_noise*randn(1, p.deepIxBASE_Npop))/p.deepIxBASE_C;
  deepIxBASE_iNa_m_k1 = (((2.5-.1*(deepIxBASE_V_last+65))./(exp(2.5-.1*(deepIxBASE_V_last+65))-1))).*(1-deepIxBASE_iNa_m_last)-((4*exp(-(deepIxBASE_V_last+65)/18))).*deepIxBASE_iNa_m_last;
  deepIxBASE_iNa_h_k1 = ((.07*exp(-(deepIxBASE_V_last+65)/20))).*(1-deepIxBASE_iNa_h_last)-((1./(exp(3-.1*(deepIxBASE_V_last+65))+1))).*deepIxBASE_iNa_h_last;
  deepIxBASE_iK_n_k1 = (((.1-.01*(deepIxBASE_V_last+65))./(exp(1-.1*(deepIxBASE_V_last+65))-1))).*(1-deepIxBASE_iK_n_last)-((.125*exp(-(deepIxBASE_V_last+65)/80))).*deepIxBASE_iK_n_last;
  EAxBASE_V_k1 = (rand(1) + 4.5)*(20*(exp(- (t - p.EAxBASE_t1).^2) - exp(- (t - p.EAxBASE_t2).^2)) + p.EAxBASE_noise*randn(1, p.EAxBASE_Npop))/p.EAxBASE_C;
  EAxBASE_iNa_m_k1 = (((2.5-.1*(EAxBASE_V_last+65))./(exp(2.5-.1*(EAxBASE_V_last+65))-1))).*(1-EAxBASE_iNa_m_last)-((4*exp(-(EAxBASE_V_last+65)/18))).*EAxBASE_iNa_m_last;
  EAxBASE_iNa_h_k1 = ((.07*exp(-(EAxBASE_V_last+65)/20))).*(1-EAxBASE_iNa_h_last)-((1./(exp(3-.1*(EAxBASE_V_last+65))+1))).*EAxBASE_iNa_h_last;
  EAxBASE_iK_n_k1 = (((.1-.01*(EAxBASE_V_last+65))./(exp(1-.1*(EAxBASE_V_last+65))-1))).*(1-EAxBASE_iK_n_last)-((.125*exp(-(EAxBASE_V_last+65)/80))).*EAxBASE_iK_n_last;
  IAxBASE_V_k1 = (rand(1) + 4.5)*(20*(exp(- (t - p.IAxBASE_t1).^2) - exp(- (t - p.IAxBASE_t2).^2)) + p.IAxBASE_noise*randn(1, p.IAxBASE_Npop))/p.IAxBASE_C;
  IAxBASE_iNa_m_k1 = (((2.5-.1*(IAxBASE_V_last+65))./(exp(2.5-.1*(IAxBASE_V_last+65))-1))).*(1-IAxBASE_iNa_m_last)-((4*exp(-(IAxBASE_V_last+65)/18))).*IAxBASE_iNa_m_last;
  IAxBASE_iNa_h_k1 = ((.07*exp(-(IAxBASE_V_last+65)/20))).*(1-IAxBASE_iNa_h_last)-((1./(exp(3-.1*(IAxBASE_V_last+65))+1))).*IAxBASE_iNa_h_last;
  IAxBASE_iK_n_k1 = (((.1-.01*(IAxBASE_V_last+65))./(exp(1-.1*(IAxBASE_V_last+65))-1))).*(1-IAxBASE_iK_n_last)-((.125*exp(-(IAxBASE_V_last+65)/80))).*IAxBASE_iK_n_last;
  EBxBASE_V_k1 = (rand(1) + 4.5)*(20*(exp(- (t - p.EBxBASE_t1).^2) - exp(- (t - p.EBxBASE_t2).^2)) + p.EBxBASE_noise*randn(1, p.EBxBASE_Npop))/p.EBxBASE_C;
  EBxBASE_iNa_m_k1 = (((2.5-.1*(EBxBASE_V_last+65))./(exp(2.5-.1*(EBxBASE_V_last+65))-1))).*(1-EBxBASE_iNa_m_last)-((4*exp(-(EBxBASE_V_last+65)/18))).*EBxBASE_iNa_m_last;
  EBxBASE_iNa_h_k1 = ((.07*exp(-(EBxBASE_V_last+65)/20))).*(1-EBxBASE_iNa_h_last)-((1./(exp(3-.1*(EBxBASE_V_last+65))+1))).*EBxBASE_iNa_h_last;
  EBxBASE_iK_n_k1 = (((.1-.01*(EBxBASE_V_last+65))./(exp(1-.1*(EBxBASE_V_last+65))-1))).*(1-EBxBASE_iK_n_last)-((.125*exp(-(EBxBASE_V_last+65)/80))).*EBxBASE_iK_n_last;
  IBxBASE_V_k1 = (rand(1) + 4.5)*(20*(exp(- (t - p.IBxBASE_t1).^2) - exp(- (t - p.IBxBASE_t2).^2)) + p.IBxBASE_noise*randn(1, p.IBxBASE_Npop))/p.IBxBASE_C;
  IBxBASE_iNa_m_k1 = (((2.5-.1*(IBxBASE_V_last+65))./(exp(2.5-.1*(IBxBASE_V_last+65))-1))).*(1-IBxBASE_iNa_m_last)-((4*exp(-(IBxBASE_V_last+65)/18))).*IBxBASE_iNa_m_last;
  IBxBASE_iNa_h_k1 = ((.07*exp(-(IBxBASE_V_last+65)/20))).*(1-IBxBASE_iNa_h_last)-((1./(exp(3-.1*(IBxBASE_V_last+65))+1))).*IBxBASE_iNa_h_last;
  IBxBASE_iK_n_k1 = (((.1-.01*(IBxBASE_V_last+65))./(exp(1-.1*(IBxBASE_V_last+65))-1))).*(1-IBxBASE_iK_n_last)-((.125*exp(-(IBxBASE_V_last+65)/80))).*IBxBASE_iK_n_last;
  ECxBASE_V_k1 = (rand(1) + 4.5)*(20*(exp(- (t - p.ECxBASE_t1).^2) - exp(- (t - p.ECxBASE_t2).^2)) + p.ECxBASE_noise*randn(1, p.ECxBASE_Npop))/p.ECxBASE_C;
  ECxBASE_iNa_m_k1 = (((2.5-.1*(ECxBASE_V_last+65))./(exp(2.5-.1*(ECxBASE_V_last+65))-1))).*(1-ECxBASE_iNa_m_last)-((4*exp(-(ECxBASE_V_last+65)/18))).*ECxBASE_iNa_m_last;
  ECxBASE_iNa_h_k1 = ((.07*exp(-(ECxBASE_V_last+65)/20))).*(1-ECxBASE_iNa_h_last)-((1./(exp(3-.1*(ECxBASE_V_last+65))+1))).*ECxBASE_iNa_h_last;
  ECxBASE_iK_n_k1 = (((.1-.01*(ECxBASE_V_last+65))./(exp(1-.1*(ECxBASE_V_last+65))-1))).*(1-ECxBASE_iK_n_last)-((.125*exp(-(ECxBASE_V_last+65)/80))).*ECxBASE_iK_n_last;
  ICxBASE_V_k1 = (rand(1) + 4.5)*(20*(exp(- (t - p.ICxBASE_t1).^2) - exp(- (t - p.ICxBASE_t2).^2)) + p.ICxBASE_noise*randn(1, p.ICxBASE_Npop))/p.ICxBASE_C;
  ICxBASE_iNa_m_k1 = (((2.5-.1*(ICxBASE_V_last+65))./(exp(2.5-.1*(ICxBASE_V_last+65))-1))).*(1-ICxBASE_iNa_m_last)-((4*exp(-(ICxBASE_V_last+65)/18))).*ICxBASE_iNa_m_last;
  ICxBASE_iNa_h_k1 = ((.07*exp(-(ICxBASE_V_last+65)/20))).*(1-ICxBASE_iNa_h_last)-((1./(exp(3-.1*(ICxBASE_V_last+65))+1))).*ICxBASE_iNa_h_last;
  ICxBASE_iK_n_k1 = (((.1-.01*(ICxBASE_V_last+65))./(exp(1-.1*(ICxBASE_V_last+65))-1))).*(1-ICxBASE_iK_n_last)-((.125*exp(-(ICxBASE_V_last+65)/80))).*ICxBASE_iK_n_last;
  supIxBASE_supExBASE_iAMPActx_s_k1 = -supIxBASE_supExBASE_iAMPActx_s_last./p.supIxBASE_supExBASE_iAMPActx_tauAMPA + ((1-supIxBASE_supExBASE_iAMPActx_s_last)/p.supIxBASE_supExBASE_iAMPActx_tauAMPAr).*(1+tanh(supExBASE_V_last/10));
  supExBASE_supExBASE_iAMPActx_s_k1 = -supExBASE_supExBASE_iAMPActx_s_last./p.supExBASE_supExBASE_iAMPActx_tauAMPA + ((1-supExBASE_supExBASE_iAMPActx_s_last)/p.supExBASE_supExBASE_iAMPActx_tauAMPAr).*(1+tanh(supExBASE_V_last/10));
  supExBASE_supIxBASE_iGABActx_s_k1 = -supExBASE_supIxBASE_iGABActx_s_last./p.supExBASE_supIxBASE_iGABActx_tauGABA + 1/2*(1+tanh(supIxBASE_V_last/10)).*((1-supExBASE_supIxBASE_iGABActx_s_last)/p.supExBASE_supIxBASE_iGABActx_tauGABAr);
  supIxBASE_supIxBASE_iGABActx_s_k1 = -supIxBASE_supIxBASE_iGABActx_s_last./p.supIxBASE_supIxBASE_iGABActx_tauGABA + 1/2*(1+tanh(supIxBASE_V_last/10)).*((1-supIxBASE_supIxBASE_iGABActx_s_last)/p.supIxBASE_supIxBASE_iGABActx_tauGABAr);
  midIxBASE_midExBASE_iAMPActx_s_k1 = -midIxBASE_midExBASE_iAMPActx_s_last./p.midIxBASE_midExBASE_iAMPActx_tauAMPA + ((1-midIxBASE_midExBASE_iAMPActx_s_last)/p.midIxBASE_midExBASE_iAMPActx_tauAMPAr).*(1+tanh(midExBASE_V_last/10));
  midExBASE_midExBASE_iAMPActx_s_k1 = -midExBASE_midExBASE_iAMPActx_s_last./p.midExBASE_midExBASE_iAMPActx_tauAMPA + ((1-midExBASE_midExBASE_iAMPActx_s_last)/p.midExBASE_midExBASE_iAMPActx_tauAMPAr).*(1+tanh(midExBASE_V_last/10));
  midExBASE_midIxBASE_iGABActx_s_k1 = -midExBASE_midIxBASE_iGABActx_s_last./p.midExBASE_midIxBASE_iGABActx_tauGABA + 1/2*(1+tanh(midIxBASE_V_last/10)).*((1-midExBASE_midIxBASE_iGABActx_s_last)/p.midExBASE_midIxBASE_iGABActx_tauGABAr);
  midIxBASE_midIxBASE_iGABActx_s_k1 = -midIxBASE_midIxBASE_iGABActx_s_last./p.midIxBASE_midIxBASE_iGABActx_tauGABA + 1/2*(1+tanh(midIxBASE_V_last/10)).*((1-midIxBASE_midIxBASE_iGABActx_s_last)/p.midIxBASE_midIxBASE_iGABActx_tauGABAr);
  deepIxBASE_deepExBASE_iAMPActx_s_k1 = -deepIxBASE_deepExBASE_iAMPActx_s_last./p.deepIxBASE_deepExBASE_iAMPActx_tauAMPA + ((1-deepIxBASE_deepExBASE_iAMPActx_s_last)/p.deepIxBASE_deepExBASE_iAMPActx_tauAMPAr).*(1+tanh(deepExBASE_V_last/10));
  deepExBASE_deepExBASE_iAMPActx_s_k1 = -deepExBASE_deepExBASE_iAMPActx_s_last./p.deepExBASE_deepExBASE_iAMPActx_tauAMPA + ((1-deepExBASE_deepExBASE_iAMPActx_s_last)/p.deepExBASE_deepExBASE_iAMPActx_tauAMPAr).*(1+tanh(deepExBASE_V_last/10));
  deepExBASE_deepIxBASE_iGABActx_s_k1 = -deepExBASE_deepIxBASE_iGABActx_s_last./p.deepExBASE_deepIxBASE_iGABActx_tauGABA + 1/2*(1+tanh(deepIxBASE_V_last/10)).*((1-deepExBASE_deepIxBASE_iGABActx_s_last)/p.deepExBASE_deepIxBASE_iGABActx_tauGABAr);
  deepIxBASE_deepIxBASE_iGABActx_s_k1 = -deepIxBASE_deepIxBASE_iGABActx_s_last./p.deepIxBASE_deepIxBASE_iGABActx_tauGABA + 1/2*(1+tanh(deepIxBASE_V_last/10)).*((1-deepIxBASE_deepIxBASE_iGABActx_s_last)/p.deepIxBASE_deepIxBASE_iGABActx_tauGABAr);
  IAxBASE_EAxBASE_iAMPActx_s_k1 = -IAxBASE_EAxBASE_iAMPActx_s_last./p.IAxBASE_EAxBASE_iAMPActx_tauAMPA + ((1-IAxBASE_EAxBASE_iAMPActx_s_last)/p.IAxBASE_EAxBASE_iAMPActx_tauAMPAr).*(1+tanh(EAxBASE_V_last/10));
  EAxBASE_EAxBASE_iAMPActx_s_k1 = -EAxBASE_EAxBASE_iAMPActx_s_last./p.EAxBASE_EAxBASE_iAMPActx_tauAMPA + ((1-EAxBASE_EAxBASE_iAMPActx_s_last)/p.EAxBASE_EAxBASE_iAMPActx_tauAMPAr).*(1+tanh(EAxBASE_V_last/10));
  EAxBASE_IAxBASE_iAMPActx_s_k1 = -EAxBASE_IAxBASE_iAMPActx_s_last./p.EAxBASE_IAxBASE_iAMPActx_tauAMPA + ((1-EAxBASE_IAxBASE_iAMPActx_s_last)/p.EAxBASE_IAxBASE_iAMPActx_tauAMPAr).*(1+tanh(IAxBASE_V_last/10));
  IAxBASE_IAxBASE_iAMPActx_s_k1 = -IAxBASE_IAxBASE_iAMPActx_s_last./p.IAxBASE_IAxBASE_iAMPActx_tauAMPA + ((1-IAxBASE_IAxBASE_iAMPActx_s_last)/p.IAxBASE_IAxBASE_iAMPActx_tauAMPAr).*(1+tanh(IAxBASE_V_last/10));
  IBxBASE_EBxBASE_iAMPActx_s_k1 = -IBxBASE_EBxBASE_iAMPActx_s_last./p.IBxBASE_EBxBASE_iAMPActx_tauAMPA + ((1-IBxBASE_EBxBASE_iAMPActx_s_last)/p.IBxBASE_EBxBASE_iAMPActx_tauAMPAr).*(1+tanh(EBxBASE_V_last/10));
  EBxBASE_EBxBASE_iAMPActx_s_k1 = -EBxBASE_EBxBASE_iAMPActx_s_last./p.EBxBASE_EBxBASE_iAMPActx_tauAMPA + ((1-EBxBASE_EBxBASE_iAMPActx_s_last)/p.EBxBASE_EBxBASE_iAMPActx_tauAMPAr).*(1+tanh(EBxBASE_V_last/10));
  EBxBASE_IBxBASE_iAMPActx_s_k1 = -EBxBASE_IBxBASE_iAMPActx_s_last./p.EBxBASE_IBxBASE_iAMPActx_tauAMPA + ((1-EBxBASE_IBxBASE_iAMPActx_s_last)/p.EBxBASE_IBxBASE_iAMPActx_tauAMPAr).*(1+tanh(IBxBASE_V_last/10));
  IBxBASE_IBxBASE_iAMPActx_s_k1 = -IBxBASE_IBxBASE_iAMPActx_s_last./p.IBxBASE_IBxBASE_iAMPActx_tauAMPA + ((1-IBxBASE_IBxBASE_iAMPActx_s_last)/p.IBxBASE_IBxBASE_iAMPActx_tauAMPAr).*(1+tanh(IBxBASE_V_last/10));
  ICxBASE_ECxBASE_iAMPActx_s_k1 = -ICxBASE_ECxBASE_iAMPActx_s_last./p.ICxBASE_ECxBASE_iAMPActx_tauAMPA + ((1-ICxBASE_ECxBASE_iAMPActx_s_last)/p.ICxBASE_ECxBASE_iAMPActx_tauAMPAr).*(1+tanh(ECxBASE_V_last/10));
  ECxBASE_ECxBASE_iAMPActx_s_k1 = -ECxBASE_ECxBASE_iAMPActx_s_last./p.ECxBASE_ECxBASE_iAMPActx_tauAMPA + ((1-ECxBASE_ECxBASE_iAMPActx_s_last)/p.ECxBASE_ECxBASE_iAMPActx_tauAMPAr).*(1+tanh(ECxBASE_V_last/10));
  ECxBASE_ICxBASE_iAMPActx_s_k1 = -ECxBASE_ICxBASE_iAMPActx_s_last./p.ECxBASE_ICxBASE_iAMPActx_tauAMPA + ((1-ECxBASE_ICxBASE_iAMPActx_s_last)/p.ECxBASE_ICxBASE_iAMPActx_tauAMPAr).*(1+tanh(ICxBASE_V_last/10));
  ICxBASE_ICxBASE_iAMPActx_s_k1 = -ICxBASE_ICxBASE_iAMPActx_s_last./p.ICxBASE_ICxBASE_iAMPActx_tauAMPA + ((1-ICxBASE_ICxBASE_iAMPActx_s_last)/p.ICxBASE_ICxBASE_iAMPActx_tauAMPAr).*(1+tanh(ICxBASE_V_last/10));
  midExBASE_EAxBASE_iAMPActx_s_k1 = -midExBASE_EAxBASE_iAMPActx_s_last./p.midExBASE_EAxBASE_iAMPActx_tauAMPA + ((1-midExBASE_EAxBASE_iAMPActx_s_last)/p.midExBASE_EAxBASE_iAMPActx_tauAMPAr).*(1+tanh(EAxBASE_V_last/10));
  midExBASE_IAxBASE_iAMPActx_s_k1 = -midExBASE_IAxBASE_iAMPActx_s_last./p.midExBASE_IAxBASE_iAMPActx_tauAMPA + ((1-midExBASE_IAxBASE_iAMPActx_s_last)/p.midExBASE_IAxBASE_iAMPActx_tauAMPAr).*(1+tanh(IAxBASE_V_last/10));
  midExBASE_EBxBASE_iAMPActx_s_k1 = -midExBASE_EBxBASE_iAMPActx_s_last./p.midExBASE_EBxBASE_iAMPActx_tauAMPA + ((1-midExBASE_EBxBASE_iAMPActx_s_last)/p.midExBASE_EBxBASE_iAMPActx_tauAMPAr).*(1+tanh(EBxBASE_V_last/10));
  midExBASE_IBxBASE_iAMPActx_s_k1 = -midExBASE_IBxBASE_iAMPActx_s_last./p.midExBASE_IBxBASE_iAMPActx_tauAMPA + ((1-midExBASE_IBxBASE_iAMPActx_s_last)/p.midExBASE_IBxBASE_iAMPActx_tauAMPAr).*(1+tanh(IBxBASE_V_last/10));
  midExBASE_ECxBASE_iAMPActx_s_k1 = -midExBASE_ECxBASE_iAMPActx_s_last./p.midExBASE_ECxBASE_iAMPActx_tauAMPA + ((1-midExBASE_ECxBASE_iAMPActx_s_last)/p.midExBASE_ECxBASE_iAMPActx_tauAMPAr).*(1+tanh(ECxBASE_V_last/10));
  midExBASE_ICxBASE_iAMPActx_s_k1 = -midExBASE_ICxBASE_iAMPActx_s_last./p.midExBASE_ICxBASE_iAMPActx_tauAMPA + ((1-midExBASE_ICxBASE_iAMPActx_s_last)/p.midExBASE_ICxBASE_iAMPActx_tauAMPAr).*(1+tanh(ICxBASE_V_last/10));
  supExBASE_midExBASE_iAMPActx_s_k1 = -supExBASE_midExBASE_iAMPActx_s_last./p.supExBASE_midExBASE_iAMPActx_tauAMPA + ((1-supExBASE_midExBASE_iAMPActx_s_last)/p.supExBASE_midExBASE_iAMPActx_tauAMPAr).*(1+tanh(midExBASE_V_last/10));
  deepExBASE_midExBASE_iAMPActx_s_k1 = -deepExBASE_midExBASE_iAMPActx_s_last./p.deepExBASE_midExBASE_iAMPActx_tauAMPA + ((1-deepExBASE_midExBASE_iAMPActx_s_last)/p.deepExBASE_midExBASE_iAMPActx_tauAMPAr).*(1+tanh(midExBASE_V_last/10));
  deepExBASE_midIxBASE_iGABActx_s_k1 = -deepExBASE_midIxBASE_iGABActx_s_last./p.deepExBASE_midIxBASE_iGABActx_tauGABA + 1/2*(1+tanh(midIxBASE_V_last/10)).*((1-deepExBASE_midIxBASE_iGABActx_s_last)/p.deepExBASE_midIxBASE_iGABActx_tauGABAr);
  deepExBASE_supExBASE_iAMPActx_s_k1 = -deepExBASE_supExBASE_iAMPActx_s_last./p.deepExBASE_supExBASE_iAMPActx_tauAMPA + ((1-deepExBASE_supExBASE_iAMPActx_s_last)/p.deepExBASE_supExBASE_iAMPActx_tauAMPAr).*(1+tanh(supExBASE_V_last/10));

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  supExBASE_V_last = supExBASE_V_last+dt*supExBASE_V_k1;
  supExBASE_iNa_m_last = supExBASE_iNa_m_last+dt*supExBASE_iNa_m_k1;
  supExBASE_iNa_h_last = supExBASE_iNa_h_last+dt*supExBASE_iNa_h_k1;
  supExBASE_iK_n_last = supExBASE_iK_n_last+dt*supExBASE_iK_n_k1;
  supIxBASE_V_last = supIxBASE_V_last+dt*supIxBASE_V_k1;
  supIxBASE_iNa_m_last = supIxBASE_iNa_m_last+dt*supIxBASE_iNa_m_k1;
  supIxBASE_iNa_h_last = supIxBASE_iNa_h_last+dt*supIxBASE_iNa_h_k1;
  supIxBASE_iK_n_last = supIxBASE_iK_n_last+dt*supIxBASE_iK_n_k1;
  midExBASE_V_last = midExBASE_V_last+dt*midExBASE_V_k1;
  midExBASE_iNa_m_last = midExBASE_iNa_m_last+dt*midExBASE_iNa_m_k1;
  midExBASE_iNa_h_last = midExBASE_iNa_h_last+dt*midExBASE_iNa_h_k1;
  midExBASE_iK_n_last = midExBASE_iK_n_last+dt*midExBASE_iK_n_k1;
  midIxBASE_V_last = midIxBASE_V_last+dt*midIxBASE_V_k1;
  midIxBASE_iNa_m_last = midIxBASE_iNa_m_last+dt*midIxBASE_iNa_m_k1;
  midIxBASE_iNa_h_last = midIxBASE_iNa_h_last+dt*midIxBASE_iNa_h_k1;
  midIxBASE_iK_n_last = midIxBASE_iK_n_last+dt*midIxBASE_iK_n_k1;
  deepExBASE_V_last = deepExBASE_V_last+dt*deepExBASE_V_k1;
  deepExBASE_iNa_m_last = deepExBASE_iNa_m_last+dt*deepExBASE_iNa_m_k1;
  deepExBASE_iNa_h_last = deepExBASE_iNa_h_last+dt*deepExBASE_iNa_h_k1;
  deepExBASE_iK_n_last = deepExBASE_iK_n_last+dt*deepExBASE_iK_n_k1;
  deepIxBASE_V_last = deepIxBASE_V_last+dt*deepIxBASE_V_k1;
  deepIxBASE_iNa_m_last = deepIxBASE_iNa_m_last+dt*deepIxBASE_iNa_m_k1;
  deepIxBASE_iNa_h_last = deepIxBASE_iNa_h_last+dt*deepIxBASE_iNa_h_k1;
  deepIxBASE_iK_n_last = deepIxBASE_iK_n_last+dt*deepIxBASE_iK_n_k1;
  EAxBASE_V_last = EAxBASE_V_last+dt*EAxBASE_V_k1;
  EAxBASE_iNa_m_last = EAxBASE_iNa_m_last+dt*EAxBASE_iNa_m_k1;
  EAxBASE_iNa_h_last = EAxBASE_iNa_h_last+dt*EAxBASE_iNa_h_k1;
  EAxBASE_iK_n_last = EAxBASE_iK_n_last+dt*EAxBASE_iK_n_k1;
  IAxBASE_V_last = IAxBASE_V_last+dt*IAxBASE_V_k1;
  IAxBASE_iNa_m_last = IAxBASE_iNa_m_last+dt*IAxBASE_iNa_m_k1;
  IAxBASE_iNa_h_last = IAxBASE_iNa_h_last+dt*IAxBASE_iNa_h_k1;
  IAxBASE_iK_n_last = IAxBASE_iK_n_last+dt*IAxBASE_iK_n_k1;
  EBxBASE_V_last = EBxBASE_V_last+dt*EBxBASE_V_k1;
  EBxBASE_iNa_m_last = EBxBASE_iNa_m_last+dt*EBxBASE_iNa_m_k1;
  EBxBASE_iNa_h_last = EBxBASE_iNa_h_last+dt*EBxBASE_iNa_h_k1;
  EBxBASE_iK_n_last = EBxBASE_iK_n_last+dt*EBxBASE_iK_n_k1;
  IBxBASE_V_last = IBxBASE_V_last+dt*IBxBASE_V_k1;
  IBxBASE_iNa_m_last = IBxBASE_iNa_m_last+dt*IBxBASE_iNa_m_k1;
  IBxBASE_iNa_h_last = IBxBASE_iNa_h_last+dt*IBxBASE_iNa_h_k1;
  IBxBASE_iK_n_last = IBxBASE_iK_n_last+dt*IBxBASE_iK_n_k1;
  ECxBASE_V_last = ECxBASE_V_last+dt*ECxBASE_V_k1;
  ECxBASE_iNa_m_last = ECxBASE_iNa_m_last+dt*ECxBASE_iNa_m_k1;
  ECxBASE_iNa_h_last = ECxBASE_iNa_h_last+dt*ECxBASE_iNa_h_k1;
  ECxBASE_iK_n_last = ECxBASE_iK_n_last+dt*ECxBASE_iK_n_k1;
  ICxBASE_V_last = ICxBASE_V_last+dt*ICxBASE_V_k1;
  ICxBASE_iNa_m_last = ICxBASE_iNa_m_last+dt*ICxBASE_iNa_m_k1;
  ICxBASE_iNa_h_last = ICxBASE_iNa_h_last+dt*ICxBASE_iNa_h_k1;
  ICxBASE_iK_n_last = ICxBASE_iK_n_last+dt*ICxBASE_iK_n_k1;
  supIxBASE_supExBASE_iAMPActx_s_last = supIxBASE_supExBASE_iAMPActx_s_last+dt*supIxBASE_supExBASE_iAMPActx_s_k1;
  supExBASE_supExBASE_iAMPActx_s_last = supExBASE_supExBASE_iAMPActx_s_last+dt*supExBASE_supExBASE_iAMPActx_s_k1;
  supExBASE_supIxBASE_iGABActx_s_last = supExBASE_supIxBASE_iGABActx_s_last+dt*supExBASE_supIxBASE_iGABActx_s_k1;
  supIxBASE_supIxBASE_iGABActx_s_last = supIxBASE_supIxBASE_iGABActx_s_last+dt*supIxBASE_supIxBASE_iGABActx_s_k1;
  midIxBASE_midExBASE_iAMPActx_s_last = midIxBASE_midExBASE_iAMPActx_s_last+dt*midIxBASE_midExBASE_iAMPActx_s_k1;
  midExBASE_midExBASE_iAMPActx_s_last = midExBASE_midExBASE_iAMPActx_s_last+dt*midExBASE_midExBASE_iAMPActx_s_k1;
  midExBASE_midIxBASE_iGABActx_s_last = midExBASE_midIxBASE_iGABActx_s_last+dt*midExBASE_midIxBASE_iGABActx_s_k1;
  midIxBASE_midIxBASE_iGABActx_s_last = midIxBASE_midIxBASE_iGABActx_s_last+dt*midIxBASE_midIxBASE_iGABActx_s_k1;
  deepIxBASE_deepExBASE_iAMPActx_s_last = deepIxBASE_deepExBASE_iAMPActx_s_last+dt*deepIxBASE_deepExBASE_iAMPActx_s_k1;
  deepExBASE_deepExBASE_iAMPActx_s_last = deepExBASE_deepExBASE_iAMPActx_s_last+dt*deepExBASE_deepExBASE_iAMPActx_s_k1;
  deepExBASE_deepIxBASE_iGABActx_s_last = deepExBASE_deepIxBASE_iGABActx_s_last+dt*deepExBASE_deepIxBASE_iGABActx_s_k1;
  deepIxBASE_deepIxBASE_iGABActx_s_last = deepIxBASE_deepIxBASE_iGABActx_s_last+dt*deepIxBASE_deepIxBASE_iGABActx_s_k1;
  IAxBASE_EAxBASE_iAMPActx_s_last = IAxBASE_EAxBASE_iAMPActx_s_last+dt*IAxBASE_EAxBASE_iAMPActx_s_k1;
  EAxBASE_EAxBASE_iAMPActx_s_last = EAxBASE_EAxBASE_iAMPActx_s_last+dt*EAxBASE_EAxBASE_iAMPActx_s_k1;
  EAxBASE_IAxBASE_iAMPActx_s_last = EAxBASE_IAxBASE_iAMPActx_s_last+dt*EAxBASE_IAxBASE_iAMPActx_s_k1;
  IAxBASE_IAxBASE_iAMPActx_s_last = IAxBASE_IAxBASE_iAMPActx_s_last+dt*IAxBASE_IAxBASE_iAMPActx_s_k1;
  IBxBASE_EBxBASE_iAMPActx_s_last = IBxBASE_EBxBASE_iAMPActx_s_last+dt*IBxBASE_EBxBASE_iAMPActx_s_k1;
  EBxBASE_EBxBASE_iAMPActx_s_last = EBxBASE_EBxBASE_iAMPActx_s_last+dt*EBxBASE_EBxBASE_iAMPActx_s_k1;
  EBxBASE_IBxBASE_iAMPActx_s_last = EBxBASE_IBxBASE_iAMPActx_s_last+dt*EBxBASE_IBxBASE_iAMPActx_s_k1;
  IBxBASE_IBxBASE_iAMPActx_s_last = IBxBASE_IBxBASE_iAMPActx_s_last+dt*IBxBASE_IBxBASE_iAMPActx_s_k1;
  ICxBASE_ECxBASE_iAMPActx_s_last = ICxBASE_ECxBASE_iAMPActx_s_last+dt*ICxBASE_ECxBASE_iAMPActx_s_k1;
  ECxBASE_ECxBASE_iAMPActx_s_last = ECxBASE_ECxBASE_iAMPActx_s_last+dt*ECxBASE_ECxBASE_iAMPActx_s_k1;
  ECxBASE_ICxBASE_iAMPActx_s_last = ECxBASE_ICxBASE_iAMPActx_s_last+dt*ECxBASE_ICxBASE_iAMPActx_s_k1;
  ICxBASE_ICxBASE_iAMPActx_s_last = ICxBASE_ICxBASE_iAMPActx_s_last+dt*ICxBASE_ICxBASE_iAMPActx_s_k1;
  midExBASE_EAxBASE_iAMPActx_s_last = midExBASE_EAxBASE_iAMPActx_s_last+dt*midExBASE_EAxBASE_iAMPActx_s_k1;
  midExBASE_IAxBASE_iAMPActx_s_last = midExBASE_IAxBASE_iAMPActx_s_last+dt*midExBASE_IAxBASE_iAMPActx_s_k1;
  midExBASE_EBxBASE_iAMPActx_s_last = midExBASE_EBxBASE_iAMPActx_s_last+dt*midExBASE_EBxBASE_iAMPActx_s_k1;
  midExBASE_IBxBASE_iAMPActx_s_last = midExBASE_IBxBASE_iAMPActx_s_last+dt*midExBASE_IBxBASE_iAMPActx_s_k1;
  midExBASE_ECxBASE_iAMPActx_s_last = midExBASE_ECxBASE_iAMPActx_s_last+dt*midExBASE_ECxBASE_iAMPActx_s_k1;
  midExBASE_ICxBASE_iAMPActx_s_last = midExBASE_ICxBASE_iAMPActx_s_last+dt*midExBASE_ICxBASE_iAMPActx_s_k1;
  supExBASE_midExBASE_iAMPActx_s_last = supExBASE_midExBASE_iAMPActx_s_last+dt*supExBASE_midExBASE_iAMPActx_s_k1;
  deepExBASE_midExBASE_iAMPActx_s_last = deepExBASE_midExBASE_iAMPActx_s_last+dt*deepExBASE_midExBASE_iAMPActx_s_k1;
  deepExBASE_midIxBASE_iGABActx_s_last = deepExBASE_midIxBASE_iGABActx_s_last+dt*deepExBASE_midIxBASE_iGABActx_s_k1;
  deepExBASE_supExBASE_iAMPActx_s_last = deepExBASE_supExBASE_iAMPActx_s_last+dt*deepExBASE_supExBASE_iAMPActx_s_k1;

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    supExBASE_V(n,:) = supExBASE_V_last;
    supExBASE_iNa_m(n,:) = supExBASE_iNa_m_last;
    supExBASE_iNa_h(n,:) = supExBASE_iNa_h_last;
    supExBASE_iK_n(n,:) = supExBASE_iK_n_last;
    supIxBASE_V(n,:) = supIxBASE_V_last;
    supIxBASE_iNa_m(n,:) = supIxBASE_iNa_m_last;
    supIxBASE_iNa_h(n,:) = supIxBASE_iNa_h_last;
    supIxBASE_iK_n(n,:) = supIxBASE_iK_n_last;
    midExBASE_V(n,:) = midExBASE_V_last;
    midExBASE_iNa_m(n,:) = midExBASE_iNa_m_last;
    midExBASE_iNa_h(n,:) = midExBASE_iNa_h_last;
    midExBASE_iK_n(n,:) = midExBASE_iK_n_last;
    midIxBASE_V(n,:) = midIxBASE_V_last;
    midIxBASE_iNa_m(n,:) = midIxBASE_iNa_m_last;
    midIxBASE_iNa_h(n,:) = midIxBASE_iNa_h_last;
    midIxBASE_iK_n(n,:) = midIxBASE_iK_n_last;
    deepExBASE_V(n,:) = deepExBASE_V_last;
    deepExBASE_iNa_m(n,:) = deepExBASE_iNa_m_last;
    deepExBASE_iNa_h(n,:) = deepExBASE_iNa_h_last;
    deepExBASE_iK_n(n,:) = deepExBASE_iK_n_last;
    deepIxBASE_V(n,:) = deepIxBASE_V_last;
    deepIxBASE_iNa_m(n,:) = deepIxBASE_iNa_m_last;
    deepIxBASE_iNa_h(n,:) = deepIxBASE_iNa_h_last;
    deepIxBASE_iK_n(n,:) = deepIxBASE_iK_n_last;
    EAxBASE_V(n,:) = EAxBASE_V_last;
    EAxBASE_iNa_m(n,:) = EAxBASE_iNa_m_last;
    EAxBASE_iNa_h(n,:) = EAxBASE_iNa_h_last;
    EAxBASE_iK_n(n,:) = EAxBASE_iK_n_last;
    IAxBASE_V(n,:) = IAxBASE_V_last;
    IAxBASE_iNa_m(n,:) = IAxBASE_iNa_m_last;
    IAxBASE_iNa_h(n,:) = IAxBASE_iNa_h_last;
    IAxBASE_iK_n(n,:) = IAxBASE_iK_n_last;
    EBxBASE_V(n,:) = EBxBASE_V_last;
    EBxBASE_iNa_m(n,:) = EBxBASE_iNa_m_last;
    EBxBASE_iNa_h(n,:) = EBxBASE_iNa_h_last;
    EBxBASE_iK_n(n,:) = EBxBASE_iK_n_last;
    IBxBASE_V(n,:) = IBxBASE_V_last;
    IBxBASE_iNa_m(n,:) = IBxBASE_iNa_m_last;
    IBxBASE_iNa_h(n,:) = IBxBASE_iNa_h_last;
    IBxBASE_iK_n(n,:) = IBxBASE_iK_n_last;
    ECxBASE_V(n,:) = ECxBASE_V_last;
    ECxBASE_iNa_m(n,:) = ECxBASE_iNa_m_last;
    ECxBASE_iNa_h(n,:) = ECxBASE_iNa_h_last;
    ECxBASE_iK_n(n,:) = ECxBASE_iK_n_last;
    ICxBASE_V(n,:) = ICxBASE_V_last;
    ICxBASE_iNa_m(n,:) = ICxBASE_iNa_m_last;
    ICxBASE_iNa_h(n,:) = ICxBASE_iNa_h_last;
    ICxBASE_iK_n(n,:) = ICxBASE_iK_n_last;
    supIxBASE_supExBASE_iAMPActx_s(n,:) = supIxBASE_supExBASE_iAMPActx_s_last;
    supExBASE_supExBASE_iAMPActx_s(n,:) = supExBASE_supExBASE_iAMPActx_s_last;
    supExBASE_supIxBASE_iGABActx_s(n,:) = supExBASE_supIxBASE_iGABActx_s_last;
    supIxBASE_supIxBASE_iGABActx_s(n,:) = supIxBASE_supIxBASE_iGABActx_s_last;
    midIxBASE_midExBASE_iAMPActx_s(n,:) = midIxBASE_midExBASE_iAMPActx_s_last;
    midExBASE_midExBASE_iAMPActx_s(n,:) = midExBASE_midExBASE_iAMPActx_s_last;
    midExBASE_midIxBASE_iGABActx_s(n,:) = midExBASE_midIxBASE_iGABActx_s_last;
    midIxBASE_midIxBASE_iGABActx_s(n,:) = midIxBASE_midIxBASE_iGABActx_s_last;
    deepIxBASE_deepExBASE_iAMPActx_s(n,:) = deepIxBASE_deepExBASE_iAMPActx_s_last;
    deepExBASE_deepExBASE_iAMPActx_s(n,:) = deepExBASE_deepExBASE_iAMPActx_s_last;
    deepExBASE_deepIxBASE_iGABActx_s(n,:) = deepExBASE_deepIxBASE_iGABActx_s_last;
    deepIxBASE_deepIxBASE_iGABActx_s(n,:) = deepIxBASE_deepIxBASE_iGABActx_s_last;
    IAxBASE_EAxBASE_iAMPActx_s(n,:) = IAxBASE_EAxBASE_iAMPActx_s_last;
    EAxBASE_EAxBASE_iAMPActx_s(n,:) = EAxBASE_EAxBASE_iAMPActx_s_last;
    EAxBASE_IAxBASE_iAMPActx_s(n,:) = EAxBASE_IAxBASE_iAMPActx_s_last;
    IAxBASE_IAxBASE_iAMPActx_s(n,:) = IAxBASE_IAxBASE_iAMPActx_s_last;
    IBxBASE_EBxBASE_iAMPActx_s(n,:) = IBxBASE_EBxBASE_iAMPActx_s_last;
    EBxBASE_EBxBASE_iAMPActx_s(n,:) = EBxBASE_EBxBASE_iAMPActx_s_last;
    EBxBASE_IBxBASE_iAMPActx_s(n,:) = EBxBASE_IBxBASE_iAMPActx_s_last;
    IBxBASE_IBxBASE_iAMPActx_s(n,:) = IBxBASE_IBxBASE_iAMPActx_s_last;
    ICxBASE_ECxBASE_iAMPActx_s(n,:) = ICxBASE_ECxBASE_iAMPActx_s_last;
    ECxBASE_ECxBASE_iAMPActx_s(n,:) = ECxBASE_ECxBASE_iAMPActx_s_last;
    ECxBASE_ICxBASE_iAMPActx_s(n,:) = ECxBASE_ICxBASE_iAMPActx_s_last;
    ICxBASE_ICxBASE_iAMPActx_s(n,:) = ICxBASE_ICxBASE_iAMPActx_s_last;
    midExBASE_EAxBASE_iAMPActx_s(n,:) = midExBASE_EAxBASE_iAMPActx_s_last;
    midExBASE_IAxBASE_iAMPActx_s(n,:) = midExBASE_IAxBASE_iAMPActx_s_last;
    midExBASE_EBxBASE_iAMPActx_s(n,:) = midExBASE_EBxBASE_iAMPActx_s_last;
    midExBASE_IBxBASE_iAMPActx_s(n,:) = midExBASE_IBxBASE_iAMPActx_s_last;
    midExBASE_ECxBASE_iAMPActx_s(n,:) = midExBASE_ECxBASE_iAMPActx_s_last;
    midExBASE_ICxBASE_iAMPActx_s(n,:) = midExBASE_ICxBASE_iAMPActx_s_last;
    supExBASE_midExBASE_iAMPActx_s(n,:) = supExBASE_midExBASE_iAMPActx_s_last;
    deepExBASE_midExBASE_iAMPActx_s(n,:) = deepExBASE_midExBASE_iAMPActx_s_last;
    deepExBASE_midIxBASE_iGABActx_s(n,:) = deepExBASE_midIxBASE_iGABActx_s_last;
    deepExBASE_supExBASE_iAMPActx_s(n,:) = deepExBASE_supExBASE_iAMPActx_s_last;

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
