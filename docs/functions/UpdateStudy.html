<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of ds.updateStudy</title>
  <meta name="keywords" content="ds.updateStudy">
  <meta name="description" content="UPDATESTUDY - helper function to keep track of study metadata when anything is saved">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- menu.html functions -->
<h1>ds.updateStudy
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>UPDATESTUDY - helper function to keep track of study metadata when anything is saved</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function studyinfo=ds.updateStudy(study_dir,varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment">UPDATESTUDY - helper function to keep track of study metadata when anything is saved

 This only updates simulation-specific info in the DynaSim studyinfo
 structure, tracks status of simulations and analyses, and manages the queue
 for simultaneous processes updating studyinfo structure.

 Usage:
   studyinfo=ds.updateStudy(study_dir,varargin)

 Inputs:
   - study_dir
   - options: TODO

 Outputs:
   - studyinfo

 Notes:
 - Note: this function is not intended for users. it is an internal function
   called by functions like ds.simulateModel, AnalyzeStudy, and ds.createBatch.
 - Note: this function should only update metadata stored in the
   studyinfo.simulations substructure.

 TODO: this multiple things in this function should be split up into individual functions

 See also: <a href="ds.checkStudyinfo.html" class="code" title="function studyinfo=ds.checkStudyinfo(studyinfo,varargin)">ds.checkStudyinfo</a>, <a href="ds.setupStudy.html" class="code" title="function [studyinfo,options]=ds.setupStudy(base_model,varargin)">ds.setupStudy</a>, <a href="ds.simulateModel.html" class="code" title="function [data,studyinfo]=ds.simulateModel(model,varargin)">ds.simulateModel</a>, <a href="ds.createBatch.html" class="code" title="function studyinfo = ds.createBatch(base_model,modifications_set,varargin)">ds.createBatch</a>, <a href="AnalyzeStudy.html" class="code" title="function [results,studyinfo]=AnalyzeStudy(data,func,varargin)">AnalyzeStudy</a></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="ds.checkOptions.html" class="code" title="function [parms, params_unspecified ] = ds.checkOptions(options, options_schema, strict)">ds.checkOptions</a>	CHECKOPTIONS - organize key/value pairs in structure with default or user-supplied values according to a schema</li><li><a href="ds.checkStudyinfo.html" class="code" title="function studyinfo=ds.checkStudyinfo(studyinfo,varargin)">ds.checkStudyinfo</a>	CHECKSTUDYINFO - Standardize studyinfo structure and auto-populate missing fields</li><li><a href="displayError.html" class="code" title="function displayError(err)">displayError</a>	DISPLAYERROR - Wrapper to print MATLAB error</li><li><a href="ds.studyinfoIO.html" class="code" title="function studyinfo=ds.studyinfoIO(studyinfo,study_file,id,verbose_flag)">ds.studyinfoIO</a>	STUDYINFOIO - use lock files to manage concurrent access to a shared studyinfo</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="ds.simulateModel.html" class="code" title="function [data,studyinfo]=ds.simulateModel(model,varargin)">ds.simulateModel</a>	% data=ds.simulateModel(model,'option',value,...)</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function studyinfo=ds.updateStudy(study_dir,varargin)</a>
0002 <span class="comment">%UPDATESTUDY - helper function to keep track of study metadata when anything is saved</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% This only updates simulation-specific info in the DynaSim studyinfo</span>
0005 <span class="comment">% structure, tracks status of simulations and analyses, and manages the queue</span>
0006 <span class="comment">% for simultaneous processes updating studyinfo structure.</span>
0007 <span class="comment">%</span>
0008 <span class="comment">% Usage:</span>
0009 <span class="comment">%   studyinfo=ds.updateStudy(study_dir,varargin)</span>
0010 <span class="comment">%</span>
0011 <span class="comment">% Inputs:</span>
0012 <span class="comment">%   - study_dir</span>
0013 <span class="comment">%   - options: TODO</span>
0014 <span class="comment">%</span>
0015 <span class="comment">% Outputs:</span>
0016 <span class="comment">%   - studyinfo</span>
0017 <span class="comment">%</span>
0018 <span class="comment">% Notes:</span>
0019 <span class="comment">% - Note: this function is not intended for users. it is an internal function</span>
0020 <span class="comment">%   called by functions like ds.simulateModel, AnalyzeStudy, and ds.createBatch.</span>
0021 <span class="comment">% - Note: this function should only update metadata stored in the</span>
0022 <span class="comment">%   studyinfo.simulations substructure.</span>
0023 <span class="comment">%</span>
0024 <span class="comment">% TODO: this multiple things in this function should be split up into individual functions</span>
0025 <span class="comment">%</span>
0026 <span class="comment">% See also: ds.checkStudyinfo, ds.setupStudy, ds.simulateModel, ds.createBatch, AnalyzeStudy</span>
0027 
0028 
0029 <span class="comment">% check inputs</span>
0030 options=<a href="ds.checkOptions.html" class="code" title="function [parms, params_unspecified ] = ds.checkOptions(options, options_schema, strict)">ds.checkOptions</a>(varargin,{<span class="keyword">...</span>
0031   <span class="string">'process_id'</span>,[],[],<span class="keyword">...</span><span class="comment"> % identifier for simulation to update</span>
0032   <span class="string">'status'</span>,[],[],<span class="keyword">...</span><span class="comment"> % status of simulation</span>
0033   <span class="string">'modifications_set'</span>,[],[],<span class="keyword">...</span><span class="comment"> % search space</span>
0034   <span class="string">'model'</span>,[],[],<span class="keyword">...</span><span class="comment"> % base_model or modified_model</span>
0035   <span class="string">'simulator_options'</span>,[],[],<span class="keyword">...</span><span class="comment"> % base_simulator_options</span>
0036   <span class="string">'solve_file'</span>,[],[],<span class="keyword">...</span><span class="comment"> % m- or mex-file solving the system</span>
0037   <span class="string">'prefix'</span>,<span class="string">'study'</span>,[],<span class="keyword">...</span><span class="comment"> % prefix prepended to all output files</span>
0038   <span class="string">'email'</span>,[],[],<span class="keyword">...</span><span class="comment"> % email to send notification upon study completion</span>
0039   <span class="string">'verbose_flag'</span>,0,{0,1},<span class="keyword">...</span>
0040   <span class="string">'duration'</span>,[],[],<span class="keyword">...</span><span class="comment"> % process duration</span>
0041   },false);
0042 <span class="comment">%   'base_data_files',[],[],... % base data files to analyze</span>
0043 <span class="comment">%   'project_id',[],[],... % unique identifier of parent project</span>
0044 
0045 <span class="comment">% load most recent version of studyinfo structure from file</span>
0046 studyinfo=<a href="ds.checkStudyinfo.html" class="code" title="function studyinfo=ds.checkStudyinfo(studyinfo,varargin)">ds.checkStudyinfo</a>(study_dir,<span class="string">'process_id'</span>,options.process_id);
0047 already_finished = all(strcmp(<span class="string">'finished'</span>,{studyinfo.simulations.status}));
0048 
0049 <span class="comment">% track status of simulations and analyses</span>
0050 <span class="comment">% index to this simulation in studyinfo</span>
0051 sim_ind=find([studyinfo.simulations.sim_id]==options.process_id);
0052 <span class="comment">% update studyinfo.simulations</span>
0053 <span class="comment">% update basic fields</span>
0054 <span class="keyword">if</span> ~isempty(options.simulator_options)
0055   studyinfo.simulations(sim_ind).simulator_options=options.simulator_options;
0056 <span class="keyword">end</span>
0057 <span class="keyword">if</span> ~isempty(options.solve_file)
0058   studyinfo.simulations(sim_ind).solve_file=options.solve_file;
0059 <span class="keyword">end</span>
0060 <span class="comment">% status-specific updates</span>
0061 <span class="keyword">if</span> ~isempty(options.status) &amp;&amp; ~isempty(studyinfo.simulations)
0062   <span class="keyword">if</span> options.verbose_flag
0063     fprintf(<span class="string">'setting status=''%s'' where sim_id=%g\n'</span>,options.status,options.process_id);
0064   <span class="keyword">end</span>
0065   studyinfo.simulations(sim_ind).status=options.status;
0066   <span class="keyword">switch</span> options.status
0067     <span class="keyword">case</span> <span class="string">'finished'</span>
0068       <span class="comment">% set stop_time</span>
0069       studyinfo.simulations(sim_ind).stop_time=datestr(now);
0070       studyinfo.simulations(sim_ind).simulator_options=options.simulator_options;
0071       <span class="comment">% save DynaSim model structure</span>
0072       <span class="keyword">if</span> isstruct(options.model)
0073         model=options.model;
0074         model_file=studyinfo.simulations(sim_ind).modified_model_file;
0075         save(model_file,<span class="string">'model'</span>,<span class="string">'-v7.3'</span>);
0076         <span class="keyword">if</span> options.verbose_flag
0077           fprintf(<span class="string">'model saved to %s\n'</span>,model_file);
0078         <span class="keyword">end</span>
0079       <span class="keyword">end</span>
0080       <span class="comment">% obtain and record machine info</span>
0081       <span class="keyword">try</span>
0082         [~,kernel] = system(<span class="string">'uname -v'</span>);
0083         [~,OS]     = system(<span class="string">'uname -o'</span>);
0084        [~,home]    = system(<span class="string">'echo $HOME'</span>);  <span class="comment">% home directory</span>
0085        [zzz, computername] = system(<span class="string">'hostname'</span>);           <span class="comment">% Uses linux system command to get the machine name of host.</span>
0086        [zzz, meminfo]      = system(<span class="string">'cat /proc/meminfo'</span>);  <span class="comment">% Uses linux system command to get a report on system memory</span>
0087        total_memory        = textscan(meminfo, <span class="string">'%*s %s %s'</span>, 1);  <span class="comment">% Parses the memory report for 2nd and 3rd space-delimited items of first line: memory amount.</span>
0088        total_memory        = [total_memory{1}{1} <span class="string">' '</span> total_memory{2}{1}];  <span class="comment">% Extracts the info from cell array to create char array.</span>
0089        [zzz, cpuinfo]      = system(<span class="string">'cat /proc/cpuinfo'</span>);  <span class="comment">% Uses linux system command to get a report on CPU types and speeds, etc.</span>
0090        cpuinfo             = textscan(cpuinfo, <span class="string">'%*s %*s %*s %*s %s %*s %*s %s'</span>, 1, <span class="string">'delimiter'</span>, <span class="string">'\n'</span>); <span class="comment">% Extracts lines 5 and 8 of report: Proc Type, and Cache</span>
0091        CPU_type            = textscan(cpuinfo{1}{1}, <span class="string">'%*s %s'</span>, 1, <span class="string">'delimiter'</span> , <span class="string">':'</span>); <span class="comment">% Parses line that includes CPU type.</span>
0092        CPU_type            = [strrep(CPU_type{1}{1},<span class="string">'  '</span>,<span class="string">''</span>) ];    <span class="comment">% ## Look for better way for this: collapse all repeated white space stretches to single spaces.</span>
0093        CPU_cache           = textscan(cpuinfo{2}{1}, <span class="string">'%*s %s'</span>, 1, <span class="string">'delimiter'</span> , <span class="string">':'</span>); <span class="comment">% Parses line that includes the cache info</span>
0094        CPU_cache           = [CPU_cache{1}{1} ];                                      <span class="comment">% Takes the cache info out of the cell array.</span>
0095        machine_info.host_name=strtrim(computername);
0096        machine_info.total_memory=total_memory;
0097        machine_info.CPU_type=CPU_type;
0098        machine_info.CPU_cache=CPU_cache;
0099        machine_info.num_cores=feature(<span class="string">'numcores'</span>);          <span class="comment">% Matlab command to get the number of processor cores on current host machine.</span>
0100        machine_info.operating_system=strtrim(OS);
0101        machine_info.kernel=strtrim(kernel);
0102        machine_info.home_dir=strtrim(home); 
0103        studyinfo.simulations(sim_ind).machine_info=machine_info;
0104       <span class="keyword">end</span>
0105       <span class="comment">% set duration</span>
0106       <span class="keyword">if</span> isempty(options.duration)
0107         <span class="comment">%t1=datevec(studyinfo.simulations(sim_ind).start_time);</span>
0108         <span class="comment">%t2=datevec(now);</span>
0109         duration=nan;<span class="comment">%etime(t2,t1);</span>
0110       <span class="keyword">else</span>
0111         duration=options.duration;
0112       <span class="keyword">end</span>
0113       studyinfo.simulations(sim_ind).duration=duration;
0114       <span class="comment">% copy cluster logs to study directory</span>
0115       <span class="keyword">if</span> isdir(studyinfo.simulations(sim_ind).batch_dir)
0116         log_dir=fullfile(studyinfo.study_dir,<span class="string">'logs'</span>);
0117         log_file=fullfile(studyinfo.simulations(sim_ind).batch_dir,<span class="string">'pbsout'</span>,[<span class="string">'sim_job'</span> num2str(options.process_id) <span class="string">'.out'</span>]);
0118         <span class="keyword">if</span> exist(log_file,<span class="string">'file'</span>)
0119           <span class="keyword">if</span> ~exist(log_dir,<span class="string">'dir'</span>)
0120             <span class="keyword">if</span> options.verbose_flag
0121               fprintf(<span class="string">'creating study logs directory: %s\n'</span>,log_dir);
0122             <span class="keyword">end</span>
0123             mkdir(log_dir);
0124           <span class="keyword">end</span>
0125           <span class="keyword">if</span> options.verbose_flag
0126             fprintf(<span class="string">'copying cluster log to study logs directory: %s\n'</span>,log_file);
0127           <span class="keyword">end</span>
0128           [success,msg]=copyfile(log_file,log_dir);
0129           <span class="keyword">if</span> ~success, error(msg); <span class="keyword">end</span>
0130         <span class="keyword">end</span>
0131       <span class="keyword">end</span>
0132     <span class="keyword">case</span> <span class="string">'failed'</span>
0133       <span class="comment">% set error_log</span>
0134       <span class="comment">%studyinfo.simulations(sim_ind).error_log=MException.last;</span>
0135         <span class="comment">% usage: displayError(studyinfo.simulations(k).error_log);</span>
0136       studyinfo.simulations(sim_ind).error_log=lasterr;
0137       <span class="comment">% copy cluster logs to study directory</span>
0138       <span class="keyword">if</span> isdir(studyinfo.simulations(sim_ind).batch_dir)
0139         log_dir=fullfile(studyinfo.study_dir,<span class="string">'logs'</span>);
0140         log_file=fullfile(studyinfo.simulations(sim_ind).batch_dir,<span class="string">'pbsout'</span>,[<span class="string">'sim_job'</span> num2str(options.process_id) <span class="string">'.out'</span>]);
0141         errfile=fullfile(studyinfo.simulations(sim_ind).batch_dir,<span class="string">'pbsout'</span>,[<span class="string">'sim_job'</span> num2str(options.process_id) <span class="string">'.err'</span>]);
0142         <span class="keyword">if</span> exist(log_file,<span class="string">'file'</span>)
0143           <span class="keyword">if</span> options.verbose_flag
0144             fprintf(<span class="string">'copying cluster logs to study logs directory...\n'</span>);
0145             fprintf(<span class="string">'\t%s\n'</span>,log_file);
0146           <span class="keyword">end</span>
0147           copyfile(log_file,log_dir);
0148         <span class="keyword">end</span>
0149         <span class="keyword">if</span> exist(errfile,<span class="string">'file'</span>)
0150           <span class="keyword">if</span> options.verbose_flag
0151             fprintf(<span class="string">'\t%s\n'</span>,errfile);
0152           <span class="keyword">end</span>
0153           copyfile(errfile,log_dir);
0154         <span class="keyword">end</span>
0155       <span class="keyword">end</span>
0156     <span class="keyword">otherwise</span>
0157       <span class="comment">% do nothing</span>
0158   <span class="keyword">end</span>
0159 <span class="keyword">end</span>
0160 <span class="comment">% update studyinfo.analysis</span>
0161 <span class="keyword">if</span> ~isempty(options.status) &amp;&amp; ~isempty(studyinfo.analysis)
0162   <span class="comment">% ...</span>
0163 <span class="keyword">end</span>
0164 <span class="comment">% check if study is complete; clean up if so (e.g, remove batchdirs)</span>
0165 <span class="keyword">if</span> all(strcmp(<span class="string">'finished'</span>,{studyinfo.simulations.status}))
0166   fprintf(<span class="string">'ALL SIMULATIONS HAVE FINISHED!\n'</span>);
0167   <span class="comment">% cleanup study</span>
0168   <span class="keyword">if</span> ~already_finished <span class="comment">% this is the first time the study has completed</span>
0169     <span class="keyword">if</span> 0
0170       <span class="comment">% cleanup batch directory</span>
0171       batch_dirs=unique({studyinfo.simulations.batch_dir});      
0172       log_dir=fullfile(studyinfo.study_dir,<span class="string">'logs'</span>);
0173       <span class="keyword">if</span> ~exist(log_dir,<span class="string">'dir'</span>)      
0174         <span class="keyword">if</span> options.verbose_flag
0175           fprintf(<span class="string">'creating log directory: %s\n'</span>,log_dir);
0176         <span class="keyword">end</span>    
0177         mkdir(log_dir);
0178       <span class="keyword">end</span>
0179       <span class="keyword">for</span> i=1:length(batch_dirs)
0180         <span class="keyword">if</span> ~exist(batch_dirs{i},<span class="string">'dir'</span>)
0181           <span class="keyword">continue</span>;
0182         <span class="keyword">end</span>
0183         <span class="comment">% copy log files from batch_dir to study_dir/logs</span>
0184         <span class="keyword">if</span> exist(fullfile(batch_dirs{i},<span class="string">'pbsout'</span>),<span class="string">'dir'</span>)
0185           <span class="keyword">if</span> options.verbose_flag
0186             fprintf(<span class="string">'copying log files from batch directory to study logs directory...\n'</span>);
0187           <span class="keyword">end</span>
0188           copyfile(fullfile(batch_dirs{i},<span class="string">'pbsout'</span>),log_dir);
0189         <span class="keyword">end</span>
0190         <span class="comment">% remove batch directory</span>
0191         <span class="keyword">if</span> options.verbose_flag
0192           fprintf(<span class="string">'removing batch directory: %s\n'</span>,batch_dirs{i});
0193         <span class="keyword">end</span>
0194         rmdir(batch_dirs{i},<span class="string">'s'</span>);
0195       <span class="keyword">end</span>
0196     <span class="keyword">end</span>
0197     <span class="comment">% email notification:</span>
0198     <span class="keyword">if</span> ~isempty(options.email)
0199       <span class="comment">%% Send Email</span>
0200       <span class="keyword">if</span> options.verbose_flag
0201         fprintf(<span class="string">'emailing notification of study completion to %s\n'</span>,options.email);
0202       <span class="keyword">end</span>
0203       email_attachments = {};
0204       reply_address = <span class="string">'batch@infinitebrain.org'</span>;
0205       <span class="keyword">try</span>
0206         setpref(<span class="string">'Internet'</span>,<span class="string">'SMTP_Server'</span>,<span class="string">'127.0.0.1'</span>); <span class="comment">% Sets the outgoing mail server - often the default 127.0.0.1</span>
0207         setpref(<span class="string">'Internet'</span>,<span class="string">'E_mail'</span>,reply_address);    <span class="comment">% Sets the email FROM/reply address for all outgoing email reports.</span>
0208         <span class="keyword">if</span> ~isempty(email_attachments)
0209           fprintf(<span class="string">'Files attached to report email:\n'</span>);
0210           email_attachments{:}
0211         <span class="keyword">end</span>
0212         sendmail(options.email,sprintf(<span class="string">'Analysis report for study: &quot;%s&quot;'</span>,studyinfo.study_dir),<span class="keyword">...</span>
0213            [10 options.prefix <span class="string">'. Max simulation time: '</span> sprintf(<span class="string">'%0.2f min'</span>,max([studyinfo.simulations.duration])/60) <span class="string">'. Browse models (results?) online at infinitebrain.org. Current time: '</span> datestr(now,31) <span class="string">'  (Automated message from DynaSim (github.com/dynasim/dynasim).)'</span> 10],<span class="keyword">...</span>
0214            {email_attachments{:}});  
0215         fprintf(<span class="string">'\nreport emailed successfully to: %s\n'</span>,options.email);
0216       <span class="keyword">catch</span> exception
0217         fprintf(<span class="string">'\nFailed to email report to: %s\n'</span>,options.email);
0218         <a href="displayError.html" class="code" title="function displayError(err)">displayError</a>(exception);
0219       <span class="keyword">end</span>
0220     <span class="keyword">end</span>  
0221   <span class="keyword">end</span>
0222 <span class="keyword">end</span>
0223 
0224 <span class="comment">% todo: auto-relaunch batch? ...</span>
0225 <span class="comment">% ...</span>
0226 
0227 <span class="comment">% update studyinfo on disk</span>
0228 <a href="ds.studyinfoIO.html" class="code" title="function studyinfo=ds.studyinfoIO(studyinfo,study_file,id,verbose_flag)">ds.studyinfoIO</a>(studyinfo.simulations(sim_ind),study_dir,options.process_id,options.verbose_flag);
0229 
0230 
0231 <span class="comment">%     case 'started'</span>
0232 <span class="comment">%       % set start_time</span>
0233 <span class="comment">%       studyinfo.simulations(sim_ind).start_time=datestr(now);</span>
0234 <span class="comment">%       studyinfo.simulations(sim_ind).simulator_options=options.simulator_options;</span>
0235 <span class="comment">%       % save DynaSim model structure</span>
0236 <span class="comment">%       if isstruct(options.model)</span>
0237 <span class="comment">%         model=options.model;</span>
0238 <span class="comment">%         model_file=studyinfo.simulations(sim_ind).modified_model_file;</span>
0239 <span class="comment">%         save(model_file,'model','-v7.3');</span>
0240 <span class="comment">%         if options.verbose_flag</span>
0241 <span class="comment">%           fprintf('model saved to %s\n',model_file);</span>
0242 <span class="comment">%         end</span>
0243 <span class="comment">%       end</span>
0244 <span class="comment">%        % obtain and record machine info</span>
0245 <span class="comment">%        try</span>
0246 <span class="comment">%          [~,kernel] = system('uname -v');</span>
0247 <span class="comment">%          [~,OS]     = system('uname -o');</span>
0248 <span class="comment">%         [~,home]    = system('echo $HOME');  % home directory</span>
0249 <span class="comment">%         [zzz, computername] = system('hostname');           % Uses linux system command to get the machine name of host.</span>
0250 <span class="comment">%         [zzz, meminfo]      = system('cat /proc/meminfo');  % Uses linux system command to get a report on system memory</span>
0251 <span class="comment">%         total_memory        = textscan(meminfo, '%*s %s %s', 1);  % Parses the memory report for 2nd and 3rd space-delimited items of first line: memory amount.</span>
0252 <span class="comment">%         total_memory        = [total_memory{1}{1} ' ' total_memory{2}{1}];  % Extracts the info from cell array to create char array.</span>
0253 <span class="comment">%         [zzz, cpuinfo]      = system('cat /proc/cpuinfo');  % Uses linux system command to get a report on CPU types and speeds, etc.</span>
0254 <span class="comment">%         cpuinfo             = textscan(cpuinfo, '%*s %*s %*s %*s %s %*s %*s %s', 1, 'delimiter', '\n'); % Extracts lines 5 and 8 of report: Proc Type, and Cache</span>
0255 <span class="comment">%         CPU_type            = textscan(cpuinfo{1}{1}, '%*s %s', 1, 'delimiter' , ':'); % Parses line that includes CPU type.</span>
0256 <span class="comment">%         CPU_type            = [strrep(CPU_type{1}{1},'  ','') ];    % ## Look for better way for this: collapse all repeated white space stretches to single spaces.</span>
0257 <span class="comment">%         CPU_cache           = textscan(cpuinfo{2}{1}, '%*s %s', 1, 'delimiter' , ':'); % Parses line that includes the cache info</span>
0258 <span class="comment">%         CPU_cache           = [CPU_cache{1}{1} ];                                      % Takes the cache info out of the cell array.</span>
0259 <span class="comment">%         machine_info.host_name=strtrim(computername);</span>
0260 <span class="comment">%         machine_info.total_memory=total_memory;</span>
0261 <span class="comment">%         machine_info.CPU_type=CPU_type;</span>
0262 <span class="comment">%         machine_info.CPU_cache=CPU_cache;</span>
0263 <span class="comment">%         machine_info.num_cores=feature('numcores');          % Matlab command to get the number of processor cores on current host machine.</span>
0264 <span class="comment">%         machine_info.operating_system=strtrim(OS);</span>
0265 <span class="comment">%         machine_info.kernel=strtrim(kernel);</span>
0266 <span class="comment">%         machine_info.home_dir=strtrim(home);</span>
0267 <span class="comment">%         studyinfo.simulations(sim_ind).machine_info=machine_info;</span>
0268 <span class="comment">%        end</span></pre></div>
<hr><address>Generated on Fri 07-Apr-2017 20:01:20 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>