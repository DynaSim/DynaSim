<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of ds.data2Table</title>
  <meta name="keywords" content="ds.data2Table">
  <meta name="description" content="Converts DynaSim structure to 1D cell array format. Later can use to">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- menu.html functions -->
<h1>ds.data2Table
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>Converts DynaSim structure to 1D cell array format. Later can use to</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function [data_table,column_titles,time] = ds.data2Table(data,verbose_flag) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> Converts DynaSim structure to 1D cell array format. Later can use to
 import to xPlt</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="ds.checkData.html" class="code" title="function data=ds.checkData(data)">ds.checkData</a>	CHECKDATA - Standardize data structure and auto-populate missing fields</li><li><a href="ds.previewTable.html" class="code" title="function [dt_formatted] = ds.previewTable(data_table,col_names)">ds.previewTable</a>	All data, formatted into cells</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="ds.ds2xPlt.html" class="code" title="function xp = ds.ds2xPlt(data)">ds.ds2xPlt</a>	Convert DynaSim data structure to xp format</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [data_table,column_titles,time] = ds.data2Table(data,verbose_flag)</a>
0002     <span class="comment">% Converts DynaSim structure to 1D cell array format. Later can use to</span>
0003     <span class="comment">% import to xPlt</span>
0004     
0005     <span class="keyword">if</span> nargin &lt; 2
0006         verbose_flag = 0;
0007     <span class="keyword">end</span>
0008 
0009     <a href="ds.checkData.html" class="code" title="function data=ds.checkData(data)">ds.checkData</a>(data);            <span class="comment">% Makes sure it's a valid DynaSim Data structure</span>
0010     
0011     <span class="comment">% Extract Time variable</span>
0012     time = data(1).time;
0013     
0014     <span class="comment">% Create dummy varied variable if none there</span>
0015     <span class="keyword">for</span> i = 1:length(data)
0016         <span class="keyword">if</span> ~isfield(data(i),<span class="string">'varied'</span>)
0017             data(i).varied = [];
0018         <span class="keyword">end</span>
0019         <span class="keyword">if</span> isempty(data(i).varied)
0020             data(i).varied = {<span class="string">'Varied1'</span>};  <span class="comment">% Random name for varied data</span>
0021             data(i).Varied1 = i;           <span class="comment">% Random value</span>
0022         <span class="keyword">end</span>
0023     <span class="keyword">end</span>
0024     
0025     <span class="comment">% ## VARIED parameter sweeps ##</span>
0026     varied=data(1).varied;
0027     num_varied=length(varied); <span class="comment">% number of model components varied across simulations</span>
0028     num_sims=length(data); <span class="comment">% number of data sets (one per simulation)</span>
0029     <span class="comment">%param_mat=zeros(num_sims,num_varied); % values for each simulation</span>
0030     
0031     <span class="comment">% Create params cell array--just used for making ax</span>
0032 <span class="comment">%     for iVar=1:num_varied</span>
0033 <span class="comment">%         if isnumeric(data(1).(varied{iVar}))</span>
0034 <span class="comment">%             params{iVar} = [data.(varied{iVar})]; % store as nested mat</span>
0035 <span class="comment">%         else</span>
0036 <span class="comment">% %             for iSim = 1:length(data)</span>
0037 <span class="comment">% %                 params{iVar}{iSim} = data(iSim).(varied{iVar}); %store as cells</span>
0038 <span class="comment">% %             end</span>
0039 <span class="comment">%             params{iVar} = {data.(varied{iVar})}; %store as nested cell array</span>
0040 <span class="comment">%         end</span>
0041 <span class="comment">%     end</span>
0042     
0043     <span class="comment">% ## FIELDS Get all fields of data ##</span>
0044     <span class="comment">% Get metadata for all data fields (e.g. populations / currents / state</span>
0045     <span class="comment">% variables)</span>
0046     labels = data(1).labels;
0047     labels = labels(cellfun(@isempty,strfind(labels,<span class="string">'time'</span>))); <span class="comment">% Remove time from labels</span>
0048     num_labels = length(labels);
0049     
0050     <span class="comment">% Determine all unique populations</span>
0051     pop_names={data(1).model.specification.populations.name}; <span class="comment">% list of populations</span>
0052     
0053     <span class="comment">% Build list populations and variables</span>
0054     separatorInds = strfind(labels,<span class="string">'_'</span>);
0055     func1 = @(x,y) x(1:y(1)-1);
0056     func2 = @(x,y) x(y(1)+1:end);
0057     pops = cellfun(func1,labels,separatorInds,<span class="string">'UniformOutput'</span>,0);
0058     vars = cellfun(func2,labels,separatorInds,<span class="string">'UniformOutput'</span>,0);
0059     
0060     <span class="comment">% ## Build a large linear list ##</span>
0061     ind=0;
0062     data_linear = cell(1,num_sims*num_labels);
0063     <span class="keyword">for</span> iSim = 1:num_sims
0064         <span class="keyword">for</span> iLabel = 1:num_labels
0065             
0066             ind=ind+1;
0067             data_linear{ind} = data(iSim).(labels{iLabel});
0068             
0069             <span class="comment">% Number of parameter sweeps, plus populations, plus variables (Vm, state variables, functions, etc.)</span>
0070             <span class="keyword">for</span> iVar = 1:num_varied
0071                 <span class="keyword">if</span> isnumeric(data(1).(varied{iVar}))
0072 <span class="comment">%                     ax{iVar}(ind) = params{iVar}(iSim); % using nested mat</span>
0073                     ax{iVar}(ind) = data(iSim).(varied{iVar}); <span class="comment">% using nested mat</span>
0074                 <span class="keyword">else</span>
0075 <span class="comment">%                     ax{iVar}{ind} = params{iVar}{iSim}; % using nested cell array</span>
0076                     ax{iVar}{ind} = data(iSim).(varied{iVar}); <span class="comment">% using nested cell array</span>
0077                 <span class="keyword">end</span>
0078             <span class="keyword">end</span>
0079             
0080             ax{num_varied+1}{ind} = pops{iLabel};
0081             
0082 <span class="comment">%             iVar=iVar+1; % REVIEW: I don't think this line does anything</span>
0083             ax{num_varied+2}{ind} = vars{iLabel};
0084             
0085         <span class="keyword">end</span>
0086     <span class="keyword">end</span>
0087     
0088     ax_names = varied;
0089     ax_names{num_varied+1} = <span class="string">'populations'</span>;
0090     ax_names{num_varied+2} = <span class="string">'variables'</span>;
0091     
0092     <span class="comment">% Transpose everything to make it in terms of columns instead of rows.</span>
0093     data_linear = data_linear(:);
0094     <span class="keyword">for</span> i = 1:length(ax)
0095         ax{i} = ax{i}';
0096     <span class="keyword">end</span>
0097     
0098     <span class="comment">% Combine everything into one data table</span>
0099     data_table = horzcat({data_linear},ax);
0100     
0101     <span class="comment">% List table column names</span>
0102     column_titles = {<span class="string">'data'</span>,ax_names{:}};
0103     
0104     <span class="keyword">if</span> verbose_flag
0105         <a href="ds.previewTable.html" class="code" title="function [dt_formatted] = ds.previewTable(data_table,col_names)">ds.previewTable</a>(data_table,column_titles);
0106     <span class="keyword">end</span>
0107     
0108 <span class="keyword">end</span>
0109 
0110</pre></div>
<hr><address>Generated on Fri 07-Apr-2017 20:01:20 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>